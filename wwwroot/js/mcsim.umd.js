(function(Ht){typeof define=="function"&&define.amd?define(Ht):Ht()})(function(){"use strict";function Ht(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}function de(m){if(m.__esModule)return m;var u=m.default;if(typeof u=="function"){var y=function b(){if(this instanceof b){var x=[null];x.push.apply(x,arguments);var w=Function.bind.apply(u,x);return new w}return u.apply(this,arguments)};y.prototype=u.prototype}else y={};return Object.defineProperty(y,"__esModule",{value:!0}),Object.keys(m).forEach(function(b){var x=Object.getOwnPropertyDescriptor(m,b);Object.defineProperty(y,b,x.get?x:{enumerable:!0,get:function(){return m[b]}})}),y}var ge={exports:{}};(function(m){(function(){var u={de_DE:{identifier:"de-DE",days:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],shortDays:["So","Mo","Di","Mi","Do","Fr","Sa"],months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],shortMonths:["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d.%m.%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},en_CA:{identifier:"en-CA",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ordinalSuffixes:["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d/%m/%y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%r",x:"%D"}},en_US:{identifier:"en-US",days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],ordinalSuffixes:["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%m/%d/%y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%r",x:"%D"}},es_MX:{identifier:"es-MX",days:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],shortDays:["dom","lun","mar","mié","jue","vie","sáb"],months:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre"," diciembre"],shortMonths:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d/%m/%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},fr_FR:{identifier:"fr-FR",days:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],shortDays:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],months:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],shortMonths:["janv.","févr.","mars","avril","mai","juin","juil.","août","sept.","oct.","nov.","déc."],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d/%m/%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},it_IT:{identifier:"it-IT",days:["domenica","lunedì","martedì","mercoledì","giovedì","venerdì","sabato"],shortDays:["dom","lun","mar","mer","gio","ven","sab"],months:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],shortMonths:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d/%m/%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},nl_NL:{identifier:"nl-NL",days:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],shortDays:["zo","ma","di","wo","do","vr","za"],months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],shortMonths:["jan","feb","mrt","apr","mei","jun","jul","aug","sep","okt","nov","dec"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d-%m-%y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},pt_BR:{identifier:"pt-BR",days:["domingo","segunda","terça","quarta","quinta","sexta","sábado"],shortDays:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],months:["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],shortMonths:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X %Z",D:"%d-%m-%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},ru_RU:{identifier:"ru-RU",days:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],shortDays:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],shortMonths:["янв","фев","мар","апр","май","июн","июл","авг","сен","окт","ноя","дек"],AM:"AM",PM:"PM",am:"am",pm:"pm",formats:{c:"%a %d %b %Y %X",D:"%d.%m.%y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},tr_TR:{identifier:"tr-TR",days:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"],shortDays:["Paz","Pzt","Sal","Çrş","Prş","Cum","Cts"],months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],shortMonths:["Oca","Şub","Mar","Nis","May","Haz","Tem","Ağu","Eyl","Eki","Kas","Ara"],AM:"ÖÖ",PM:"ÖS",am:"ÖÖ",pm:"ÖS",formats:{c:"%a %d %b %Y %X %Z",D:"%d-%m-%Y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%T",x:"%D"}},zh_CN:{identifier:"zh-CN",days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],shortDays:["日","一","二","三","四","五","六"],months:["一月份","二月份","三月份","四月份","五月份","六月份","七月份","八月份","九月份","十月份","十一月份","十二月份"],shortMonths:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],AM:"上午",PM:"下午",am:"上午",pm:"下午",formats:{c:"%a %d %b %Y %X %Z",D:"%d/%m/%y",F:"%Y-%m-%d",R:"%H:%M",r:"%I:%M:%S %p",T:"%H:%M:%S",v:"%e-%b-%Y",X:"%r",x:"%D"}}},y=u.en_US,b=new x(y,0,!1);m.exports=b,typeof Date.now!="function"&&(Date.now=function(){return+new Date});function x(s,i,o){var l=s||y,d=i||0,g=o||!1,v=0,_;function p(O,k){var P;if(k){if(P=k.getTime(),g){var E=r(k);if(k=new Date(P+E+d),r(k)!==E){var X=r(k);k=new Date(P+X+d)}}}else{var F=Date.now();F>v?(v=F,_=new Date(v),P=v,g&&(_=new Date(v+r(_)+d))):P=v,k=_}return C(O,k,l,P)}function C(O,k,P,F){for(var E="",X=null,z=!1,V=O.length,J=!1,T=0;T<V;T++){var j=O.charCodeAt(T);if(z===!0){if(j===45){X="";continue}else if(j===95){X=" ";continue}else if(j===48){X="0";continue}else if(j===58){J&&c("[WARNING] detected use of unsupported %:: or %::: modifiers to strftime"),J=!0;continue}switch(j){case 37:E+="%";break;case 65:E+=P.days[k.getDay()];break;case 66:E+=P.months[k.getMonth()];break;case 67:E+=w(Math.floor(k.getFullYear()/100),X);break;case 68:E+=C(P.formats.D,k,P,F);break;case 70:E+=C(P.formats.F,k,P,F);break;case 72:E+=w(k.getHours(),X);break;case 73:E+=w(f(k.getHours()),X);break;case 76:E+=D(Math.floor(F%1e3));break;case 77:E+=w(k.getMinutes(),X);break;case 80:E+=k.getHours()<12?P.am:P.pm;break;case 82:E+=C(P.formats.R,k,P,F);break;case 83:E+=w(k.getSeconds(),X);break;case 84:E+=C(P.formats.T,k,P,F);break;case 85:E+=w(e(k,"sunday"),X);break;case 87:E+=w(e(k,"monday"),X);break;case 88:E+=C(P.formats.X,k,P,F);break;case 89:E+=k.getFullYear();break;case 90:if(g&&d===0)E+="GMT";else{var R=t(k);E+=R||""}break;case 97:E+=P.shortDays[k.getDay()];break;case 98:E+=P.shortMonths[k.getMonth()];break;case 99:E+=C(P.formats.c,k,P,F);break;case 100:E+=w(k.getDate(),X);break;case 101:E+=w(k.getDate(),X??" ");break;case 104:E+=P.shortMonths[k.getMonth()];break;case 106:var I=new Date(k.getFullYear(),0,1),K=Math.ceil((k.getTime()-I.getTime())/(1e3*60*60*24));E+=D(K);break;case 107:E+=w(k.getHours(),X??" ");break;case 108:E+=w(f(k.getHours()),X??" ");break;case 109:E+=w(k.getMonth()+1,X);break;case 110:E+=`
`;break;case 111:var K=k.getDate();P.ordinalSuffixes?E+=String(K)+(P.ordinalSuffixes[K-1]||h(K)):E+=String(K)+h(K);break;case 112:E+=k.getHours()<12?P.AM:P.PM;break;case 114:E+=C(P.formats.r,k,P,F);break;case 115:E+=Math.floor(F/1e3);break;case 116:E+="	";break;case 117:var K=k.getDay();E+=K===0?7:K;break;case 118:E+=C(P.formats.v,k,P,F);break;case 119:E+=k.getDay();break;case 120:E+=C(P.formats.x,k,P,F);break;case 121:E+=(""+k.getFullYear()).slice(2);break;case 122:if(g&&d===0)E+=J?"+00:00":"+0000";else{var M;d!==0?M=d/(60*1e3):M=-k.getTimezoneOffset();var A=M<0?"-":"+",L=J?":":"",B=Math.floor(Math.abs(M/60)),W=Math.abs(M%60);E+=A+w(B)+L+w(W)}break;default:z&&(E+="%"),E+=O[T];break}X=null,z=!1;continue}if(j===37){z=!0;continue}E+=O[T]}return E}var S=p;return S.localize=function(O){return new x(O||l,d,g)},S.localizeByIdentifier=function(O){var k=u[O];return k?S.localize(k):(c('[WARNING] No locale found with identifier "'+O+'".'),S)},S.timezone=function(O){var k=d,P=g,F=typeof O;if(F==="number"||F==="string")if(P=!0,F==="string"){var E=O[0]==="-"?-1:1,X=parseInt(O.slice(1,3),10),z=parseInt(O.slice(3,5),10);k=E*(60*X+z)*60*1e3}else F==="number"&&(k=O*60*1e3);return new x(l,k,P)},S.utc=function(){return new x(l,d,!0)},S}function w(s,i){return i===""||s>9?s:(i==null&&(i="0"),i+s)}function D(s){return s>99?s:s>9?"0"+s:"00"+s}function f(s){return s===0?12:s>12?s-12:s}function e(s,i){i=i||"sunday";var o=s.getDay();i==="monday"&&(o===0?o=6:o--);var l=Date.UTC(s.getFullYear(),0,1),d=Date.UTC(s.getFullYear(),s.getMonth(),s.getDate()),g=Math.floor((d-l)/864e5),v=(g+7-o)/7;return Math.floor(v)}function h(s){var i=s%10,o=s%100;if(o>=11&&o<=13||i===0||i>=4)return"th";switch(i){case 1:return"st";case 2:return"nd";case 3:return"rd"}}function r(s){return(s.getTimezoneOffset()||0)*6e4}function t(s,i){return a(s,i)||n(s)}function a(s,i){if(i==null)return null;var o=s.toLocaleString(i,{timeZoneName:"short"}).match(/\s([\w]+)$/);return o&&o[1]}function n(s){var i=s.toString().match(/\(([\w\s]+)\)/);return i&&i[1]}function c(s){typeof console<"u"&&typeof console.warn=="function"&&console.warn(s)}})()})(ge);var me={};const Zt=de(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(m){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var u=u||{version:"3.6.3"};if(m.fabric=u,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?u.document=document:u.document=document.implementation.createHTMLDocument(""),u.window=window;else{var y=Zt,b=new y.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;u.document=b.document,u.jsdomImplForWrapper=Zt.implForWrapper,u.nodeCanvas=Zt.Canvas,u.window=b,DOMParser=u.window.DOMParser}u.isTouchSupported="ontouchstart"in u.window||"ontouchstart"in u.document||u.window&&u.window.navigator&&u.window.navigator.maxTouchPoints>0,u.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",u.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],u.DPI=96,u.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",u.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,u.reNonWord=/[ \n\.,;!\?\-]/,u.fontPaths={},u.iMatrix=[1,0,0,1,0,0],u.svgNS="http://www.w3.org/2000/svg",u.perfLimitSizeTotal=2097152,u.maxCacheSideLimit=4096,u.minCacheSideLimit=256,u.charWidthsCache={},u.textureSize=2048,u.disableStyleCopyPaste=!1,u.enableGLFiltering=!0,u.devicePixelRatio=u.window.devicePixelRatio||u.window.webkitDevicePixelRatio||u.window.mozDevicePixelRatio||1,u.browserShadowBlurConstant=1,u.arcToSegmentsCache={},u.boundsOfCurveCache={},u.cachesBoundsOfCurve=!0,u.forceGLPutImageData=!1,u.initFilterBackend=function(){if(u.enableGLFiltering&&u.isWebglSupported&&u.isWebglSupported(u.textureSize))return console.log("max texture size: "+u.maxTextureSize),new u.WebglFilterBackend({tileSize:u.textureSize});if(u.Canvas2dFilterBackend)return new u.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=u),function(){function f(t,a){if(this.__eventListeners[t]){var n=this.__eventListeners[t];a?n[n.indexOf(a)]=!1:u.util.array.fill(n,!1)}}function e(t,a){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var n in t)this.on(n,t[n]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(a);return this}function h(t,a){if(!this.__eventListeners)return this;if(arguments.length===0)for(t in this.__eventListeners)f.call(this,t);else if(arguments.length===1&&typeof arguments[0]=="object")for(var n in t)f.call(this,n,t[n]);else f.call(this,t,a);return this}function r(t,a){if(!this.__eventListeners)return this;var n=this.__eventListeners[t];if(!n)return this;for(var c=0,s=n.length;c<s;c++)n[c]&&n[c].call(this,a||{});return this.__eventListeners[t]=n.filter(function(i){return i!==!1}),this}u.Observable={observe:e,stopObserving:h,fire:r,on:e,off:h,trigger:r}}(),u.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var f=0,e=arguments.length;f<e;f++)this._onObjectAdded(arguments[f]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(f,e,h){var r=this._objects;return h?r[e]=f:r.splice(e,0,f),this._onObjectAdded&&this._onObjectAdded(f),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var f=this._objects,e,h=!1,r=0,t=arguments.length;r<t;r++)e=f.indexOf(arguments[r]),e!==-1&&(h=!0,f.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&h&&this.requestRenderAll(),this},forEachObject:function(f,e){for(var h=this.getObjects(),r=0,t=h.length;r<t;r++)f.call(e,h[r],r,h);return this},getObjects:function(f){return typeof f>"u"?this._objects.concat():this._objects.filter(function(e){return e.type===f})},item:function(f){return this._objects[f]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(f){return this._objects.indexOf(f)>-1},complexity:function(){return this._objects.reduce(function(f,e){return f+=e.complexity?e.complexity():0,f},0)}},u.CommonMethods={_setOptions:function(f){for(var e in f)this.set(e,f[e])},_initGradient:function(f,e){f&&f.colorStops&&!(f instanceof u.Gradient)&&this.set(e,new u.Gradient(f))},_initPattern:function(f,e,h){f&&f.source&&!(f instanceof u.Pattern)?this.set(e,new u.Pattern(f,h)):h&&h()},_initClipping:function(f){if(!(!f.clipTo||typeof f.clipTo!="string")){var e=u.util.getFunctionBody(f.clipTo);typeof e<"u"&&(this.clipTo=new Function("ctx",e))}},_setObject:function(f){for(var e in f)this._set(e,f[e])},set:function(f,e){return typeof f=="object"?this._setObject(f):typeof e=="function"&&f!=="clipTo"?this._set(f,e(this.get(f))):this._set(f,e),this},_set:function(f,e){this[f]=e},toggle:function(f){var e=this.get(f);return typeof e=="boolean"&&this.set(f,!e),this},get:function(f){return this[f]}},function(f){var e=Math.sqrt,h=Math.atan2,r=Math.pow,t=Math.PI/180,a=Math.PI/2;u.util={cos:function(n){if(n===0)return 1;n<0&&(n=-n);var c=n/a;switch(c){case 1:case 3:return 0;case 2:return-1}return Math.cos(n)},sin:function(n){if(n===0)return 0;var c=n/a,s=1;switch(n<0&&(s=-1),c){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(n)},removeFromArray:function(n,c){var s=n.indexOf(c);return s!==-1&&n.splice(s,1),n},getRandomInt:function(n,c){return Math.floor(Math.random()*(c-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,c,s){n.subtractEquals(c);var i=u.util.rotateVector(n,s);return new u.Point(i.x,i.y).addEquals(c)},rotateVector:function(n,c){var s=u.util.sin(c),i=u.util.cos(c),o=n.x*i-n.y*s,l=n.x*s+n.y*i;return{x:o,y:l}},transformPoint:function(n,c,s){return s?new u.Point(c[0]*n.x+c[2]*n.y,c[1]*n.x+c[3]*n.y):new u.Point(c[0]*n.x+c[2]*n.y+c[4],c[1]*n.x+c[3]*n.y+c[5])},makeBoundingBoxFromPoints:function(n,c){if(c)for(var s=0;s<n.length;s++)n[s]=u.util.transformPoint(n[s],c);var i=[n[0].x,n[1].x,n[2].x,n[3].x],o=u.util.array.min(i),l=u.util.array.max(i),d=l-o,g=[n[0].y,n[1].y,n[2].y,n[3].y],v=u.util.array.min(g),_=u.util.array.max(g),p=_-v;return{left:o,top:v,width:d,height:p}},invertTransform:function(n){var c=1/(n[0]*n[3]-n[1]*n[2]),s=[c*n[3],-c*n[1],-c*n[2],c*n[0]],i=u.util.transformPoint({x:n[4],y:n[5]},s,!0);return s[4]=-i.x,s[5]=-i.y,s},toFixed:function(n,c){return parseFloat(Number(n).toFixed(c))},parseUnit:function(n,c){var s=/\D{0,2}$/.exec(n),i=parseFloat(n);switch(c||(c=u.Text.DEFAULT_SVG_FONT_SIZE),s[0]){case"mm":return i*u.DPI/25.4;case"cm":return i*u.DPI/2.54;case"in":return i*u.DPI;case"pt":return i*u.DPI/72;case"pc":return i*u.DPI/72*12;case"em":return i*c;default:return i}},falseFunction:function(){return!1},getKlass:function(n,c){return n=u.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),u.util.resolveNamespace(c)[n]},getSvgAttributes:function(n){var c=["instantiated_by_use","style","id","class"];switch(n){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"]);break}return c},resolveNamespace:function(n){if(!n)return u;var c=n.split("."),s=c.length,i,o=f||u.window;for(i=0;i<s;++i)o=o[c[i]];return o},loadImage:function(n,c,s,i){if(!n){c&&c.call(s,n);return}var o=u.util.createImage(),l=function(){c&&c.call(s,o),o=o.onload=o.onerror=null};o.onload=l,o.onerror=function(){u.log("Error loading "+o.src),c&&c.call(s,null,!0),o=o.onload=o.onerror=null},n.indexOf("data")!==0&&i&&(o.crossOrigin=i),n.substring(0,14)==="data:image/svg"&&(o.onload=null,u.util.loadImageInDom(o,l)),o.src=n},loadImageInDom:function(n,c){var s=u.document.createElement("div");s.style.width=s.style.height="1px",s.style.left=s.style.top="-100%",s.style.position="absolute",s.appendChild(n),u.document.querySelector("body").appendChild(s),n.onload=function(){c(),s.parentNode.removeChild(s),s=null}},enlivenObjects:function(n,c,s,i){n=n||[];var o=[],l=0,d=n.length;function g(){++l===d&&c&&c(o.filter(function(v){return v}))}if(!d){c&&c(o);return}n.forEach(function(v,_){if(!v||!v.type){g();return}var p=u.util.getKlass(v.type,s);p.fromObject(v,function(C,S){S||(o[_]=C),i&&i(v,C,S),g()})})},enlivenPatterns:function(n,c){n=n||[];function s(){++o===l&&c&&c(i)}var i=[],o=0,l=n.length;if(!l){c&&c(i);return}n.forEach(function(d,g){d&&d.source?new u.Pattern(d,function(v){i[g]=v,s()}):(i[g]=d,s())})},groupSVGElements:function(n,c,s){var i;return n&&n.length===1?n[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),i=new u.Group(n,c),typeof s<"u"&&(i.sourcePath=s),i)},populateWithProperties:function(n,c,s){if(s&&Object.prototype.toString.call(s)==="[object Array]")for(var i=0,o=s.length;i<o;i++)s[i]in n&&(c[s[i]]=n[s[i]])},drawDashedLine:function(n,c,s,i,o,l){var d=i-c,g=o-s,v=e(d*d+g*g),_=h(g,d),p=l.length,C=0,S=!0;for(n.save(),n.translate(c,s),n.moveTo(0,0),n.rotate(_),c=0;v>c;)c+=l[C++%p],c>v&&(c=v),n[S?"lineTo":"moveTo"](c,0),S=!S;n.restore()},createCanvasElement:function(){return u.document.createElement("canvas")},copyCanvasElement:function(n){var c=u.util.createCanvasElement();return c.width=n.width,c.height=n.height,c.getContext("2d").drawImage(n,0,0),c},toDataURL:function(n,c,s){return n.toDataURL("image/"+c,s)},createImage:function(){return u.document.createElement("img")},clipContext:function(n,c){c.save(),c.beginPath(),n.clipTo(c),c.clip()},multiplyTransformMatrices:function(n,c,s){return[n[0]*c[0]+n[2]*c[1],n[1]*c[0]+n[3]*c[1],n[0]*c[2]+n[2]*c[3],n[1]*c[2]+n[3]*c[3],s?0:n[0]*c[4]+n[2]*c[5]+n[4],s?0:n[1]*c[4]+n[3]*c[5]+n[5]]},qrDecompose:function(n){var c=h(n[1],n[0]),s=r(n[0],2)+r(n[1],2),i=e(s),o=(n[0]*n[3]-n[2]*n[1])/i,l=h(n[0]*n[2]+n[1]*n[3],s);return{angle:c/t,scaleX:i,scaleY:o,skewX:l/t,skewY:0,translateX:n[4],translateY:n[5]}},calcRotateMatrix:function(n){if(!n.angle)return u.iMatrix.concat();var c=u.util.degreesToRadians(n.angle),s=u.util.cos(c),i=u.util.sin(c);return[s,i,-i,s,0,0]},calcDimensionsMatrix:function(n){var c=typeof n.scaleX>"u"?1:n.scaleX,s=typeof n.scaleY>"u"?1:n.scaleY,i=[n.flipX?-c:c,0,0,n.flipY?-s:s,0,0],o=u.util.multiplyTransformMatrices,l=u.util.degreesToRadians;return n.skewX&&(i=o(i,[1,0,Math.tan(l(n.skewX)),1],!0)),n.skewY&&(i=o(i,[1,Math.tan(l(n.skewY)),0,1],!0)),i},composeMatrix:function(n){var c=[1,0,0,1,n.translateX||0,n.translateY||0],s=u.util.multiplyTransformMatrices;return n.angle&&(c=s(c,u.util.calcRotateMatrix(n))),(n.scaleX||n.scaleY||n.skewX||n.skewY||n.flipX||n.flipY)&&(c=s(c,u.util.calcDimensionsMatrix(n))),c},customTransformMatrix:function(n,c,s){return u.util.composeMatrix({scaleX:n,scaleY:c,skewX:s})},resetObjectTransform:function(n){n.scaleX=1,n.scaleY=1,n.skewX=0,n.skewY=0,n.flipX=!1,n.flipY=!1,n.rotate(0)},saveObjectTransform:function(n){return{scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,angle:n.angle,left:n.left,flipX:n.flipX,flipY:n.flipY,top:n.top}},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,c,s,i){i>0&&(c>i?c-=i:c=0,s>i?s-=i:s=0);var o=!0,l,d,g=n.getImageData(c,s,i*2||1,i*2||1),v=g.data.length;for(l=3;l<v&&(d=g.data[l],o=d<=0,o!==!1);l+=4);return g=null,o},parsePreserveAspectRatioAttribute:function(n){var c="meet",s="Mid",i="Mid",o=n.split(" "),l;return o&&o.length&&(c=o.pop(),c!=="meet"&&c!=="slice"?(l=c,c="meet"):o.length&&(l=o.pop())),s=l!=="none"?l.slice(1,4):"none",i=l!=="none"?l.slice(5,8):"none",{meetOrSlice:c,alignX:s,alignY:i}},clearFabricFontCache:function(n){n=(n||"").toLowerCase(),n?u.charWidthsCache[n]&&delete u.charWidthsCache[n]:u.charWidthsCache={}},limitDimsByArea:function(n,c){var s=Math.sqrt(c*n),i=Math.floor(c/s);return{x:Math.floor(s),y:i}},capValue:function(n,c,s){return Math.max(n,Math.min(c,s))},findScaleToFit:function(n,c){return Math.min(c.width/n.width,c.height/n.height)},findScaleToCover:function(n,c){return Math.max(c.width/n.width,c.height/n.height)},matrixToSVG:function(n){return"matrix("+n.map(function(c){return u.util.toFixed(c,u.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"}}}(m),function(){var f=Array.prototype.join;function e(a,n,c,s,i,o,l){var d=f.call(arguments);if(u.arcToSegmentsCache[d])return u.arcToSegmentsCache[d];var g=Math.PI,v=l*g/180,_=u.util.sin(v),p=u.util.cos(v),C=0,S=0;c=Math.abs(c),s=Math.abs(s);var O=-p*a*.5-_*n*.5,k=-p*n*.5+_*a*.5,P=c*c,F=s*s,E=k*k,X=O*O,z=P*F-P*E-F*X,V=0;if(z<0){var J=Math.sqrt(1-z/(P*F));c*=J,s*=J}else V=(i===o?-1:1)*Math.sqrt(z/(P*E+F*X));var T=V*c*k/s,j=-V*s*O/c,R=p*T-_*j+a*.5,I=_*T+p*j+n*.5,K=r(1,0,(O-T)/c,(k-j)/s),M=r((O-T)/c,(k-j)/s,(-O-T)/c,(-k-j)/s);o===0&&M>0?M-=2*g:o===1&&M<0&&(M+=2*g);for(var A=Math.ceil(Math.abs(M/g*2)),L=[],B=M/A,W=8/3*Math.sin(B/4)*Math.sin(B/4)/Math.sin(B/2),Y=K+B,U=0;U<A;U++)L[U]=h(K,Y,p,_,c,s,R,I,W,C,S),C=L[U][4],S=L[U][5],K=Y,Y+=B;return u.arcToSegmentsCache[d]=L,L}function h(a,n,c,s,i,o,l,d,g,v,_){var p=u.util.cos(a),C=u.util.sin(a),S=u.util.cos(n),O=u.util.sin(n),k=c*i*S-s*o*O+l,P=s*i*S+c*o*O+d,F=v+g*(-c*i*C-s*o*p),E=_+g*(-s*i*C+c*o*p),X=k+g*(c*i*O+s*o*S),z=P+g*(s*i*O-c*o*S);return[F,E,X,z,k,P]}function r(a,n,c,s){var i=Math.atan2(n,a),o=Math.atan2(s,c);return o>=i?o-i:2*Math.PI-(i-o)}u.util.drawArc=function(a,n,c,s){for(var i=s[0],o=s[1],l=s[2],d=s[3],g=s[4],v=s[5],_=s[6],p=[[],[],[],[]],C=e(v-n,_-c,i,o,d,g,l),S=0,O=C.length;S<O;S++)p[S][0]=C[S][0]+n,p[S][1]=C[S][1]+c,p[S][2]=C[S][2]+n,p[S][3]=C[S][3]+c,p[S][4]=C[S][4]+n,p[S][5]=C[S][5]+c,a.bezierCurveTo.apply(a,p[S])},u.util.getBoundsOfArc=function(a,n,c,s,i,o,l,d,g){for(var v=0,_=0,p,C=[],S=e(d-a,g-n,c,s,o,l,i),O=0,k=S.length;O<k;O++)p=t(v,_,S[O][0],S[O][1],S[O][2],S[O][3],S[O][4],S[O][5]),C.push({x:p[0].x+a,y:p[0].y+n}),C.push({x:p[1].x+a,y:p[1].y+n}),v=S[O][4],_=S[O][5];return C};function t(a,n,c,s,i,o,l,d){var g;if(u.cachesBoundsOfCurve&&(g=f.call(arguments),u.boundsOfCurveCache[g]))return u.boundsOfCurveCache[g];var v=Math.sqrt,_=Math.min,p=Math.max,C=Math.abs,S=[],O=[[],[]],k,P,F,E,X,z,V,J;P=6*a-12*c+6*i,k=-3*a+9*c-9*i+3*l,F=3*c-3*a;for(var T=0;T<2;++T){if(T>0&&(P=6*n-12*s+6*o,k=-3*n+9*s-9*o+3*d,F=3*s-3*n),C(k)<1e-12){if(C(P)<1e-12)continue;E=-F/P,0<E&&E<1&&S.push(E);continue}V=P*P-4*F*k,!(V<0)&&(J=v(V),X=(-P+J)/(2*k),0<X&&X<1&&S.push(X),z=(-P-J)/(2*k),0<z&&z<1&&S.push(z))}for(var j,R,I=S.length,K=I,M;I--;)E=S[I],M=1-E,j=M*M*M*a+3*M*M*E*c+3*M*E*E*i+E*E*E*l,O[0][I]=j,R=M*M*M*n+3*M*M*E*s+3*M*E*E*o+E*E*E*d,O[1][I]=R;O[0][K]=a,O[1][K]=n,O[0][K+1]=l,O[1][K+1]=d;var A=[{x:_.apply(null,O[0]),y:_.apply(null,O[1])},{x:p.apply(null,O[0]),y:p.apply(null,O[1])}];return u.cachesBoundsOfCurve&&(u.boundsOfCurveCache[g]=A),A}u.util.getBoundsOfCurve=t}(),function(){var f=Array.prototype.slice;function e(n,c){for(var s=f.call(arguments,2),i=[],o=0,l=n.length;o<l;o++)i[o]=s.length?n[o][c].apply(n[o],s):n[o][c].call(n[o]);return i}function h(n,c){return a(n,c,function(s,i){return s>=i})}function r(n,c){return a(n,c,function(s,i){return s<i})}function t(n,c){for(var s=n.length;s--;)n[s]=c;return n}function a(n,c,s){if(!(!n||n.length===0)){var i=n.length-1,o=c?n[i][c]:n[i];if(c)for(;i--;)s(n[i][c],o)&&(o=n[i][c]);else for(;i--;)s(n[i],o)&&(o=n[i]);return o}}u.util.array={fill:t,invoke:e,min:r,max:h}}(),function(){function f(h,r,t){if(t)if(!u.isLikelyNode&&r instanceof Element)h=r;else if(r instanceof Array){h=[];for(var a=0,n=r.length;a<n;a++)h[a]=f({},r[a],t)}else if(r&&typeof r=="object")for(var c in r)c==="canvas"?h[c]=f({},r[c]):r.hasOwnProperty(c)&&(h[c]=f({},r[c],t));else h=r;else for(var c in r)h[c]=r[c];return h}function e(h,r){return f({},h,r)}u.util.object={extend:f,clone:e},u.util.object.extend(u.util,u.Observable)}(),function(){function f(a){return a.replace(/-+(.)?/g,function(n,c){return c?c.toUpperCase():""})}function e(a,n){return a.charAt(0).toUpperCase()+(n?a.slice(1):a.slice(1).toLowerCase())}function h(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(a){var n=0,c,s=[];for(n=0,c;n<a.length;n++)(c=t(a,n))!==!1&&s.push(c);return s}function t(a,n){var c=a.charCodeAt(n);if(isNaN(c))return"";if(c<55296||c>57343)return a.charAt(n);if(55296<=c&&c<=56319){if(a.length<=n+1)throw"High surrogate without following low surrogate";var s=a.charCodeAt(n+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return a.charAt(n)+a.charAt(n+1)}if(n===0)throw"Low surrogate without preceding high surrogate";var i=a.charCodeAt(n-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}u.util.string={camelize:f,capitalize:e,escapeXml:h,graphemeSplit:r}}(),function(){var f=Array.prototype.slice,e=function(){},h=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),r=function(c,s,i){for(var o in s)o in c.prototype&&typeof c.prototype[o]=="function"&&(s[o]+"").indexOf("callSuper")>-1?c.prototype[o]=function(l){return function(){var d=this.constructor.superclass;this.constructor.superclass=i;var g=s[l].apply(this,arguments);if(this.constructor.superclass=d,l!=="initialize")return g}}(o):c.prototype[o]=s[o],h&&(s.toString!==Object.prototype.toString&&(c.prototype.toString=s.toString),s.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=s.valueOf))};function t(){}function a(c){for(var s=null,i=this;i.constructor.superclass;){var o=i.constructor.superclass.prototype[c];if(i[c]!==o){s=o;break}i=i.constructor.superclass.prototype}return s?arguments.length>1?s.apply(this,f.call(arguments,1)):s.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}function n(){var c=null,s=f.call(arguments,0);typeof s[0]=="function"&&(c=s.shift());function i(){this.initialize.apply(this,arguments)}i.superclass=c,i.subclasses=[],c&&(t.prototype=c.prototype,i.prototype=new t,c.subclasses.push(i));for(var o=0,l=s.length;o<l;o++)r(i,s[o],c);return i.prototype.initialize||(i.prototype.initialize=e),i.prototype.constructor=i,i.prototype.callSuper=a,i}u.util.createClass=n}(),function(){var f=!!u.document.createElement("div").attachEvent;u.util.addListener=function(h,r,t,a){h&&h.addEventListener(r,t,f?!1:a)},u.util.removeListener=function(h,r,t,a){h&&h.removeEventListener(r,t,f?!1:a)};function e(h){var r=h.changedTouches;return r&&r[0]?r[0]:h}u.util.getPointer=function(h){var r=h.target,t=u.util.getScrollLeftTop(r),a=e(h);return{x:a.clientX+t.left,y:a.clientY+t.top}}}(),function(){function f(n,c){var s=n.style;if(!s)return n;if(typeof c=="string")return n.style.cssText+=";"+c,c.indexOf("opacity")>-1?a(n,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):n;for(var i in c)if(i==="opacity")a(n,c[i]);else{var o=i==="float"||i==="cssFloat"?typeof s.styleFloat>"u"?"cssFloat":"styleFloat":i;s[o]=c[i]}return n}var e=u.document.createElement("div"),h=typeof e.style.opacity=="string",r=typeof e.style.filter=="string",t=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(n){return n};h?a=function(n,c){return n.style.opacity=c,n}:r&&(a=function(n,c){var s=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(s.zoom=1),t.test(s.filter)?(c=c>=.9999?"":"alpha(opacity="+c*100+")",s.filter=s.filter.replace(t,c)):s.filter+=" alpha(opacity="+c*100+")",n}),u.util.setStyle=f}(),function(){var f=Array.prototype.slice;function e(d){return typeof d=="string"?u.document.getElementById(d):d}var h,r=function(d){return f.call(d,0)};try{h=r(u.document.childNodes)instanceof Array}catch{}h||(r=function(d){for(var g=new Array(d.length),v=d.length;v--;)g[v]=d[v];return g});function t(d,g){var v=u.document.createElement(d);for(var _ in g)_==="class"?v.className=g[_]:_==="for"?v.htmlFor=g[_]:v.setAttribute(_,g[_]);return v}function a(d,g){d&&(" "+d.className+" ").indexOf(" "+g+" ")===-1&&(d.className+=(d.className?" ":"")+g)}function n(d,g,v){return typeof g=="string"&&(g=t(g,v)),d.parentNode&&d.parentNode.replaceChild(g,d),g.appendChild(d),g}function c(d){for(var g=0,v=0,_=u.document.documentElement,p=u.document.body||{scrollLeft:0,scrollTop:0};d&&(d.parentNode||d.host)&&(d=d.parentNode||d.host,d===u.document?(g=p.scrollLeft||_.scrollLeft||0,v=p.scrollTop||_.scrollTop||0):(g+=d.scrollLeft||0,v+=d.scrollTop||0),!(d.nodeType===1&&d.style.position==="fixed")););return{left:g,top:v}}function s(d){var g,v=d&&d.ownerDocument,_={left:0,top:0},p={left:0,top:0},C,S={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!v)return p;for(var O in S)p[S[O]]+=parseInt(i(d,O),10)||0;return g=v.documentElement,typeof d.getBoundingClientRect<"u"&&(_=d.getBoundingClientRect()),C=c(d),{left:_.left+C.left-(g.clientLeft||0)+p.left,top:_.top+C.top-(g.clientTop||0)+p.top}}var i;u.document.defaultView&&u.document.defaultView.getComputedStyle?i=function(d,g){var v=u.document.defaultView.getComputedStyle(d,null);return v?v[g]:void 0}:i=function(d,g){var v=d.style[g];return!v&&d.currentStyle&&(v=d.currentStyle[g]),v},function(){var d=u.document.documentElement.style,g="userSelect"in d?"userSelect":"MozUserSelect"in d?"MozUserSelect":"WebkitUserSelect"in d?"WebkitUserSelect":"KhtmlUserSelect"in d?"KhtmlUserSelect":"";function v(p){return typeof p.onselectstart<"u"&&(p.onselectstart=u.util.falseFunction),g?p.style[g]="none":typeof p.unselectable=="string"&&(p.unselectable="on"),p}function _(p){return typeof p.onselectstart<"u"&&(p.onselectstart=null),g?p.style[g]="":typeof p.unselectable=="string"&&(p.unselectable=""),p}u.util.makeElementUnselectable=v,u.util.makeElementSelectable=_}(),function(){function d(g,v){var _=u.document.getElementsByTagName("head")[0],p=u.document.createElement("script"),C=!0;p.onload=p.onreadystatechange=function(S){if(C){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;C=!1,v(S||u.window.event),p=p.onload=p.onreadystatechange=null}},p.src=g,_.appendChild(p)}u.util.getScript=d}();function o(d){var g=u.jsdomImplForWrapper(d);return g._canvas||g._image}function l(d){if(u.isLikelyNode){var g=u.jsdomImplForWrapper(d);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}u.util.getById=e,u.util.toArray=r,u.util.makeElement=t,u.util.addClass=a,u.util.wrapElement=n,u.util.getScrollLeftTop=c,u.util.getElementOffset=s,u.util.getElementStyle=i,u.util.getNodeCanvas=o,u.util.cleanUpJsdomNode=l}(),function(){function f(r,t){return r+(/\?/.test(r)?"&":"?")+t}function e(){}function h(r,t){t||(t={});var a=t.method?t.method.toUpperCase():"GET",n=t.onComplete||function(){},c=new u.window.XMLHttpRequest,s=t.body||t.parameters;return c.onreadystatechange=function(){c.readyState===4&&(n(c),c.onreadystatechange=e)},a==="GET"&&(s=null,typeof t.parameters=="string"&&(r=f(r,t.parameters))),c.open(a,r,!0),(a==="POST"||a==="PUT")&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.send(s),c}u.util.request=h}(),u.log=console.log,u.warn=console.warn,function(){function f(){return!1}function e(c,s,i,o){return-i*Math.cos(c/o*(Math.PI/2))+i+s}function h(c){a(function(s){c||(c={});var i=s||+new Date,o=c.duration||500,l=i+o,d,g=c.onChange||f,v=c.abort||f,_=c.onComplete||f,p=c.easing||e,C="startValue"in c?c.startValue:0,S="endValue"in c?c.endValue:100,O=c.byValue||S-C;c.onStart&&c.onStart(),function k(P){d=P||+new Date;var F=d>l?o:d-i,E=F/o,X=p(F,C,O,o),z=Math.abs((X-C)/O);if(v()){_(S,1,1);return}if(d>l){g(S,1,1),_(S,1,1);return}else g(X,z,E),a(k)}(i)})}var r=u.window.requestAnimationFrame||u.window.webkitRequestAnimationFrame||u.window.mozRequestAnimationFrame||u.window.oRequestAnimationFrame||u.window.msRequestAnimationFrame||function(c){return u.window.setTimeout(c,1e3/60)},t=u.window.cancelAnimationFrame||u.window.clearTimeout;function a(){return r.apply(u.window,arguments)}function n(){return t.apply(u.window,arguments)}u.util.animate=h,u.util.requestAnimFrame=a,u.util.cancelAnimFrame=n}(),function(){function f(h,r,t){var a="rgba("+parseInt(h[0]+t*(r[0]-h[0]),10)+","+parseInt(h[1]+t*(r[1]-h[1]),10)+","+parseInt(h[2]+t*(r[2]-h[2]),10);return a+=","+(h&&r?parseFloat(h[3]+t*(r[3]-h[3])):1),a+=")",a}function e(h,r,t,a){var n=new u.Color(h).getSource(),c=new u.Color(r).getSource();a=a||{},u.util.animate(u.util.object.extend(a,{duration:t||500,startValue:n,endValue:c,byValue:c,easing:function(s,i,o,l){var d=a.colorEasing?a.colorEasing(s,l):1-Math.cos(s/l*(Math.PI/2));return f(i,o,d)}}))}u.util.animateColor=e}(),function(){function f(T,j,R,I){return T<Math.abs(j)?(T=j,I=R/4):j===0&&T===0?I=R/(2*Math.PI)*Math.asin(1):I=R/(2*Math.PI)*Math.asin(j/T),{a:T,c:j,p:R,s:I}}function e(T,j,R){return T.a*Math.pow(2,10*(j-=1))*Math.sin((j*R-T.s)*(2*Math.PI)/T.p)}function h(T,j,R,I){return R*((T=T/I-1)*T*T+1)+j}function r(T,j,R,I){return T/=I/2,T<1?R/2*T*T*T+j:R/2*((T-=2)*T*T+2)+j}function t(T,j,R,I){return R*(T/=I)*T*T*T+j}function a(T,j,R,I){return-R*((T=T/I-1)*T*T*T-1)+j}function n(T,j,R,I){return T/=I/2,T<1?R/2*T*T*T*T+j:-R/2*((T-=2)*T*T*T-2)+j}function c(T,j,R,I){return R*(T/=I)*T*T*T*T+j}function s(T,j,R,I){return R*((T=T/I-1)*T*T*T*T+1)+j}function i(T,j,R,I){return T/=I/2,T<1?R/2*T*T*T*T*T+j:R/2*((T-=2)*T*T*T*T+2)+j}function o(T,j,R,I){return-R*Math.cos(T/I*(Math.PI/2))+R+j}function l(T,j,R,I){return R*Math.sin(T/I*(Math.PI/2))+j}function d(T,j,R,I){return-R/2*(Math.cos(Math.PI*T/I)-1)+j}function g(T,j,R,I){return T===0?j:R*Math.pow(2,10*(T/I-1))+j}function v(T,j,R,I){return T===I?j+R:R*(-Math.pow(2,-10*T/I)+1)+j}function _(T,j,R,I){return T===0?j:T===I?j+R:(T/=I/2,T<1?R/2*Math.pow(2,10*(T-1))+j:R/2*(-Math.pow(2,-10*--T)+2)+j)}function p(T,j,R,I){return-R*(Math.sqrt(1-(T/=I)*T)-1)+j}function C(T,j,R,I){return R*Math.sqrt(1-(T=T/I-1)*T)+j}function S(T,j,R,I){return T/=I/2,T<1?-R/2*(Math.sqrt(1-T*T)-1)+j:R/2*(Math.sqrt(1-(T-=2)*T)+1)+j}function O(T,j,R,I){var K=1.70158,M=0,A=R;if(T===0)return j;if(T/=I,T===1)return j+R;M||(M=I*.3);var L=f(A,R,M,K);return-e(L,T,I)+j}function k(T,j,R,I){var K=1.70158,M=0,A=R;if(T===0)return j;if(T/=I,T===1)return j+R;M||(M=I*.3);var L=f(A,R,M,K);return L.a*Math.pow(2,-10*T)*Math.sin((T*I-L.s)*(2*Math.PI)/L.p)+L.c+j}function P(T,j,R,I){var K=1.70158,M=0,A=R;if(T===0)return j;if(T/=I/2,T===2)return j+R;M||(M=I*(.3*1.5));var L=f(A,R,M,K);return T<1?-.5*e(L,T,I)+j:L.a*Math.pow(2,-10*(T-=1))*Math.sin((T*I-L.s)*(2*Math.PI)/L.p)*.5+L.c+j}function F(T,j,R,I,K){return K===void 0&&(K=1.70158),R*(T/=I)*T*((K+1)*T-K)+j}function E(T,j,R,I,K){return K===void 0&&(K=1.70158),R*((T=T/I-1)*T*((K+1)*T+K)+1)+j}function X(T,j,R,I,K){return K===void 0&&(K=1.70158),T/=I/2,T<1?R/2*(T*T*(((K*=1.525)+1)*T-K))+j:R/2*((T-=2)*T*(((K*=1.525)+1)*T+K)+2)+j}function z(T,j,R,I){return R-V(I-T,0,R,I)+j}function V(T,j,R,I){return(T/=I)<1/2.75?R*(7.5625*T*T)+j:T<2/2.75?R*(7.5625*(T-=1.5/2.75)*T+.75)+j:T<2.5/2.75?R*(7.5625*(T-=2.25/2.75)*T+.9375)+j:R*(7.5625*(T-=2.625/2.75)*T+.984375)+j}function J(T,j,R,I){return T<I/2?z(T*2,0,R,I)*.5+j:V(T*2-I,0,R,I)*.5+R*.5+j}u.util.ease={easeInQuad:function(T,j,R,I){return R*(T/=I)*T+j},easeOutQuad:function(T,j,R,I){return-R*(T/=I)*(T-2)+j},easeInOutQuad:function(T,j,R,I){return T/=I/2,T<1?R/2*T*T+j:-R/2*(--T*(T-2)-1)+j},easeInCubic:function(T,j,R,I){return R*(T/=I)*T*T+j},easeOutCubic:h,easeInOutCubic:r,easeInQuart:t,easeOutQuart:a,easeInOutQuart:n,easeInQuint:c,easeOutQuint:s,easeInOutQuint:i,easeInSine:o,easeOutSine:l,easeInOutSine:d,easeInExpo:g,easeOutExpo:v,easeInOutExpo:_,easeInCirc:p,easeOutCirc:C,easeInOutCirc:S,easeInElastic:O,easeOutElastic:k,easeInOutElastic:P,easeInBack:F,easeOutBack:E,easeInOutBack:X,easeInBounce:z,easeOutBounce:V,easeInOutBounce:J}}(),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t=e.util.toFixed,a=e.util.parseUnit,n=e.util.multiplyTransformMatrices,c=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],s=["symbol","image","marker","pattern","view","svg"],i=["pattern","defs","symbol","metadata","clipPath","mask","desc"],o=["symbol","g","a","svg","clipPath","defs"],l={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform"},d={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",v="clip-path";e.svgValidTagNamesRegEx=C(c),e.svgViewBoxElementsRegEx=C(s),e.svgInvalidAncestorsRegEx=C(i),e.svgValidParentsRegEx=C(o),e.cssRules={},e.gradientDefs={},e.clipPaths={};function _(M){return M in l?l[M]:M}function p(M,A,L,B){var W=Object.prototype.toString.call(A)==="[object Array]",Y;if((M==="fill"||M==="stroke")&&A==="none")A="";else if(M==="vector-effect")A=A==="non-scaling-stroke";else if(M==="strokeDashArray")A==="none"?A=null:A=A.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(M==="transformMatrix")L&&L.transformMatrix?A=n(L.transformMatrix,e.parseTransformAttribute(A)):A=e.parseTransformAttribute(A);else if(M==="visible")A=A!=="none"&&A!=="hidden",L&&L.visible===!1&&(A=!1);else if(M==="opacity")A=parseFloat(A),L&&typeof L.opacity<"u"&&(A*=L.opacity);else if(M==="textAnchor")A=A==="start"?"left":A==="end"?"right":"center";else if(M==="charSpacing")Y=a(A,B)/B*1e3;else if(M==="paintFirst"){var U=A.indexOf("fill"),G=A.indexOf("stroke"),A="fill";(U>-1&&G>-1&&G<U||U===-1&&G>-1)&&(A="stroke")}else{if(M==="href"||M==="xlink:href")return A;Y=W?A.map(a):a(A,B)}return!W&&isNaN(Y)?A:Y}function C(M){return new RegExp("^("+M.join("|")+")\\b","i")}function S(M){for(var A in d)if(!(typeof M[d[A]]>"u"||M[A]==="")){if(typeof M[A]>"u"){if(!e.Object.prototype[A])continue;M[A]=e.Object.prototype[A]}if(M[A].indexOf("url(")!==0){var L=new e.Color(M[A]);M[A]=L.setAlpha(t(L.getAlpha()*M[d[A]],2)).toRgba()}}return M}function O(M,A){var L,B=[],W,Y,U;for(Y=0,U=A.length;Y<U;Y++)L=A[Y],W=M.getElementsByTagName(L),B=B.concat(Array.prototype.slice.call(W));return B}e.parseTransformAttribute=function(){function M(Q,rt){var lt=e.util.cos(rt[0]),dt=e.util.sin(rt[0]),Yt=0,jt=0;rt.length===3&&(Yt=rt[1],jt=rt[2]),Q[0]=lt,Q[1]=dt,Q[2]=-dt,Q[3]=lt,Q[4]=Yt-(lt*Yt-dt*jt),Q[5]=jt-(dt*Yt+lt*jt)}function A(Q,rt){var lt=rt[0],dt=rt.length===2?rt[1]:rt[0];Q[0]=lt,Q[3]=dt}function L(Q,rt,lt){Q[lt]=Math.tan(e.util.degreesToRadians(rt[0]))}function B(Q,rt){Q[4]=rt[0],rt.length===2&&(Q[5]=rt[1])}var W=e.iMatrix,Y=e.reNum,U="(?:\\s+,?\\s*|,\\s*)",G="(?:(skewX)\\s*\\(\\s*("+Y+")\\s*\\))",Z="(?:(skewY)\\s*\\(\\s*("+Y+")\\s*\\))",tt="(?:(rotate)\\s*\\(\\s*("+Y+")(?:"+U+"("+Y+")"+U+"("+Y+"))?\\s*\\))",ot="(?:(scale)\\s*\\(\\s*("+Y+")(?:"+U+"("+Y+"))?\\s*\\))",et="(?:(translate)\\s*\\(\\s*("+Y+")(?:"+U+"("+Y+"))?\\s*\\))",it="(?:(matrix)\\s*\\(\\s*("+Y+")"+U+"("+Y+")"+U+"("+Y+")"+U+"("+Y+")"+U+"("+Y+")"+U+"("+Y+")\\s*\\))",nt="(?:"+it+"|"+et+"|"+ot+"|"+tt+"|"+G+"|"+Z+")",st="(?:"+nt+"(?:"+U+"*"+nt+")*)",ft="^\\s*(?:"+st+"?)\\s*$",Pt=new RegExp(ft),$t=new RegExp(nt,"g");return function(Q){var rt=W.concat(),lt=[];if(!Q||Q&&!Pt.test(Q))return rt;Q.replace($t,function(Yt){var jt=new RegExp(nt).exec(Yt).filter(function(He){return!!He}),Ge=jt[1],At=jt.slice(2).map(parseFloat);switch(Ge){case"translate":B(rt,At);break;case"rotate":At[0]=e.util.degreesToRadians(At[0]),M(rt,At);break;case"scale":A(rt,At);break;case"skewX":L(rt,At,2);break;case"skewY":L(rt,At,1);break;case"matrix":rt=At;break}lt.push(rt.concat()),rt=W.concat()});for(var dt=lt[0];lt.length>1;)lt.shift(),dt=e.util.multiplyTransformMatrices(dt,lt[0]);return dt}}();function k(M,A){var L,B;M.replace(/;\s*$/,"").split(";").forEach(function(W){var Y=W.split(":");L=Y[0].trim().toLowerCase(),B=Y[1].trim(),A[L]=B})}function P(M,A){var L,B;for(var W in M)typeof M[W]>"u"||(L=W.toLowerCase(),B=M[W],A[L]=B)}function F(M,A){var L={};for(var B in e.cssRules[A])if(E(M,B.split(" ")))for(var W in e.cssRules[A][B])L[W]=e.cssRules[A][B][W];return L}function E(M,A){var L,B=!0;return L=z(M,A.pop()),L&&A.length&&(B=X(M,A)),L&&B&&A.length===0}function X(M,A){for(var L,B=!0;M.parentNode&&M.parentNode.nodeType===1&&A.length;)B&&(L=A.pop()),M=M.parentNode,B=z(M,L);return A.length===0}function z(M,A){var L=M.nodeName,B=M.getAttribute("class"),W=M.getAttribute("id"),Y,U;if(Y=new RegExp("^"+L,"i"),A=A.replace(Y,""),W&&A.length&&(Y=new RegExp("#"+W+"(?![a-zA-Z\\-]+)","i"),A=A.replace(Y,"")),B&&A.length)for(B=B.split(" "),U=B.length;U--;)Y=new RegExp("\\."+B[U]+"(?![a-zA-Z\\-]+)","i"),A=A.replace(Y,"");return A.length===0}function V(M,A){var L;if(M.getElementById&&(L=M.getElementById(A)),L)return L;var B,W,Y,U=M.getElementsByTagName("*");for(W=0,Y=U.length;W<Y;W++)if(B=U[W],A===B.getAttribute("id"))return B}function J(M){for(var A=O(M,["use","svg:use"]),L=0;A.length&&L<A.length;){var B=A[L],W=(B.getAttribute("xlink:href")||B.getAttribute("href")).substr(1),Y=B.getAttribute("x")||0,U=B.getAttribute("y")||0,G=V(M,W).cloneNode(!0),Z=(G.getAttribute("transform")||"")+" translate("+Y+", "+U+")",tt,ot=A.length,et,it,nt,st,ft=e.svgNS;if(j(G),/^svg$/i.test(G.nodeName)){var Pt=G.ownerDocument.createElementNS(ft,"g");for(it=0,nt=G.attributes,st=nt.length;it<st;it++)et=nt.item(it),Pt.setAttributeNS(ft,et.nodeName,et.nodeValue);for(;G.firstChild;)Pt.appendChild(G.firstChild);G=Pt}for(it=0,nt=B.attributes,st=nt.length;it<st;it++)et=nt.item(it),!(et.nodeName==="x"||et.nodeName==="y"||et.nodeName==="xlink:href"||et.nodeName==="href")&&(et.nodeName==="transform"?Z=et.nodeValue+" "+Z:G.setAttribute(et.nodeName,et.nodeValue));G.setAttribute("transform",Z),G.setAttribute("instantiated_by_use","1"),G.removeAttribute("id"),tt=B.parentNode,tt.replaceChild(G,B),A.length===ot&&L++}}var T=new RegExp("^\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*,?\\s*("+e.reNum+"+)\\s*$");function j(M){var A=M.getAttribute("viewBox"),L=1,B=1,W=0,Y=0,U,G,Z,tt,ot=M.getAttribute("width"),et=M.getAttribute("height"),it=M.getAttribute("x")||0,nt=M.getAttribute("y")||0,st=M.getAttribute("preserveAspectRatio")||"",ft=!A||!e.svgViewBoxElementsRegEx.test(M.nodeName)||!(A=A.match(T)),Pt=!ot||!et||ot==="100%"||et==="100%",$t=ft&&Pt,Q={},rt="",lt=0,dt=0;if(Q.width=0,Q.height=0,Q.toBeParsed=$t,$t)return Q;if(ft)return Q.width=a(ot),Q.height=a(et),Q;if(W=-parseFloat(A[1]),Y=-parseFloat(A[2]),U=parseFloat(A[3]),G=parseFloat(A[4]),Q.minX=W,Q.minY=Y,Q.viewBoxWidth=U,Q.viewBoxHeight=G,Pt?(Q.width=U,Q.height=G):(Q.width=a(ot),Q.height=a(et),L=Q.width/U,B=Q.height/G),st=e.util.parsePreserveAspectRatioAttribute(st),st.alignX!=="none"&&(st.meetOrSlice==="meet"&&(B=L=L>B?B:L),st.meetOrSlice==="slice"&&(B=L=L>B?L:B),lt=Q.width-U*L,dt=Q.height-G*L,st.alignX==="Mid"&&(lt/=2),st.alignY==="Mid"&&(dt/=2),st.alignX==="Min"&&(lt=0),st.alignY==="Min"&&(dt=0)),L===1&&B===1&&W===0&&Y===0&&it===0&&nt===0)return Q;if((it||nt)&&(rt=" translate("+a(it)+" "+a(nt)+") "),Z=rt+" matrix("+L+" 0 0 "+B+" "+(W*L+lt)+" "+(Y*B+dt)+") ",Q.viewboxTransform=e.parseTransformAttribute(Z),M.nodeName==="svg"){for(tt=M.ownerDocument.createElementNS(e.svgNS,"g");M.firstChild;)tt.appendChild(M.firstChild);M.appendChild(tt)}else tt=M,Z=tt.getAttribute("transform")+Z;return tt.setAttribute("transform",Z),Q}function R(M,A){for(;M&&(M=M.parentNode);)if(M.nodeName&&A.test(M.nodeName.replace("svg:",""))&&!M.getAttribute("instantiated_by_use"))return!0;return!1}e.parseSVGDocument=function(M,A,L,B){if(M){J(M);var W=e.Object.__uid++,Y,U,G=j(M),Z=e.util.toArray(M.getElementsByTagName("*"));if(G.crossOrigin=B&&B.crossOrigin,G.svgUid=W,Z.length===0&&e.isLikelyNode){Z=M.selectNodes('//*[name(.)!="svg"]');var tt=[];for(Y=0,U=Z.length;Y<U;Y++)tt[Y]=Z[Y];Z=tt}var ot=Z.filter(function(it){return j(it),e.svgValidTagNamesRegEx.test(it.nodeName.replace("svg:",""))&&!R(it,e.svgInvalidAncestorsRegEx)});if(!ot||ot&&!ot.length){A&&A([],{});return}var et={};Z.filter(function(it){return it.nodeName.replace("svg:","")==="clipPath"}).forEach(function(it){var nt=it.getAttribute("id");et[nt]=e.util.toArray(it.getElementsByTagName("*")).filter(function(st){return e.svgValidTagNamesRegEx.test(st.nodeName.replace("svg:",""))})}),e.gradientDefs[W]=e.getGradientDefs(M),e.cssRules[W]=e.getCSSRules(M),e.clipPaths[W]=et,e.parseElements(ot,function(it,nt){A&&(A(it,G,nt,Z),delete e.gradientDefs[W],delete e.cssRules[W],delete e.clipPaths[W])},r(G),L,B)}};function I(M,A){var L=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],B="xlink:href",W=A.getAttribute(B).substr(1),Y=V(M,W);if(Y&&Y.getAttribute(B)&&I(M,Y),L.forEach(function(G){Y&&!A.hasAttribute(G)&&Y.hasAttribute(G)&&A.setAttribute(G,Y.getAttribute(G))}),!A.children.length)for(var U=Y.cloneNode(!0);U.firstChild;)A.appendChild(U.firstChild);A.removeAttribute(B)}var K=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+e.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+e.reNum+"))?\\s+(.*)");h(e,{parseFontDeclaration:function(M,A){var L=M.match(K);if(L){var B=L[1],W=L[3],Y=L[4],U=L[5],G=L[6];B&&(A.fontStyle=B),W&&(A.fontWeight=isNaN(parseFloat(W))?W:parseFloat(W)),Y&&(A.fontSize=a(Y)),G&&(A.fontFamily=G),U&&(A.lineHeight=U==="normal"?1:U)}},getGradientDefs:function(M){var A=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],L=O(M,A),B,W=0,Y={};for(W=L.length;W--;)B=L[W],B.getAttribute("xlink:href")&&I(M,B),Y[B.getAttribute("id")]=B;return Y},parseAttributes:function(M,A,L){if(M){var B,W={},Y,U;typeof L>"u"&&(L=M.getAttribute("svgUid")),M.parentNode&&e.svgValidParentsRegEx.test(M.parentNode.nodeName)&&(W=e.parseAttributes(M.parentNode,A,L));var G=A.reduce(function(st,ft){return B=M.getAttribute(ft),B&&(st[ft]=B),st},{}),Z=h(F(M,L),e.parseStyleAttribute(M));G=h(G,Z),Z[v]&&M.setAttribute(v,Z[v]),Y=U=W.fontSize||e.Text.DEFAULT_SVG_FONT_SIZE,G[g]&&(G[g]=Y=a(G[g],U));var tt,ot,et={};for(var it in G)tt=_(it),ot=p(tt,G[it],W,Y),et[tt]=ot;et&&et.font&&e.parseFontDeclaration(et.font,et);var nt=h(W,et);return e.svgValidParentsRegEx.test(M.nodeName)?nt:S(nt)}},parseElements:function(M,A,L,B,W){new e.ElementsParser(M,A,L,B,W).parse()},parseStyleAttribute:function(M){var A={},L=M.getAttribute("style");return L&&(typeof L=="string"?k(L,A):P(L,A)),A},parsePointsAttribute:function(M){if(!M)return null;M=M.replace(/,/g," ").trim(),M=M.split(/\s+/);var A=[],L,B;for(L=0,B=M.length;L<B;L+=2)A.push({x:parseFloat(M[L]),y:parseFloat(M[L+1])});return A},getCSSRules:function(M){var A=M.getElementsByTagName("style"),L,B,W={},Y;for(L=0,B=A.length;L<B;L++){var U=A[L].textContent||"";U=U.replace(/\/\*[\s\S]*?\*\//g,""),U.trim()!==""&&(Y=U.match(/[^{]*\{[\s\S]*?\}/g),Y=Y.map(function(G){return G.trim()}),Y.forEach(function(G){var Z=G.match(/([\s\S]*?)\s*\{([^}]*)\}/),tt={},ot=Z[2].trim(),et=ot.replace(/;$/,"").split(/\s*;\s*/);for(L=0,B=et.length;L<B;L++){var it=et[L].split(/\s*:\s*/),nt=it[0],st=it[1];tt[nt]=st}G=Z[1],G.split(",").forEach(function(ft){ft=ft.replace(/^svg/i,"").trim(),ft!==""&&(W[ft]?e.util.object.extend(W[ft],tt):W[ft]=e.util.object.clone(tt))})}))}return W},loadSVGFromURL:function(M,A,L,B){M=M.replace(/^\n\s*/,"").trim(),new e.util.request(M,{method:"get",onComplete:W});function W(Y){var U=Y.responseXML;if(U&&!U.documentElement&&e.window.ActiveXObject&&Y.responseText&&(U=new ActiveXObject("Microsoft.XMLDOM"),U.async="false",U.loadXML(Y.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),!U||!U.documentElement)return A&&A(null),!1;e.parseSVGDocument(U.documentElement,function(G,Z,tt,ot){A&&A(G,Z,tt,ot)},L,B)}},loadSVGFromString:function(M,A,L,B){M=M.trim();var W;if(typeof e.window.DOMParser<"u"){var Y=new e.window.DOMParser;Y&&Y.parseFromString&&(W=Y.parseFromString(M,"text/xml"))}else e.window.ActiveXObject&&(W=new ActiveXObject("Microsoft.XMLDOM"),W.async="false",W.loadXML(M.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));e.parseSVGDocument(W.documentElement,function(U,G,Z,tt){A(U,G,Z,tt)},L,B)}})}(m),u.ElementsParser=function(f,e,h,r,t,a){this.elements=f,this.callback=e,this.options=h,this.reviver=r,this.svgUid=h&&h.svgUid||0,this.parsingOptions=t,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(f){f.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},f.createObjects=function(){var e=this;this.elements.forEach(function(h,r){h.setAttribute("svgUid",e.svgUid),e.createObject(h,r)})},f.findTag=function(e){return u[u.util.string.capitalize(e.tagName.replace("svg:",""))]},f.createObject=function(e,h){var r=this.findTag(e);if(r&&r.fromElement)try{r.fromElement(e,this.createCallback(h,e),this.options)}catch(t){u.log(t)}else this.checkIfDone()},f.createCallback=function(e,h){var r=this;return function(t){var a;r.resolveGradient(t,h,"fill"),r.resolveGradient(t,h,"stroke"),t instanceof u.Image&&t._originalElement&&(a=t.parsePreserveAspectRatioAttribute(h)),t._removeTransformMatrix(a),r.resolveClipPath(t,h),r.reviver&&r.reviver(h,t),r.instances[e]=t,r.checkIfDone()}},f.extractPropertyDefinition=function(e,h,r){var t=e[h],a=this.regexUrl;if(a.test(t)){a.lastIndex=0;var n=a.exec(t)[1];return a.lastIndex=0,u[r][this.svgUid][n]}},f.resolveGradient=function(e,h,r){var t=this.extractPropertyDefinition(e,r,"gradientDefs");if(t){var a=h.getAttribute(r+"-opacity"),n=u.Gradient.fromElement(t,e,a,this.options);e.set(r,n)}},f.createClipPathCallback=function(e,h){return function(r){r._removeTransformMatrix(),r.fillRule=r.clipRule,h.push(r)}},f.resolveClipPath=function(e,h){var r=this.extractPropertyDefinition(e,"clipPath","clipPaths"),t,a,n,c,s,i;if(r){c=[],n=u.util.invertTransform(e.calcTransformMatrix());for(var o=r[0].parentNode,l=h;l.parentNode&&l.getAttribute("clip-path")!==e.clipPath;)l=l.parentNode;l.parentNode.appendChild(o);for(var d=0;d<r.length;d++)t=r[d],a=this.findTag(t),a.fromElement(t,this.createClipPathCallback(e,c),this.options);c.length===1?r=c[0]:r=new u.Group(c),s=u.util.multiplyTransformMatrices(n,r.calcTransformMatrix()),r.clipPath&&this.resolveClipPath(r,l);var i=u.util.qrDecompose(s);r.flipX=!1,r.flipY=!1,r.set("scaleX",i.scaleX),r.set("scaleY",i.scaleY),r.angle=i.angle,r.skewX=i.skewX,r.skewY=0,r.setPositionByOrigin({x:i.translateX,y:i.translateY},"center","center"),e.clipPath=r}else delete e.clipPath},f.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),this.callback(this.instances,this.elements))}}(u.ElementsParser.prototype),function(f){var e=f.fabric||(f.fabric={});if(e.Point){e.warn("fabric.Point is already defined");return}e.Point=h;function h(r,t){this.x=r,this.y=t}h.prototype={type:"point",constructor:h,add:function(r){return new h(this.x+r.x,this.y+r.y)},addEquals:function(r){return this.x+=r.x,this.y+=r.y,this},scalarAdd:function(r){return new h(this.x+r,this.y+r)},scalarAddEquals:function(r){return this.x+=r,this.y+=r,this},subtract:function(r){return new h(this.x-r.x,this.y-r.y)},subtractEquals:function(r){return this.x-=r.x,this.y-=r.y,this},scalarSubtract:function(r){return new h(this.x-r,this.y-r)},scalarSubtractEquals:function(r){return this.x-=r,this.y-=r,this},multiply:function(r){return new h(this.x*r,this.y*r)},multiplyEquals:function(r){return this.x*=r,this.y*=r,this},divide:function(r){return new h(this.x/r,this.y/r)},divideEquals:function(r){return this.x/=r,this.y/=r,this},eq:function(r){return this.x===r.x&&this.y===r.y},lt:function(r){return this.x<r.x&&this.y<r.y},lte:function(r){return this.x<=r.x&&this.y<=r.y},gt:function(r){return this.x>r.x&&this.y>r.y},gte:function(r){return this.x>=r.x&&this.y>=r.y},lerp:function(r,t){return typeof t>"u"&&(t=.5),t=Math.max(Math.min(1,t),0),new h(this.x+(r.x-this.x)*t,this.y+(r.y-this.y)*t)},distanceFrom:function(r){var t=this.x-r.x,a=this.y-r.y;return Math.sqrt(t*t+a*a)},midPointFrom:function(r){return this.lerp(r)},min:function(r){return new h(Math.min(this.x,r.x),Math.min(this.y,r.y))},max:function(r){return new h(Math.max(this.x,r.x),Math.max(this.y,r.y))},toString:function(){return this.x+","+this.y},setXY:function(r,t){return this.x=r,this.y=t,this},setX:function(r){return this.x=r,this},setY:function(r){return this.y=r,this},setFromPoint:function(r){return this.x=r.x,this.y=r.y,this},swap:function(r){var t=this.x,a=this.y;this.x=r.x,this.y=r.y,r.x=t,r.y=a},clone:function(){return new h(this.x,this.y)}}}(m),function(f){var e=f.fabric||(f.fabric={});if(e.Intersection){e.warn("fabric.Intersection is already defined");return}function h(r){this.status=r,this.points=[]}e.Intersection=h,e.Intersection.prototype={constructor:h,appendPoint:function(r){return this.points.push(r),this},appendPoints:function(r){return this.points=this.points.concat(r),this}},e.Intersection.intersectLineLine=function(r,t,a,n){var c,s=(n.x-a.x)*(r.y-a.y)-(n.y-a.y)*(r.x-a.x),i=(t.x-r.x)*(r.y-a.y)-(t.y-r.y)*(r.x-a.x),o=(n.y-a.y)*(t.x-r.x)-(n.x-a.x)*(t.y-r.y);if(o!==0){var l=s/o,d=i/o;0<=l&&l<=1&&0<=d&&d<=1?(c=new h("Intersection"),c.appendPoint(new e.Point(r.x+l*(t.x-r.x),r.y+l*(t.y-r.y)))):c=new h}else s===0||i===0?c=new h("Coincident"):c=new h("Parallel");return c},e.Intersection.intersectLinePolygon=function(r,t,a){var n=new h,c=a.length,s,i,o,l;for(l=0;l<c;l++)s=a[l],i=a[(l+1)%c],o=h.intersectLineLine(r,t,s,i),n.appendPoints(o.points);return n.points.length>0&&(n.status="Intersection"),n},e.Intersection.intersectPolygonPolygon=function(r,t){var a=new h,n=r.length,c;for(c=0;c<n;c++){var s=r[c],i=r[(c+1)%n],o=h.intersectLinePolygon(s,i,t);a.appendPoints(o.points)}return a.points.length>0&&(a.status="Intersection"),a},e.Intersection.intersectPolygonRectangle=function(r,t,a){var n=t.min(a),c=t.max(a),s=new e.Point(c.x,n.y),i=new e.Point(n.x,c.y),o=h.intersectLinePolygon(n,s,r),l=h.intersectLinePolygon(s,c,r),d=h.intersectLinePolygon(c,i,r),g=h.intersectLinePolygon(i,n,r),v=new h;return v.appendPoints(o.points),v.appendPoints(l.points),v.appendPoints(d.points),v.appendPoints(g.points),v.points.length>0&&(v.status="Intersection"),v}}(m),function(f){var e=f.fabric||(f.fabric={});if(e.Color){e.warn("fabric.Color is already defined.");return}function h(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}e.Color=h,e.Color.prototype={_tryParsingColor:function(t){var a;t in h.colorNameMap&&(t=h.colorNameMap[t]),t==="transparent"&&(a=[255,255,255,0]),a||(a=h.sourceFromHex(t)),a||(a=h.sourceFromRgb(t)),a||(a=h.sourceFromHsl(t)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(t,a,n){t/=255,a/=255,n/=255;var c,s,i,o=e.util.array.max([t,a,n]),l=e.util.array.min([t,a,n]);if(i=(o+l)/2,o===l)c=s=0;else{var d=o-l;switch(s=i>.5?d/(2-o-l):d/(o+l),o){case t:c=(a-n)/d+(a<n?6:0);break;case a:c=(n-t)/d+2;break;case n:c=(t-a)/d+4;break}c/=6}return[Math.round(c*360),Math.round(s*100),Math.round(i*100)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),a=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var t=this.getSource(),a=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+t[3]+")"},toHex:function(){var t=this.getSource(),a,n,c;return a=t[0].toString(16),a=a.length===1?"0"+a:a,n=t[1].toString(16),n=n.length===1?"0"+n:n,c=t[2].toString(16),c=c.length===1?"0"+c:c,a.toUpperCase()+n.toUpperCase()+c.toUpperCase()},toHexa:function(){var t=this.getSource(),a;return a=Math.round(t[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var a=this.getSource();return a[3]=t,this.setSource(a),this},toGrayscale:function(){var t=this.getSource(),a=parseInt((t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),10),n=t[3];return this.setSource([a,a,a,n]),this},toBlackWhite:function(t){var a=this.getSource(),n=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),c=a[3];return t=t||127,n=Number(n)<Number(t)?0:255,this.setSource([n,n,n,c]),this},overlayWith:function(t){t instanceof h||(t=new h(t));var a=[],n=this.getAlpha(),c=.5,s=this.getSource(),i=t.getSource(),o;for(o=0;o<3;o++)a.push(Math.round(s[o]*(1-c)+i[o]*c));return a[3]=n,this.setSource(a),this}},e.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,e.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,e.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,e.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function r(t,a,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(a-t)*6*n:n<1/2?a:n<2/3?t+(a-t)*(2/3-n)*6:t}e.Color.fromRgb=function(t){return h.fromSource(h.sourceFromRgb(t))},e.Color.sourceFromRgb=function(t){var a=t.match(h.reRGBa);if(a){var n=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),c=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),s=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(n,10),parseInt(c,10),parseInt(s,10),a[4]?parseFloat(a[4]):1]}},e.Color.fromRgba=h.fromRgb,e.Color.fromHsl=function(t){return h.fromSource(h.sourceFromHsl(t))},e.Color.sourceFromHsl=function(t){var a=t.match(h.reHSLa);if(a){var n=(parseFloat(a[1])%360+360)%360/360,c=parseFloat(a[2])/(/%$/.test(a[2])?100:1),s=parseFloat(a[3])/(/%$/.test(a[3])?100:1),i,o,l;if(c===0)i=o=l=s;else{var d=s<=.5?s*(c+1):s+c-s*c,g=s*2-d;i=r(g,d,n+1/3),o=r(g,d,n),l=r(g,d,n-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(l*255),a[4]?parseFloat(a[4]):1]}},e.Color.fromHsla=h.fromHsl,e.Color.fromHex=function(t){return h.fromSource(h.sourceFromHex(t))},e.Color.sourceFromHex=function(t){if(t.match(h.reHex)){var a=t.slice(t.indexOf("#")+1),n=a.length===3||a.length===4,c=a.length===8||a.length===4,s=n?a.charAt(0)+a.charAt(0):a.substring(0,2),i=n?a.charAt(1)+a.charAt(1):a.substring(2,4),o=n?a.charAt(2)+a.charAt(2):a.substring(4,6),l=c?n?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(s,16),parseInt(i,16),parseInt(o,16),parseFloat((parseInt(l,16)/255).toFixed(2))]}},e.Color.fromSource=function(t){var a=new h;return a.setSource(t),a}}(m),function(){function f(a,n){var c=a.getAttribute("style"),s=a.getAttribute("offset")||0,i,o,l,d;if(s=parseFloat(s)/(/%$/.test(s)?100:1),s=s<0?0:s>1?1:s,c){var g=c.split(/\s*;\s*/);for(g[g.length-1]===""&&g.pop(),d=g.length;d--;){var v=g[d].split(/\s*:\s*/),_=v[0].trim(),p=v[1].trim();_==="stop-color"?i=p:_==="stop-opacity"&&(l=p)}}return i||(i=a.getAttribute("stop-color")||"rgb(0,0,0)"),l||(l=a.getAttribute("stop-opacity")),i=new u.Color(i),o=i.getAlpha(),l=isNaN(parseFloat(l))?1:parseFloat(l),l*=o*n,{offset:s,color:i.toRgb(),opacity:l}}function e(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function h(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var r=u.util.object.clone;u.Gradient=u.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var n,c=this;Object.keys(a).forEach(function(s){c[s]=a[s]}),this.id?this.id+="_"+u.Object.__uid++:this.id=u.Object.__uid++,n={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(n.r1=a.coords.r1||0,n.r2=a.coords.r2||0),this.coords=n,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var n in a){var c=new u.Color(a[n]);this.colorStops.push({offset:parseFloat(n),color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var n={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return u.util.populateWithProperties(this,n,a),n},toSVG:function(a,o){var c=r(this.coords,!0),s,i,o=o||{},l,d,g=r(this.colorStops,!0),v=c.r1>c.r2,_=this.gradientTransform?this.gradientTransform.concat():u.iMatrix.concat(),p=-this.offsetX,C=-this.offsetY,S=!!o.additionalTransform,O=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(X,z){return X.offset-z.offset}),O==="objectBoundingBox"?(p/=a.width,C/=a.height):(p+=a.width/2,C+=a.height/2),a.type==="path"&&(p-=a.pathOffset.x,C-=a.pathOffset.y),_[4]-=p,_[5]-=C,d='id="SVGID_'+this.id+'" gradientUnits="'+O+'"',d+=' gradientTransform="'+(S?o.additionalTransform+" ":"")+u.util.matrixToSVG(_)+'" ',this.type==="linear"?l=["<linearGradient ",d,' x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`">
`]:this.type==="radial"&&(l=["<radialGradient ",d,' cx="',v?c.x1:c.x2,'" cy="',v?c.y1:c.y2,'" r="',v?c.r1:c.r2,'" fx="',v?c.x2:c.x1,'" fy="',v?c.y2:c.y1,`">
`]),this.type==="radial"){if(v)for(g=g.concat(),g.reverse(),s=0,i=g.length;s<i;s++)g[s].offset=1-g[s].offset;var k=Math.min(c.r1,c.r2);if(k>0){var P=Math.max(c.r1,c.r2),F=k/P;for(s=0,i=g.length;s<i;s++)g[s].offset+=F*(1-g[s].offset)}}for(s=0,i=g.length;s<i;s++){var E=g[s];l.push("<stop ",'offset="',E.offset*100+"%",'" style="stop-color:',E.color,typeof E.opacity<"u"?";stop-opacity: "+E.opacity:";",`"/>
`)}return l.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),l.join("")},toLive:function(a,n){var c,s=u.util.object.clone(this.coords),i,o,l=s.x1,d=s.y1,g=s.x2,v=s.y2,_=this.colorStops;if(this.type){for(n instanceof u.Text&&this.gradientUnits==="percentage"&&(l*=n.width,d*=n.height,g*=n.width,v*=n.height),this.type==="linear"?c=a.createLinearGradient(l,d,g,v):this.type==="radial"&&(c=a.createRadialGradient(l,d,s.r1,g,v,s.r2)),i=0,o=_.length;i<o;i++){var p=_[i].color,C=_[i].opacity,S=_[i].offset;typeof C<"u"&&(p=new u.Color(p).setAlpha(C).toRgba()),c.addColorStop(S,p)}return c}}}),u.util.object.extend(u.Gradient,{fromElement:function(a,n,c,s){var i=parseFloat(c)/(/%$/.test(c)?100:1);i=i<0?0:i>1?1:i,isNaN(i)&&(i=1);var o=a.getElementsByTagName("stop"),l,d=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",g=a.getAttribute("gradientTransform")||"",v=[],_,p,C=0,S=0,O;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(l="linear",_=e(a)):(l="radial",_=h(a)),p=o.length;p--;)v.push(f(o[p],i));O=u.parseTransformAttribute(g),t(n,_,s,d),d==="pixels"&&(C=-n.left,S=-n.top);var k=new u.Gradient({id:a.getAttribute("id"),type:l,coords:_,colorStops:v,gradientUnits:d,gradientTransform:O,offsetX:C,offsetY:S});return k},forObject:function(a,n){return n||(n={}),t(a,n.coords,n.gradientUnits,{viewBoxWidth:100,viewBoxHeight:100}),new u.Gradient(n)}});function t(a,n,c,s){var i,o;Object.keys(n).forEach(function(l){i=n[l],i==="Infinity"?o=1:i==="-Infinity"?o=0:(o=parseFloat(n[l],10),typeof i=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(i)&&(o*=.01,s==="pixels"&&((l==="x1"||l==="x2"||l==="r2")&&(o*=c.viewBoxWidth||c.width),(l==="y1"||l==="y2")&&(o*=c.viewBoxHeight||c.height)))),n[l]=o})}}(),function(){var f=u.util.toFixed;u.Pattern=u.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(e,h){if(e||(e={}),this.id=u.Object.__uid++,this.setOptions(e),!e.source||e.source&&typeof e.source!="string"){h&&h(this);return}if(typeof u.util.getFunctionBody(e.source)<"u")this.source=new Function(u.util.getFunctionBody(e.source)),h&&h(this);else{var r=this;this.source=u.util.createImage(),u.util.loadImage(e.source,function(t){r.source=t,h&&h(r)},null,this.crossOrigin)}},toObject:function(e){var h=u.Object.NUM_FRACTION_DIGITS,r,t;return typeof this.source=="function"?r=String(this.source):typeof this.source.src=="string"?r=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(r=this.source.toDataURL()),t={type:"pattern",source:r,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:f(this.offsetX,h),offsetY:f(this.offsetY,h),patternTransform:this.patternTransform?this.patternTransform.concat():null},u.util.populateWithProperties(this,t,e),t},toSVG:function(e){var h=typeof this.source=="function"?this.source():this.source,r=h.width/e.width,t=h.height/e.height,a=this.offsetX/e.width,n=this.offsetY/e.height,c="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(t=1,n&&(t+=Math.abs(n))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(r=1,a&&(r+=Math.abs(a))),h.src?c=h.src:h.toDataURL&&(c=h.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+n+'" width="'+r+'" height="'+t+`">
<image x="0" y="0" width="`+h.width+'" height="'+h.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(e){for(var h in e)this[h]=e[h]},toLive:function(e){var h=typeof this.source=="function"?this.source():this.source;return!h||typeof h.src<"u"&&(!h.complete||h.naturalWidth===0||h.naturalHeight===0)?"":e.createPattern(h,this.repeat)}})}(),function(f){var e=f.fabric||(f.fabric={}),h=e.util.toFixed;if(e.Shadow){e.warn("fabric.Shadow is already defined.");return}e.Shadow=e.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(r){typeof r=="string"&&(r=this._parseShadow(r));for(var t in r)this[t]=r[t];this.id=e.Object.__uid++},_parseShadow:function(r){var t=r.trim(),a=e.Shadow.reOffsetsAndBlur.exec(t)||[],n=t.replace(e.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:n.trim(),offsetX:parseInt(a[1],10)||0,offsetY:parseInt(a[2],10)||0,blur:parseInt(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(r){var t=40,a=40,n=e.Object.NUM_FRACTION_DIGITS,c=e.util.rotateVector({x:this.offsetX,y:this.offsetY},e.util.degreesToRadians(-r.angle)),s=20,i=new e.Color(this.color);return r.width&&r.height&&(t=h((Math.abs(c.x)+this.blur)/r.width,n)*100+s,a=h((Math.abs(c.y)+this.blur)/r.height,n)*100+s),r.flipX&&(c.x*=-1),r.flipY&&(c.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+t+'%" width="'+(100+2*t)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+h(this.blur?this.blur/2:0,n)+`"></feGaussianBlur>
	<feOffset dx="`+h(c.x,n)+'" dy="'+h(c.y,n)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+i.toRgb()+'" flood-opacity="'+i.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var r={},t=e.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==t[a]&&(r[a]=this[a])},this),r}}),e.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(m),function(){if(u.StaticCanvas){u.warn("fabric.StaticCanvas is already defined.");return}var f=u.util.object.extend,e=u.util.getElementOffset,h=u.util.removeFromArray,r=u.util.toFixed,t=u.util.transformPoint,a=u.util.invertTransform,n=u.util.getNodeCanvas,c=u.util.createCanvasElement,s=new Error("Could not initialize `canvas` element");u.StaticCanvas=u.util.createClass(u.CommonMethods,{initialize:function(i,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,o)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:u.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(i,o){var l=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(i),this._initOptions(o),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),o.overlayImage&&this.setOverlayImage(o.overlayImage,l),o.backgroundImage&&this.setBackgroundImage(o.backgroundImage,l),o.backgroundColor&&this.setBackgroundColor(o.backgroundColor,l),o.overlayColor&&this.setOverlayColor(o.overlayColor,l),this.calcOffset()},_isRetinaScaling:function(){return u.devicePixelRatio!==1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?u.devicePixelRatio:1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var i=u.devicePixelRatio;this.__initRetinaScaling(i,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(i,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(i,o,l){o.setAttribute("width",this.width*i),o.setAttribute("height",this.height*i),l.scale(i,i)},calcOffset:function(){return this._offset=e(this.lowerCanvasEl),this},setOverlayImage:function(i,o,l){return this.__setBgOverlayImage("overlayImage",i,o,l)},setBackgroundImage:function(i,o,l){return this.__setBgOverlayImage("backgroundImage",i,o,l)},setOverlayColor:function(i,o){return this.__setBgOverlayColor("overlayColor",i,o)},setBackgroundColor:function(i,o){return this.__setBgOverlayColor("backgroundColor",i,o)},_setImageSmoothing:function(){var i=this.getContext();i.imageSmoothingEnabled=i.imageSmoothingEnabled||i.webkitImageSmoothingEnabled||i.mozImageSmoothingEnabled||i.msImageSmoothingEnabled||i.oImageSmoothingEnabled,i.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(i,o,l,d){return typeof o=="string"?u.util.loadImage(o,function(g){if(g){var v=new u.Image(g,d);this[i]=v,v.canvas=this}l&&l(g)},this,d&&d.crossOrigin):(d&&o.setOptions(d),this[i]=o,o&&(o.canvas=this),l&&l(o)),this},__setBgOverlayColor:function(i,o,l){return this[i]=o,this._initGradient(o,i),this._initPattern(o,i,l),this},_createCanvasElement:function(){var i=c();if(!i||(i.style||(i.style={}),typeof i.getContext>"u"))throw s;return i},_initOptions:function(i){var o=this.lowerCanvasEl;this._setOptions(i),this.width=this.width||parseInt(o.width,10)||0,this.height=this.height||parseInt(o.height,10)||0,this.lowerCanvasEl.style&&(o.width=this.width,o.height=this.height,o.style.width=this.width+"px",o.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(i){i&&i.getContext?this.lowerCanvasEl=i:this.lowerCanvasEl=u.util.getById(i)||this._createCanvasElement(),u.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(i,o){return this.setDimensions({width:i},o)},setHeight:function(i,o){return this.setDimensions({height:i},o)},setDimensions:function(i,o){var l;o=o||{};for(var d in i)l=i[d],o.cssOnly||(this._setBackstoreDimension(d,i[d]),l+="px",this.hasLostContext=!0),o.backstoreOnly||this._setCssDimension(d,l);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),o.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(i,o){return this.lowerCanvasEl[i]=o,this.upperCanvasEl&&(this.upperCanvasEl[i]=o),this.cacheCanvasEl&&(this.cacheCanvasEl[i]=o),this[i]=o,this},_setCssDimension:function(i,o){return this.lowerCanvasEl.style[i]=o,this.upperCanvasEl&&(this.upperCanvasEl.style[i]=o),this.wrapperEl&&(this.wrapperEl.style[i]=o),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(i){var o=this._activeObject,l,d=!1,g=!0,v,_;for(this.viewportTransform=i,v=0,_=this._objects.length;v<_;v++)l=this._objects[v],l.group||l.setCoords(d,g);return o&&o.type==="activeSelection"&&o.setCoords(d,g),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(i,o){var l=i,d=this.viewportTransform.slice(0);i=t(i,a(this.viewportTransform)),d[0]=o,d[3]=o;var g=t(i,d);return d[4]+=l.x-g.x,d[5]+=l.y-g.y,this.setViewportTransform(d)},setZoom:function(i){return this.zoomToPoint(new u.Point(0,0),i),this},absolutePan:function(i){var o=this.viewportTransform.slice(0);return o[4]=-i.x,o[5]=-i.y,this.setViewportTransform(o)},relativePan:function(i){return this.absolutePan(new u.Point(-i.x-this.viewportTransform[4],-i.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(i){this.stateful&&i.setupState(),i._set("canvas",this),i.setCoords(),this.fire("object:added",{target:i}),i.fire("added")},_onObjectRemoved:function(i){this.fire("object:removed",{target:i}),i.fire("removed"),delete i.canvas},clearContext:function(i){return i.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var i=this.contextContainer;return this.renderCanvas(i,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=u.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var i={},o=this.width,l=this.height,d=a(this.viewportTransform);return i.tl=t({x:0,y:0},d),i.br=t({x:o,y:l},d),i.tr=new u.Point(i.br.x,i.tl.y),i.bl=new u.Point(i.tl.x,i.br.y),this.vptCoords=i,i},cancelRequestedRender:function(){this.isRendering&&(u.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(i,o){var l=this.viewportTransform,d=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(i),this.fire("before:render",{ctx:i}),this.clipTo&&u.util.clipContext(this,i),this._renderBackground(i),i.save(),i.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._renderObjects(i,o),i.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.clipTo&&i.restore(),d&&(d.canvas=this,d.shouldCache(),d._transformDone=!0,d.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(i)),this._renderOverlay(i),this.controlsAboveOverlay&&this.interactive&&this.drawControls(i),this.fire("after:render",{ctx:i})},drawClipPathOnCanvas:function(i){var o=this.viewportTransform,l=this.clipPath;i.save(),i.transform(o[0],o[1],o[2],o[3],o[4],o[5]),i.globalCompositeOperation="destination-in",l.transform(i),i.scale(1/l.zoomX,1/l.zoomY),i.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),i.restore()},_renderObjects:function(i,o){var l,d;for(l=0,d=o.length;l<d;++l)o[l]&&o[l].render(i)},_renderBackgroundOrOverlay:function(i,o){var l=this[o+"Color"],d=this[o+"Image"],g=this.viewportTransform,v=this[o+"Vpt"];if(!(!l&&!d)){if(l){i.save(),i.beginPath(),i.moveTo(0,0),i.lineTo(this.width,0),i.lineTo(this.width,this.height),i.lineTo(0,this.height),i.closePath(),i.fillStyle=l.toLive?l.toLive(i,this):l,v&&i.transform(g[0],g[1],g[2],g[3],g[4],g[5]),i.transform(1,0,0,1,l.offsetX||0,l.offsetY||0);var _=l.gradientTransform||l.patternTransform;_&&i.transform(_[0],_[1],_[2],_[3],_[4],_[5]),i.fill(),i.restore()}d&&(i.save(),v&&i.transform(g[0],g[1],g[2],g[3],g[4],g[5]),d.render(i),i.restore())}},_renderBackground:function(i){this._renderBackgroundOrOverlay(i,"background")},_renderOverlay:function(i){this._renderBackgroundOrOverlay(i,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(i){return this._centerObject(i,new u.Point(this.getCenter().left,i.getCenterPoint().y))},centerObjectV:function(i){return this._centerObject(i,new u.Point(i.getCenterPoint().x,this.getCenter().top))},centerObject:function(i){var o=this.getCenter();return this._centerObject(i,new u.Point(o.left,o.top))},viewportCenterObject:function(i){var o=this.getVpCenter();return this._centerObject(i,o)},viewportCenterObjectH:function(i){var o=this.getVpCenter();return this._centerObject(i,new u.Point(o.x,i.getCenterPoint().y)),this},viewportCenterObjectV:function(i){var o=this.getVpCenter();return this._centerObject(i,new u.Point(i.getCenterPoint().x,o.y))},getVpCenter:function(){var i=this.getCenter(),o=a(this.viewportTransform);return t({x:i.left,y:i.top},o)},_centerObject:function(i,o){return i.setPositionByOrigin(o,"center","center"),i.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(i){return this.toDatalessObject(i)},toObject:function(i){return this._toObjectMethod("toObject",i)},toDatalessObject:function(i){return this._toObjectMethod("toDatalessObject",i)},_toObjectMethod:function(i,o){var l=this.clipPath,d={version:u.version,objects:this._toObjects(i,o)};return l&&(d.clipPath=this._toObject(this.clipPath,i,o)),f(d,this.__serializeBgOverlay(i,o)),u.util.populateWithProperties(this,d,o),d},_toObjects:function(i,o){return this._objects.filter(function(l){return!l.excludeFromExport}).map(function(l){return this._toObject(l,i,o)},this)},_toObject:function(i,o,l){var d;this.includeDefaultValues||(d=i.includeDefaultValues,i.includeDefaultValues=!1);var g=i[o](l);return this.includeDefaultValues||(i.includeDefaultValues=d),g},__serializeBgOverlay:function(i,o){var l={},d=this.backgroundImage,g=this.overlayImage;return this.backgroundColor&&(l.background=this.backgroundColor.toObject?this.backgroundColor.toObject(o):this.backgroundColor),this.overlayColor&&(l.overlay=this.overlayColor.toObject?this.overlayColor.toObject(o):this.overlayColor),d&&!d.excludeFromExport&&(l.backgroundImage=this._toObject(d,i,o)),g&&!g.excludeFromExport&&(l.overlayImage=this._toObject(g,i,o)),l},svgViewportTransformation:!0,toSVG:function(i,o){i||(i={}),i.reviver=o;var l=[];return this._setSVGPreamble(l,i),this._setSVGHeader(l,i),this.clipPath&&l.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(l,"background"),this._setSVGBgOverlayImage(l,"backgroundImage",o),this._setSVGObjects(l,o),this.clipPath&&l.push(`</g>
`),this._setSVGBgOverlayColor(l,"overlay"),this._setSVGBgOverlayImage(l,"overlayImage",o),l.push("</svg>"),l.join("")},_setSVGPreamble:function(i,o){o.suppressPreamble||i.push('<?xml version="1.0" encoding="',o.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(i,o){var l=o.width||this.width,d=o.height||this.height,g,v='viewBox="0 0 '+this.width+" "+this.height+'" ',_=u.Object.NUM_FRACTION_DIGITS;o.viewBox?v='viewBox="'+o.viewBox.x+" "+o.viewBox.y+" "+o.viewBox.width+" "+o.viewBox.height+'" ':this.svgViewportTransformation&&(g=this.viewportTransform,v='viewBox="'+r(-g[4]/g[0],_)+" "+r(-g[5]/g[3],_)+" "+r(this.width/g[0],_)+" "+r(this.height/g[3],_)+'" '),i.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',l,'" ','height="',d,'" ',v,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",u.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(o),`</defs>
`)},createSVGClipPathMarkup:function(i){var o=this.clipPath;return o?(o.clipPathId="CLIPPATH_"+u.Object.__uid++,'<clipPath id="'+o.clipPathId+`" >
`+this.clipPath.toClipPathSVG(i.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var i=this,o=["background","overlay"].map(function(l){var d=i[l+"Color"];if(d&&d.toLive){var g=i[l+"Vpt"],v=i.viewportTransform,_={width:i.width/(g?v[0]:1),height:i.height/(g?v[3]:1)};return d.toSVG(_,{additionalTransform:g?u.util.matrixToSVG(v):""})}});return o.join("")},createSVGFontFacesMarkup:function(){var i="",o={},l,d,g,v,_,p,C,S,O,k=u.fontPaths,P=[];for(this._objects.forEach(function E(X){P.push(X),X._objects&&X._objects.forEach(E)}),S=0,O=P.length;S<O;S++)if(l=P[S],d=l.fontFamily,!(l.type.indexOf("text")===-1||o[d]||!k[d])&&(o[d]=!0,!!l.styles)){g=l.styles;for(_ in g){v=g[_];for(C in v)p=v[C],d=p.fontFamily,!o[d]&&k[d]&&(o[d]=!0)}}for(var F in o)i+=[`		@font-face {
`,"			font-family: '",F,`';
`,"			src: url('",k[F],`');
`,`		}
`].join("");return i&&(i=['	<style type="text/css">',`<![CDATA[
`,i,"]]>",`</style>
`].join("")),i},_setSVGObjects:function(i,o){var l,d,g,v=this._objects;for(d=0,g=v.length;d<g;d++)l=v[d],!l.excludeFromExport&&this._setSVGObject(i,l,o)},_setSVGObject:function(i,o,l){i.push(o.toSVG(l))},_setSVGBgOverlayImage:function(i,o,l){this[o]&&!this[o].excludeFromExport&&this[o].toSVG&&i.push(this[o].toSVG(l))},_setSVGBgOverlayColor:function(i,o){var l=this[o+"Color"],d=this.viewportTransform,g=this.width,v=this.height;if(l)if(l.toLive){var _=l.repeat,p=u.util.invertTransform(d),C=this[o+"Vpt"],S=C?u.util.matrixToSVG(p):"";i.push('<rect transform="'+S+" translate(",g/2,",",v/2,')"',' x="',l.offsetX-g/2,'" y="',l.offsetY-v/2,'" ','width="',_==="repeat-y"||_==="no-repeat"?l.source.width:g,'" height="',_==="repeat-x"||_==="no-repeat"?l.source.height:v,'" fill="url(#SVGID_'+l.id+')"',`></rect>
`)}else i.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',l,'"',`></rect>
`)},sendToBack:function(i){if(!i)return this;var o=this._activeObject,l,d,g;if(i===o&&i.type==="activeSelection")for(g=o._objects,l=g.length;l--;)d=g[l],h(this._objects,d),this._objects.unshift(d);else h(this._objects,i),this._objects.unshift(i);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(i){if(!i)return this;var o=this._activeObject,l,d,g;if(i===o&&i.type==="activeSelection")for(g=o._objects,l=0;l<g.length;l++)d=g[l],h(this._objects,d),this._objects.push(d);else h(this._objects,i),this._objects.push(i);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(i,o){if(!i)return this;var l=this._activeObject,d,g,v,_,p,C=0;if(i===l&&i.type==="activeSelection")for(p=l._objects,d=0;d<p.length;d++)g=p[d],v=this._objects.indexOf(g),v>0+C&&(_=v-1,h(this._objects,g),this._objects.splice(_,0,g)),C++;else v=this._objects.indexOf(i),v!==0&&(_=this._findNewLowerIndex(i,v,o),h(this._objects,i),this._objects.splice(_,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(i,o,l){var d,g;if(l)for(d=o,g=o-1;g>=0;--g){var v=i.intersectsWithObject(this._objects[g])||i.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(i);if(v){d=g;break}}else d=o-1;return d},bringForward:function(i,o){if(!i)return this;var l=this._activeObject,d,g,v,_,p,C=0;if(i===l&&i.type==="activeSelection")for(p=l._objects,d=p.length;d--;)g=p[d],v=this._objects.indexOf(g),v<this._objects.length-1-C&&(_=v+1,h(this._objects,g),this._objects.splice(_,0,g)),C++;else v=this._objects.indexOf(i),v!==this._objects.length-1&&(_=this._findNewUpperIndex(i,v,o),h(this._objects,i),this._objects.splice(_,0,i));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(i,o,l){var d,g,v;if(l)for(d=o,g=o+1,v=this._objects.length;g<v;++g){var _=i.intersectsWithObject(this._objects[g])||i.isContainedWithinObject(this._objects[g])||this._objects[g].isContainedWithinObject(i);if(_){d=g;break}}else d=o+1;return d},moveTo:function(i,o){return h(this._objects,i),this._objects.splice(o,0,i),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(u.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,u.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),f(u.StaticCanvas.prototype,u.Observable),f(u.StaticCanvas.prototype,u.Collection),f(u.StaticCanvas.prototype,u.DataURLExporter),f(u.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(i){var o=c();if(!o||!o.getContext)return null;var l=o.getContext("2d");if(!l)return null;switch(i){case"setLineDash":return typeof l.setLineDash<"u";default:return null}}}),u.StaticCanvas.prototype.toJSON=u.StaticCanvas.prototype.toObject,u.isLikelyNode&&(u.StaticCanvas.prototype.createPNGStream=function(){var i=n(this.lowerCanvasEl);return i&&i.createPNGStream()},u.StaticCanvas.prototype.createJPEGStream=function(i){var o=n(this.lowerCanvasEl);return o&&o.createJPEGStream(i)})}(),u.BaseBrush=u.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(f){return this.shadow=new u.Shadow(f),this},_setBrushStyles:function(){var f=this.canvas.contextTop;f.strokeStyle=this.color,f.lineWidth=this.width,f.lineCap=this.strokeLineCap,f.miterLimit=this.strokeMiterLimit,f.lineJoin=this.strokeLineJoin,u.StaticCanvas.supports("setLineDash")&&f.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(f){var e=this.canvas.viewportTransform;f.save(),f.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_setShadow:function(){if(this.shadow){var f=this.canvas,e=this.shadow,h=f.contextTop,r=f.getZoom();f&&f._isRetinaScaling()&&(r*=u.devicePixelRatio),h.shadowColor=e.color,h.shadowBlur=e.blur*r,h.shadowOffsetX=e.offsetX*r,h.shadowOffsetY=e.offsetY*r}},needsFullRender:function(){var f=new u.Color(this.color);return f.getAlpha()<1||!!this.shadow},_resetShadow:function(){var f=this.canvas.contextTop;f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0}}),function(){u.PencilBrush=u.util.createClass(u.BaseBrush,{decimate:.4,initialize:function(f){this.canvas=f,this._points=[]},_drawSegment:function(f,e,h){var r=e.midPointFrom(h);return f.quadraticCurveTo(e.x,e.y,r.x,r.y),r},onMouseDown:function(f,e){this.canvas._isMainEvent(e.e)&&(this._prepareForDrawing(f),this._captureDrawingPath(f),this._render())},onMouseMove:function(f,e){if(this.canvas._isMainEvent(e.e)&&this._captureDrawingPath(f)&&this._points.length>1)if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var h=this._points,r=h.length,t=this.canvas.contextTop;this._saveAndTransform(t),this.oldEnd&&(t.beginPath(),t.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(t,h[r-2],h[r-1],!0),t.stroke(),t.restore()}},onMouseUp:function(f){return this.canvas._isMainEvent(f.e)?(this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(f){var e=new u.Point(f.x,f.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(f){return this._points.length>1&&f.eq(this._points[this._points.length-1])?!1:(this._points.push(f),!0)},_reset:function(){this._points=[],this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(f){var e=new u.Point(f.x,f.y);return this._addPoint(e)},_render:function(){var f=this.canvas.contextTop,e,h,r=this._points[0],t=this._points[1];if(this._saveAndTransform(f),f.beginPath(),this._points.length===2&&r.x===t.x&&r.y===t.y){var a=this.width/1e3;r=new u.Point(r.x,r.y),t=new u.Point(t.x,t.y),r.x-=a,t.x+=a}for(f.moveTo(r.x,r.y),e=1,h=this._points.length;e<h;e++)this._drawSegment(f,r,t),r=this._points[e],t=this._points[e+1];f.lineTo(r.x,r.y),f.stroke(),f.restore()},convertPointsToSVGPath:function(f){var e=[],h,r=this.width/1e3,t=new u.Point(f[0].x,f[0].y),a=new u.Point(f[1].x,f[1].y),n=f.length,c=1,s=0,i=n>2;for(i&&(c=f[2].x<a.x?-1:f[2].x===a.x?0:1,s=f[2].y<a.y?-1:f[2].y===a.y?0:1),e.push("M ",t.x-c*r," ",t.y-s*r," "),h=1;h<n;h++){if(!t.eq(a)){var o=t.midPointFrom(a);e.push("Q ",t.x," ",t.y," ",o.x," ",o.y," ")}t=f[h],h+1<f.length&&(a=f[h+1])}return i&&(c=t.x>f[h-2].x?1:t.x===f[h-2].x?0:-1,s=t.y>f[h-2].y?1:t.y===f[h-2].y?0:-1),e.push("L ",t.x+c*r," ",t.y+s*r),e},createPath:function(f){var e=new u.Path(f,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},decimatePoints:function(f,e){if(f.length<=2)return f;var h=this.canvas.getZoom(),r=Math.pow(e/h,2),t,a=f.length-1,n=f[0],c=[n],s;for(t=1;t<a;t++)s=Math.pow(n.x-f[t].x,2)+Math.pow(n.y-f[t].y,2),s>=r&&(n=f[t],c.push(n));return c.length===1&&c.push(new u.Point(c[0].x,c[0].y)),c},_finalizeAndAddPath:function(){var f=this.canvas.contextTop;f.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var e=this.convertPointsToSVGPath(this._points).join("");if(e==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.requestRenderAll();return}var h=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(h),this.canvas.requestRenderAll(),h.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:h})}})}(),u.CircleBrush=u.util.createClass(u.BaseBrush,{width:10,initialize:function(f){this.canvas=f,this.points=[]},drawDot:function(f){var e=this.addPoint(f),h=this.canvas.contextTop;this._saveAndTransform(h),this.dot(h,e),h.restore()},dot:function(f,e){f.fillStyle=e.fill,f.beginPath(),f.arc(e.x,e.y,e.radius,0,Math.PI*2,!1),f.closePath(),f.fill()},onMouseDown:function(f){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(f)},_render:function(){var f=this.canvas.contextTop,e,h,r=this.points;for(this._saveAndTransform(f),e=0,h=r.length;e<h;e++)this.dot(f,r[e]);f.restore()},onMouseMove:function(f){this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(f),this._render()):this.drawDot(f)},onMouseUp:function(){var f=this.canvas.renderOnAddRemove,e,h;this.canvas.renderOnAddRemove=!1;var r=[];for(e=0,h=this.points.length;e<h;e++){var t=this.points[e],a=new u.Circle({radius:t.radius,left:t.x,top:t.y,originX:"center",originY:"center",fill:t.fill});this.shadow&&a.setShadow(this.shadow),r.push(a)}var n=new u.Group(r);n.canvas=this.canvas,this.canvas.add(n),this.canvas.fire("path:created",{path:n}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},addPoint:function(f){var e=new u.Point(f.x,f.y),h=u.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new u.Color(this.color).setAlpha(u.util.getRandomInt(0,100)/100).toRgba();return e.radius=h,e.fill=r,this.points.push(e),e}}),u.SprayBrush=u.util.createClass(u.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(f){this.canvas=f,this.sprayChunks=[]},onMouseDown:function(f){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(f),this.render(this.sprayChunkPoints)},onMouseMove:function(f){this.addSprayChunk(f),this.render(this.sprayChunkPoints)},onMouseUp:function(){var f=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],h=0,r=this.sprayChunks.length;h<r;h++)for(var t=this.sprayChunks[h],a=0,n=t.length;a<n;a++){var c=new u.Rect({width:t[a].width,height:t[a].width,left:t[a].x+1,top:t[a].y+1,originX:"center",originY:"center",fill:this.color});e.push(c)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var s=new u.Group(e);this.shadow&&s.setShadow(this.shadow),this.canvas.add(s),this.canvas.fire("path:created",{path:s}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},_getOptimizedRects:function(f){var e={},h,r,t;for(r=0,t=f.length;r<t;r++)h=f[r].left+""+f[r].top,e[h]||(e[h]=f[r]);var a=[];for(h in e)a.push(e[h]);return a},render:function(f){var e=this.canvas.contextTop,h,r;for(e.fillStyle=this.color,this._saveAndTransform(e),h=0,r=f.length;h<r;h++){var t=f[h];typeof t.opacity<"u"&&(e.globalAlpha=t.opacity),e.fillRect(t.x,t.y,t.width,t.width)}e.restore()},_render:function(){var f=this.canvas.contextTop,e,h;for(f.fillStyle=this.color,this._saveAndTransform(f),e=0,h=this.sprayChunks.length;e<h;e++)this.render(this.sprayChunks[e]);f.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var e,h,r,t=this.width/2,a;for(a=0;a<this.density;a++){e=u.util.getRandomInt(f.x-t,f.x+t),h=u.util.getRandomInt(f.y-t,f.y+t),this.dotWidthVariance?r=u.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):r=this.dotWidth;var n=new u.Point(e,h);n.width=r,this.randomOpacity&&(n.opacity=u.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(n)}this.sprayChunks.push(this.sprayChunkPoints)}}),u.PatternBrush=u.util.createClass(u.PencilBrush,{getPatternSrc:function(){var f=20,e=5,h=u.util.createCanvasElement(),r=h.getContext("2d");return h.width=h.height=f+e,r.fillStyle=this.color,r.beginPath(),r.arc(f/2,f/2,f/2,0,Math.PI*2,!1),r.closePath(),r.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(f){var e=this.callSuper("createPath",f),h=e._getLeftTopCoords().scalarAdd(e.strokeWidth/2);return e.stroke=new u.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-h.x,offsetY:-h.y}),e}}),function(){var f=u.util.getPointer,e=u.util.degreesToRadians,h=u.util.radiansToDegrees,r=Math.atan2,t=Math.abs,a=u.StaticCanvas.supports("setLineDash"),n=.5;u.Canvas=u.util.createClass(u.StaticCanvas,{initialize:function(s,i){i||(i={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(s,i),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=u.PencilBrush&&new u.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var s=this.getActiveObjects(),i,o,l;if(s.length>0&&!this.preserveObjectStacking){o=[],l=[];for(var d=0,g=this._objects.length;d<g;d++)i=this._objects[d],s.indexOf(i)===-1?o.push(i):l.push(i);s.length>1&&(this._activeObject._objects=l),o.push.apply(o,l)}else o=this._objects;return o},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var s=this.contextContainer;return this.renderCanvas(s,this._chooseObjectsToRender()),this},renderTopLayer:function(s){s.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(s),this.contextTopDirty=!0),s.restore()},renderTop:function(){var s=this.contextTop;return this.clearContext(s),this.renderTopLayer(s),this.fire("after:render"),this},_resetCurrentTransform:function(){var s=this._currentTransform;s.target.set({scaleX:s.original.scaleX,scaleY:s.original.scaleY,skewX:s.original.skewX,skewY:s.original.skewY,left:s.original.left,top:s.original.top}),this._shouldCenterTransform(s.target)?(s.originX!=="center"&&(s.originX==="right"?s.mouseXSign=-1:s.mouseXSign=1),s.originY!=="center"&&(s.originY==="bottom"?s.mouseYSign=-1:s.mouseYSign=1),s.originX="center",s.originY="center"):(s.originX=s.original.originX,s.originY=s.original.originY)},containsPoint:function(s,i,o){var l=!0,d=o||this.getPointer(s,l),g;return i.group&&i.group===this._activeObject&&i.group.type==="activeSelection"?g=this._normalizePointer(i.group,d):g={x:d.x,y:d.y},i.containsPoint(g)||i._findTargetCorner(d)},_normalizePointer:function(s,i){var o=s.calcTransformMatrix(),l=u.util.invertTransform(o),d=this.restorePointerVpt(i);return u.util.transformPoint(d,l)},isTargetTransparent:function(s,i,o){if(s.shouldCache()&&s._cacheCanvas&&s!==this._activeObject){var l=this._normalizePointer(s,{x:i,y:o}),d=Math.max(s.cacheTranslationX+l.x*s.zoomX,0),g=Math.max(s.cacheTranslationY+l.y*s.zoomY,0),C=u.util.isTransparent(s._cacheContext,Math.round(d),Math.round(g),this.targetFindTolerance);return C}var v=this.contextCache,_=s.selectionBackgroundColor,p=this.viewportTransform;s.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(p[0],p[1],p[2],p[3],p[4],p[5]),s.render(v),v.restore(),s===this._activeObject&&s._renderControls(v,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),s.selectionBackgroundColor=_;var C=u.util.isTransparent(v,i,o,this.targetFindTolerance);return C},_isSelectionKeyPressed:function(s){var i=!1;return Object.prototype.toString.call(this.selectionKey)==="[object Array]"?i=!!this.selectionKey.find(function(o){return s[o]===!0}):i=s[this.selectionKey],i},_shouldClearSelection:function(s,i){var o=this.getActiveObjects(),l=this._activeObject;return!i||i&&l&&o.length>1&&o.indexOf(i)===-1&&l!==i&&!this._isSelectionKeyPressed(s)||i&&!i.evented||i&&!i.selectable&&l&&l!==i},_shouldCenterTransform:function(s){if(s){var i=this._currentTransform,o;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?o=this.centeredScaling||s.centeredScaling:i.action==="rotate"&&(o=this.centeredRotation||s.centeredRotation),o?!i.altKey:i.altKey}},_getOriginFromCorner:function(s,i){var o={x:s.originX,y:s.originY};return i==="ml"||i==="tl"||i==="bl"?o.x="right":(i==="mr"||i==="tr"||i==="br")&&(o.x="left"),i==="tl"||i==="mt"||i==="tr"?o.y="bottom":(i==="bl"||i==="mb"||i==="br")&&(o.y="top"),o},_getActionFromCorner:function(s,i,o){if(!i||!s)return"drag";switch(i){case"mtr":return"rotate";case"ml":case"mr":return o[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return o[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(s,i,o){if(i){var l=this.getPointer(s),d=i._findTargetCorner(this.getPointer(s,!0)),g=this._getActionFromCorner(o,d,s,i),v=this._getOriginFromCorner(i,d);this._currentTransform={target:i,action:g,corner:d,scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,offsetX:l.x-i.left,offsetY:l.y-i.top,originX:v.x,originY:v.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:e(i.angle),width:i.width*i.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:s.shiftKey,altKey:s[this.centeredKey],original:u.util.saveObjectTransform(i)},this._currentTransform.original.originX=v.x,this._currentTransform.original.originY=v.y,this._resetCurrentTransform(),this._beforeTransform(s)}},_translateObject:function(s,i){var o=this._currentTransform,l=o.target,d=s-o.offsetX,g=i-o.offsetY,v=!l.get("lockMovementX")&&l.left!==d,_=!l.get("lockMovementY")&&l.top!==g;return v&&l.set("left",d),_&&l.set("top",g),v||_},_changeSkewTransformOrigin:function(s,i,o){var l="originX",d={0:"center"},g=i.target.skewX,v="left",_="right",p=i.corner==="mt"||i.corner==="ml"?1:-1,C=1;s=s>0?1:-1,o==="y"&&(g=i.target.skewY,v="top",_="bottom",l="originY"),d[-1]=v,d[1]=_,i.target.flipX&&(C*=-1),i.target.flipY&&(C*=-1),g===0?(i.skewSign=-p*s*C,i[l]=d[-s]):(g=g>0?1:-1,i.skewSign=g,i[l]=d[g*p*C])},_skewObject:function(s,i,o){var l=this._currentTransform,d=l.target,g=!1,v=d.get("lockSkewingX"),_=d.get("lockSkewingY");if(v&&o==="x"||_&&o==="y")return!1;var p=d.getCenterPoint(),C=d.toLocalPoint(new u.Point(s,i),"center","center")[o],S=d.toLocalPoint(new u.Point(l.lastX,l.lastY),"center","center")[o],O,k,P=d._getTransformedDimensions();return this._changeSkewTransformOrigin(C-S,l,o),O=d.toLocalPoint(new u.Point(s,i),l.originX,l.originY)[o],k=d.translateToOriginPoint(p,l.originX,l.originY),g=this._setObjectSkew(O,l,o,P),l.lastX=s,l.lastY=i,d.setPositionByOrigin(k,l.originX,l.originY),g},_setObjectSkew:function(s,i,o,l){var d=i.target,g,v=!1,_=i.skewSign,p,C,S,O,k,P,F,E;return o==="x"?(S="y",O="Y",k="X",F=0,E=d.skewY):(S="x",O="X",k="Y",F=d.skewX,E=0),C=d._getTransformedDimensions(F,E),P=2*Math.abs(s)-C[o],P<=2?g=0:(g=_*Math.atan(P/d["scale"+k]/(C[S]/d["scale"+O])),g=u.util.radiansToDegrees(g)),v=d["skew"+k]!==g,d.set("skew"+k,g),d["skew"+O]!==0&&(p=d._getTransformedDimensions(),g=l[S]/p[S]*d["scale"+O],d.set("scale"+O,g)),v},_scaleObject:function(s,i,o){var l=this._currentTransform,d=l.target,g=d.lockScalingX,v=d.lockScalingY,_=d.lockScalingFlip;if(g&&v)return!1;var p=d.translateToOriginPoint(d.getCenterPoint(),l.originX,l.originY),C=d.toLocalPoint(new u.Point(s,i),l.originX,l.originY),S=d._getTransformedDimensions(),O=!1;return this._setLocalMouse(C,l),O=this._setObjectScale(C,l,g,v,o,_,S),d.setPositionByOrigin(p,l.originX,l.originY),O},_setObjectScale:function(s,i,o,l,d,g,v){var _=i.target,p=!1,C=!1,S=!1,O=s.x*_.scaleX/v.x,k=s.y*_.scaleY/v.y,P=_.scaleX!==O,F=_.scaleY!==k;if(i.newScaleX=O,i.newScaleY=k,u.Textbox&&d==="x"&&_ instanceof u.Textbox){var E=_.width*(s.x/v.x);return E>=_.getMinWidth()?(S=E!==_.width,_.set("width",E),S):!1}return g&&O<=0&&O<_.scaleX&&(p=!0,s.x=0),g&&k<=0&&k<_.scaleY&&(C=!0,s.y=0),d==="equally"&&!o&&!l?S=this._scaleObjectEqually(s,_,i,v):d?d==="x"&&!_.get("lockUniScaling")?p||o||_.set("scaleX",O)&&(S=P):d==="y"&&!_.get("lockUniScaling")&&(C||l||_.set("scaleY",k)&&(S=F)):(p||o||_.set("scaleX",O)&&(S=S||P),C||l||_.set("scaleY",k)&&(S=S||F)),p||C||this._flipObject(i,d),S},_scaleObjectEqually:function(s,i,o,l){var d=s.y+s.x,g=l.y*o.original.scaleY/i.scaleY+l.x*o.original.scaleX/i.scaleX,v,_=s.x<0?-1:1,p=s.y<0?-1:1,C,S;return C=_*Math.abs(o.original.scaleX*d/g),S=p*Math.abs(o.original.scaleY*d/g),v=C!==i.scaleX||S!==i.scaleY,i.set("scaleX",C),i.set("scaleY",S),v},_flipObject:function(s,i){s.newScaleX<0&&i!=="y"&&(s.originX==="left"?s.originX="right":s.originX==="right"&&(s.originX="left")),s.newScaleY<0&&i!=="x"&&(s.originY==="top"?s.originY="bottom":s.originY==="bottom"&&(s.originY="top"))},_setLocalMouse:function(s,i){var o=i.target,l=this.getZoom(),d=o.padding/l;i.originX==="right"?s.x*=-1:i.originX==="center"&&(s.x*=i.mouseXSign*2,s.x<0&&(i.mouseXSign=-i.mouseXSign)),i.originY==="bottom"?s.y*=-1:i.originY==="center"&&(s.y*=i.mouseYSign*2,s.y<0&&(i.mouseYSign=-i.mouseYSign)),t(s.x)>d?s.x<0?s.x+=d:s.x-=d:s.x=0,t(s.y)>d?s.y<0?s.y+=d:s.y-=d:s.y=0},_rotateObject:function(s,i){var o=this._currentTransform,l=o.target,d,d=l.translateToOriginPoint(l.getCenterPoint(),o.originX,o.originY);if(l.lockRotation)return!1;var g=r(o.ey-d.y,o.ex-d.x),v=r(i-d.y,s-d.x),_=h(v-g+o.theta),p=!0;if(l.snapAngle>0){var C=l.snapAngle,S=l.snapThreshold||C,O=Math.ceil(_/C)*C,k=Math.floor(_/C)*C;Math.abs(_-k)<S?_=k:Math.abs(_-O)<S&&(_=O)}return _<0&&(_=360+_),_%=360,l.angle===_?p=!1:(l.angle=_,l.setPositionByOrigin(d,o.originX,o.originY)),p},setCursor:function(s){this.upperCanvasEl.style.cursor=s},_drawSelection:function(s){var i=this._groupSelector,o=i.left,l=i.top,d=t(o),g=t(l);if(this.selectionColor&&(s.fillStyle=this.selectionColor,s.fillRect(i.ex-(o>0?0:-o),i.ey-(l>0?0:-l),d,g)),!(!this.selectionLineWidth||!this.selectionBorderColor))if(s.lineWidth=this.selectionLineWidth,s.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!a){var v=i.ex+n-(o>0?0:d),_=i.ey+n-(l>0?0:g);s.beginPath(),u.util.drawDashedLine(s,v,_,v+d,_,this.selectionDashArray),u.util.drawDashedLine(s,v,_+g-1,v+d,_+g-1,this.selectionDashArray),u.util.drawDashedLine(s,v,_,v,_+g,this.selectionDashArray),u.util.drawDashedLine(s,v+d-1,_,v+d-1,_+g,this.selectionDashArray),s.closePath(),s.stroke()}else u.Object.prototype._setLineDash.call(this,s,this.selectionDashArray),s.strokeRect(i.ex+n-(o>0?0:d),i.ey+n-(l>0?0:g),d,g)},findTarget:function(s,i){if(!this.skipTargetFind){var o=!0,l=this.getPointer(s,o),d=this._activeObject,g=this.getActiveObjects(),v,_;if(this.targets=[],g.length>1&&!i&&d===this._searchPossibleTargets([d],l)||g.length===1&&d._findTargetCorner(l))return d;if(g.length===1&&d===this._searchPossibleTargets([d],l))if(this.preserveObjectStacking)v=d,_=this.targets,this.targets=[];else return d;var p=this._searchPossibleTargets(this._objects,l);return s[this.altSelectionKey]&&p&&v&&p!==v&&(p=v,this.targets=_),p}},_checkTarget:function(s,i,o){if(i&&i.visible&&i.evented&&this.containsPoint(null,i,s))if((this.perPixelTargetFind||i.perPixelTargetFind)&&!i.isEditing){var l=this.isTargetTransparent(i,o.x,o.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(s,i){for(var o,l=s.length,d;l--;){var g=s[l],v=g.group&&g.group.type!=="activeSelection"?this._normalizePointer(g.group,i):i;if(this._checkTarget(v,g,i)){o=s[l],o.subTargetCheck&&o instanceof u.Group&&(d=this._searchPossibleTargets(o._objects,i),d&&this.targets.push(d));break}}return o},restorePointerVpt:function(s){return u.util.transformPoint(s,u.util.invertTransform(this.viewportTransform))},getPointer:function(s,i){if(this._absolutePointer&&!i)return this._absolutePointer;if(this._pointer&&i)return this._pointer;var o=f(s),l=this.upperCanvasEl,d=l.getBoundingClientRect(),g=d.width||0,v=d.height||0,_;(!g||!v)&&("top"in d&&"bottom"in d&&(v=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(g=Math.abs(d.right-d.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,i||(o=this.restorePointerVpt(o));var p=this.getRetinaScaling();return p!==1&&(o.x/=p,o.y/=p),g===0||v===0?_={width:1,height:1}:_={width:l.width/g,height:l.height/v},{x:o.x*_.width,y:o.y*_.height}},_createUpperCanvas:function(){var s=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),i=this.lowerCanvasEl,o=this.upperCanvasEl;o?o.className="":(o=this._createCanvasElement(),this.upperCanvasEl=o),u.util.addClass(o,"upper-canvas "+s),this.wrapperEl.appendChild(o),this._copyCanvasStyle(i,o),this._applyCanvasStyle(o),this.contextTop=o.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=u.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),u.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),u.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(s){var i=this.width||s.width,o=this.height||s.height;u.util.setStyle(s,{position:"absolute",width:i+"px",height:o+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),s.width=i,s.height=o,u.util.makeElementUnselectable(s)},_copyCanvasStyle:function(s,i){i.style.cssText=s.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var s=this._activeObject;return s?s.type==="activeSelection"&&s._objects?s._objects.slice(0):[s]:[]},_onObjectRemoved:function(s){s===this._activeObject&&(this.fire("before:selection:cleared",{target:s}),this._discardActiveObject(),this.fire("selection:cleared",{target:s}),s.fire("deselected")),s===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",s)},_fireSelectionEvents:function(s,i){var o=!1,l=this.getActiveObjects(),d=[],g=[],v={e:i};s.forEach(function(_){l.indexOf(_)===-1&&(o=!0,_.fire("deselected",v),g.push(_))}),l.forEach(function(_){s.indexOf(_)===-1&&(o=!0,_.fire("selected",v),d.push(_))}),s.length>0&&l.length>0?(v.selected=d,v.deselected=g,v.updated=d[0]||g[0],v.target=this._activeObject,o&&this.fire("selection:updated",v)):l.length>0?(l.length===1&&(v.target=d[0],this.fire("object:selected",v)),v.selected=d,v.target=this._activeObject,this.fire("selection:created",v)):s.length>0&&(v.deselected=g,this.fire("selection:cleared",v))},setActiveObject:function(s,i){var o=this.getActiveObjects();return this._setActiveObject(s,i),this._fireSelectionEvents(o,i),this},_setActiveObject:function(s,i){return this._activeObject===s||!this._discardActiveObject(i,s)||s.onSelect({e:i})?!1:(this._activeObject=s,!0)},_discardActiveObject:function(s,i){var o=this._activeObject;if(o){if(o.onDeselect({e:s,object:i}))return!1;this._activeObject=null}return!0},discardActiveObject:function(s){var i=this.getActiveObjects(),o=this.getActiveObject();return i.length&&this.fire("before:selection:cleared",{target:o,e:s}),this._discardActiveObject(s),this._fireSelectionEvents(i,s),this},dispose:function(){var s=this.wrapperEl;return this.removeListeners(),s.removeChild(this.upperCanvasEl),s.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(i){u.util.cleanUpJsdomNode(this[i]),this[i]=void 0}.bind(this)),s.parentNode&&s.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,u.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(s){var i=this._activeObject;i&&i._renderControls(s)},_toObject:function(s,i,o){var l=this._realizeGroupTransformOnObject(s),d=this.callSuper("_toObject",s,i,o);return this._unwindGroupTransformOnObject(s,l),d},_realizeGroupTransformOnObject:function(s){if(s.group&&s.group.type==="activeSelection"&&this._activeObject===s.group){var i=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],o={};return i.forEach(function(l){o[l]=s[l]}),this._activeObject.realizeTransform(s),o}else return null},_unwindGroupTransformOnObject:function(s,i){i&&s.set(i)},_setSVGObject:function(s,i,o){var l=this._realizeGroupTransformOnObject(i);this.callSuper("_setSVGObject",s,i,o),this._unwindGroupTransformOnObject(i,l)},setViewportTransform:function(s){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),u.StaticCanvas.prototype.setViewportTransform.call(this,s)}});for(var c in u.StaticCanvas)c!=="prototype"&&(u.Canvas[c]=u.StaticCanvas[c])}(),function(){var f={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=u.util.addListener,h=u.util.removeListener,r=3,t=2,a=1,n={passive:!1};function c(s,i){return s.button&&s.button===i-1}u.util.object.extend(u.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(e,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(s,i){var o=this.upperCanvasEl,l=this._getEventPrefix();s(u.window,"resize",this._onResize),s(o,l+"down",this._onMouseDown),s(o,l+"move",this._onMouseMove,n),s(o,l+"out",this._onMouseOut),s(o,l+"enter",this._onMouseEnter),s(o,"wheel",this._onMouseWheel),s(o,"contextmenu",this._onContextMenu),s(o,"dblclick",this._onDoubleClick),s(o,"dragover",this._onDragOver),s(o,"dragenter",this._onDragEnter),s(o,"dragleave",this._onDragLeave),s(o,"drop",this._onDrop),this.enablePointerEvents||s(o,"touchstart",this._onTouchStart,n),typeof eventjs<"u"&&i in eventjs&&(eventjs[i](o,"gesture",this._onGesture),eventjs[i](o,"drag",this._onDrag),eventjs[i](o,"orientation",this._onOrientationChange),eventjs[i](o,"shake",this._onShake),eventjs[i](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(h,"remove");var s=this._getEventPrefix();h(u.document,s+"up",this._onMouseUp),h(u.document,"touchend",this._onTouchEnd,n),h(u.document,s+"move",this._onMouseMove,n),h(u.document,"touchmove",this._onMouseMove,n)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(s,i){this.__onTransformGesture&&this.__onTransformGesture(s,i)},_onDrag:function(s,i){this.__onDrag&&this.__onDrag(s,i)},_onMouseWheel:function(s){this.__onMouseWheel(s)},_onMouseOut:function(s){var i=this._hoveredTarget;this.fire("mouse:out",{target:i,e:s}),this._hoveredTarget=null,i&&i.fire("mouseout",{e:s});var o=this;this._hoveredTargets.forEach(function(l){o.fire("mouse:out",{target:i,e:s}),l&&i.fire("mouseout",{e:s})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(l){l.isEditing&&l.hiddenTextarea.focus()})},_onMouseEnter:function(s){!this.currentTransform&&!this.findTarget(s)&&(this.fire("mouse:over",{target:null,e:s}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(s,i){this.__onOrientationChange&&this.__onOrientationChange(s,i)},_onShake:function(s,i){this.__onShake&&this.__onShake(s,i)},_onLongPress:function(s,i){this.__onLongPress&&this.__onLongPress(s,i)},_onDragOver:function(s){s.preventDefault();var i=this._simpleEventHandler("dragover",s);this._fireEnterLeaveEvents(i,s)},_onContextMenu:function(s){return this.stopContextMenu&&(s.stopPropagation(),s.preventDefault()),!1},_onDoubleClick:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"dblclick"),this._resetTransformEventData(s)},getPointerId:function(s){var i=s.changedTouches;return i?i[0]&&i[0].identifier:this.enablePointerEvents?s.pointerId:-1},_isMainEvent:function(s){return s.isPrimary===!0?!0:s.isPrimary===!1?!1:s.type==="touchend"&&s.touches.length===0?!0:s.changedTouches?s.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(s){s.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(s)),this.__onMouseDown(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();e(u.document,"touchend",this._onTouchEnd,n),e(u.document,"touchmove",this._onMouseMove,n),h(i,o+"down",this._onMouseDown)},_onMouseDown:function(s){this.__onMouseDown(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();h(i,o+"move",this._onMouseMove,n),e(u.document,o+"up",this._onMouseUp),e(u.document,o+"move",this._onMouseMove,n)},_onTouchEnd:function(s){if(!(s.touches.length>0)){this.__onMouseUp(s),this._resetTransformEventData(),this.mainTouchId=null;var i=this._getEventPrefix();h(u.document,"touchend",this._onTouchEnd,n),h(u.document,"touchmove",this._onMouseMove,n);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){e(o.upperCanvasEl,i+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(s){this.__onMouseUp(s),this._resetTransformEventData();var i=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(s)&&(h(u.document,o+"up",this._onMouseUp),h(u.document,o+"move",this._onMouseMove,n),e(i,o+"move",this._onMouseMove,n))},_onMouseMove:function(s){!this.allowTouchScrolling&&s.preventDefault&&s.preventDefault(),this.__onMouseMove(s)},_onResize:function(){this.calcOffset()},_shouldRender:function(s){var i=this._activeObject;return!!i!=!!s||i&&s&&i!==s?!0:(i&&i.isEditing,!1)},__onMouseUp:function(s){var i,o=this._currentTransform,l=this._groupSelector,d=!1,g=!l||l.left===0&&l.top===0;if(this._cacheTransformEventData(s),i=this._target,this._handleEvent(s,"up:before"),c(s,r)){this.fireRightClick&&this._handleEvent(s,"up",r,g);return}if(c(s,t)){this.fireMiddleClick&&this._handleEvent(s,"up",t,g),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(s);return}this._isMainEvent(s)&&(o&&(this._finalizeCurrentTransform(s),d=o.actionPerformed),g||(this._maybeGroupObjects(s),d||(d=this._shouldRender(i))),i&&(i.isMoving=!1),this._setCursorFromEvent(s,i),this._handleEvent(s,"up",a,g),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=0),d?this.requestRenderAll():g||this.renderTop())},_simpleEventHandler:function(s,i){var o=this.findTarget(i),l=this.targets,d={e:i,target:o,subTargets:l};if(this.fire(s,d),o&&o.fire(s,d),!l)return o;for(var g=0;g<l.length;g++)l[g].fire(s,d);return o},_handleEvent:function(s,i,o,l){var d=this._target,g=this.targets||[],v={e:s,target:d,subTargets:g,button:o||a,isClick:l||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+i,v),d&&d.fire("mouse"+i,v);for(var _=0;_<g.length;_++)g[_].fire("mouse"+i,v)},_finalizeCurrentTransform:function(s){var i=this._currentTransform,o=i.target,l,d={e:s,target:o,transform:i};o._scaling&&(o._scaling=!1),o.setCoords(),(i.actionPerformed||this.stateful&&o.hasStateChanged())&&(i.actionPerformed&&(l=this._addEventOptions(d,i),this._fire(l,d)),this._fire("modified",d))},_addEventOptions:function(s,i){var o,l;switch(i.action){case"scaleX":o="scaled",l="x";break;case"scaleY":o="scaled",l="y";break;case"skewX":o="skewed",l="x";break;case"skewY":o="skewed",l="y";break;case"scale":o="scaled",l="equally";break;case"rotate":o="rotated";break;case"drag":o="moved";break}return s.by=l,o},_onMouseDownInDrawingMode:function(s){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(s).requestRenderAll(),this.clipTo&&u.util.clipContext(this,this.contextTop);var i=this.getPointer(s);this.freeDrawingBrush.onMouseDown(i,{e:s,pointer:i}),this._handleEvent(s,"down")},_onMouseMoveInDrawingMode:function(s){if(this._isCurrentlyDrawing){var i=this.getPointer(s);this.freeDrawingBrush.onMouseMove(i,{e:s,pointer:i})}this.setCursor(this.freeDrawingCursor),this._handleEvent(s,"move")},_onMouseUpInDrawingMode:function(s){this.clipTo&&this.contextTop.restore();var i=this.getPointer(s);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:s,pointer:i}),this._handleEvent(s,"up")},__onMouseDown:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"down:before");var i=this._target;if(c(s,r)){this.fireRightClick&&this._handleEvent(s,"down",r);return}if(c(s,t)){this.fireMiddleClick&&this._handleEvent(s,"down",t);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(s);return}if(this._isMainEvent(s)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var l=this._shouldRender(i),d=this._shouldGroup(s,i);if(this._shouldClearSelection(s,i)?this.discardActiveObject(s):d&&(this._handleGrouping(s,i),i=this._activeObject),this.selection&&(!i||!i.selectable&&!i.isEditing&&i!==this._activeObject)&&(this._groupSelector={ex:o.x,ey:o.y,top:0,left:0}),i){var g=i===this._activeObject;i.selectable&&this.setActiveObject(i,s),i===this._activeObject&&(i.__corner||!d)&&this._setupCurrentTransform(s,i,g)}this._handleEvent(s,"down"),(l||d)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(s){this._resetTransformEventData(),this._pointer=this.getPointer(s,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(s)||null},_beforeTransform:function(s){var i=this._currentTransform;this.stateful&&i.target.saveState(),this.fire("before:transform",{e:s,transform:i}),i.corner&&this.onBeforeScaleRotate(i.target)},__onMouseMove:function(s){this._handleEvent(s,"move:before"),this._cacheTransformEventData(s);var i,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(s);return}if(this._isMainEvent(s)){var l=this._groupSelector;l?(o=this._pointer,l.left=o.x-l.ex,l.top=o.y-l.ey,this.renderTop()):this._currentTransform?this._transformObject(s):(i=this.findTarget(s)||null,this._setCursorFromEvent(s,i),this._fireOverOutEvents(i,s)),this._handleEvent(s,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(s,i){var o=this._hoveredTarget,l=this._hoveredTargets,d=this.targets,g=Math.max(l.length,d.length);this.fireSyntheticInOutEvents(s,i,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var v=0;v<g;v++)this.fireSyntheticInOutEvents(d[v],i,{oldTarget:l[v],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=s,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(s,i){var o=this._draggedoverTarget,l=this._hoveredTargets,d=this.targets,g=Math.max(l.length,d.length);this.fireSyntheticInOutEvents(s,i,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var v=0;v<g;v++)this.fireSyntheticInOutEvents(d[v],i,{oldTarget:l[v],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=s},fireSyntheticInOutEvents:function(s,i,o){var l,d,g=o.oldTarget,v,_,p=g!==s,C=o.canvasEvtIn,S=o.canvasEvtOut;p&&(l={e:i,target:s,previousTarget:g},d={e:i,target:g,nextTarget:s}),_=s&&p,v=g&&p,v&&(S&&this.fire(S,d),g.fire(o.evtOut,d)),_&&(C&&this.fire(C,l),s.fire(o.evtIn,l))},__onMouseWheel:function(s){this._cacheTransformEventData(s),this._handleEvent(s,"wheel"),this._resetTransformEventData()},_transformObject:function(s){var i=this.getPointer(s),o=this._currentTransform;o.reset=!1,o.target.isMoving=!0,o.shiftKey=s.shiftKey,o.altKey=s[this.centeredKey],this._beforeScaleTransform(s,o),this._performTransformAction(s,o,i),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(s,i,o){var l=o.x,d=o.y,g=i.action,v=!1,_={target:i.target,e:s,transform:i,pointer:o};g==="rotate"?(v=this._rotateObject(l,d))&&this._fire("rotating",_):g==="scale"?(v=this._onScale(s,i,l,d))&&this._fire("scaling",_):g==="scaleX"?(v=this._scaleObject(l,d,"x"))&&this._fire("scaling",_):g==="scaleY"?(v=this._scaleObject(l,d,"y"))&&this._fire("scaling",_):g==="skewX"?(v=this._skewObject(l,d,"x"))&&this._fire("skewing",_):g==="skewY"?(v=this._skewObject(l,d,"y"))&&this._fire("skewing",_):(v=this._translateObject(l,d),v&&(this._fire("moving",_),this.setCursor(_.target.moveCursor||this.moveCursor))),i.actionPerformed=i.actionPerformed||v},_fire:function(s,i){this.fire("object:"+s,i),i.target.fire(s,i)},_beforeScaleTransform:function(s,i){if(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"){var o=this._shouldCenterTransform(i.target);(o&&(i.originX!=="center"||i.originY!=="center")||!o&&i.originX==="center"&&i.originY==="center")&&(this._resetCurrentTransform(),i.reset=!0)}},_onScale:function(s,i,o,l){return this._isUniscalePossible(s,i.target)?(i.currentAction="scale",this._scaleObject(o,l)):(!i.reset&&i.currentAction==="scale"&&this._resetCurrentTransform(),i.currentAction="scaleEqually",this._scaleObject(o,l,"equally"))},_isUniscalePossible:function(s,i){return(s[this.uniScaleKey]||this.uniScaleTransform)&&!i.get("lockUniScaling")},_setCursorFromEvent:function(s,i){if(!i)return this.setCursor(this.defaultCursor),!1;var o=i.hoverCursor||this.hoverCursor,l=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,d=(!l||!l.contains(i))&&i._findTargetCorner(this.getPointer(s,!0));d?this.setCursor(this.getCornerCursor(d,i,s)):(i.subTargetCheck&&this.targets.concat().reverse().map(function(g){o=g.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(s,i,o){return this.actionIsDisabled(s,i,o)?this.notAllowedCursor:s in f?this._getRotatedCornerCursor(s,i,o):s==="mtr"&&i.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(s,i,o){return s==="mt"||s==="mb"?o[this.altActionKey]?i.lockSkewingX:i.lockScalingY:s==="ml"||s==="mr"?o[this.altActionKey]?i.lockSkewingY:i.lockScalingX:s==="mtr"?i.lockRotation:this._isUniscalePossible(o,i)?i.lockScalingX&&i.lockScalingY:i.lockScalingX||i.lockScalingY},_getRotatedCornerCursor:function(s,i,o){var l=Math.round(i.angle%360/45);return l<0&&(l+=8),l+=f[s],o[this.altActionKey]&&f[s]%2===0&&(l+=2),l%=8,this.cursorMap[l]}})}(),function(){var f=Math.min,e=Math.max;u.util.object.extend(u.Canvas.prototype,{_shouldGroup:function(h,r){var t=this._activeObject;return t&&this._isSelectionKeyPressed(h)&&r&&r.selectable&&this.selection&&(t!==r||t.type==="activeSelection")&&!r.onSelect({e:h})},_handleGrouping:function(h,r){var t=this._activeObject;t.__corner||r===t&&(r=this.findTarget(h,!0),!r||!r.selectable)||(t&&t.type==="activeSelection"?this._updateActiveSelection(r,h):this._createActiveSelection(r,h))},_updateActiveSelection:function(h,r){var t=this._activeObject,a=t._objects.slice(0);t.contains(h)?(t.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),t.size()===1&&this._setActiveObject(t.item(0),r)):(t.addWithUpdate(h),this._hoveredTarget=t,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,r)},_createActiveSelection:function(h,r){var t=this.getActiveObjects(),a=this._createGroup(h);this._hoveredTarget=a,this._setActiveObject(a,r),this._fireSelectionEvents(t,r)},_createGroup:function(h){var r=this._objects,t=r.indexOf(this._activeObject)<r.indexOf(h),a=t?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new u.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(h){var r=this._collectObjects(h),t;r.length===1?this.setActiveObject(r[0],h):r.length>1&&(t=new u.ActiveSelection(r.reverse(),{canvas:this}),this.setActiveObject(t,h))},_collectObjects:function(h){for(var r=[],t,a=this._groupSelector.ex,n=this._groupSelector.ey,c=a+this._groupSelector.left,s=n+this._groupSelector.top,i=new u.Point(f(a,c),f(n,s)),o=new u.Point(e(a,c),e(n,s)),l=!this.selectionFullyContained,d=a===c&&n===s,g=this._objects.length;g--&&(t=this._objects[g],!(!(!t||!t.selectable||!t.visible)&&(l&&t.intersectsWithRect(i,o)||t.isContainedWithinRect(i,o)||l&&t.containsPoint(i)||l&&t.containsPoint(o))&&(r.push(t),d))););return r.length>1&&(r=r.filter(function(v){return!v.onSelect({e:h})})),r},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){u.util.object.extend(u.StaticCanvas.prototype,{toDataURL:function(f){f||(f={});var e=f.format||"png",h=f.quality||1,r=(f.multiplier||1)*(f.enableRetinaScaling?this.getRetinaScaling():1),t=this.toCanvasElement(r,f);return u.util.toDataURL(t,e,h)},toCanvasElement:function(f,e){f=f||1,e=e||{};var h=(e.width||this.width)*f,r=(e.height||this.height)*f,t=this.getZoom(),a=this.width,n=this.height,c=t*f,s=this.viewportTransform,i=(s[4]-(e.left||0))*f,o=(s[5]-(e.top||0))*f,l=this.interactive,d=[c,0,0,c,i,o],g=this.enableRetinaScaling,v=u.util.createCanvasElement(),_=this.contextTop;return v.width=h,v.height=r,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=d,this.width=h,this.height=r,this.calcViewportBoundaries(),this.renderCanvas(v.getContext("2d"),this._objects),this.viewportTransform=s,this.width=a,this.height=n,this.calcViewportBoundaries(),this.interactive=l,this.enableRetinaScaling=g,this.contextTop=_,v}})}(),u.util.object.extend(u.StaticCanvas.prototype,{loadFromDatalessJSON:function(f,e,h){return this.loadFromJSON(f,e,h)},loadFromJSON:function(f,e,h){if(f){var r=typeof f=="string"?JSON.parse(f):u.util.object.clone(f),t=this,a=r.clipPath,n=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete r.clipPath,this._enlivenObjects(r.objects,function(c){t.clear(),t._setBgOverlay(r,function(){a?t._enlivenObjects([a],function(s){t.clipPath=s[0],t.__setupCanvas.call(t,r,c,n,e)}):t.__setupCanvas.call(t,r,c,n,e)})},h),this}},__setupCanvas:function(f,e,h,r){var t=this;e.forEach(function(a,n){t.insertAt(a,n)}),this.renderOnAddRemove=h,delete f.objects,delete f.backgroundImage,delete f.overlayImage,delete f.background,delete f.overlay,this._setOptions(f),this.renderAll(),r&&r()},_setBgOverlay:function(f,e){var h={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!f.backgroundImage&&!f.overlayImage&&!f.background&&!f.overlay){e&&e();return}var r=function(){h.backgroundImage&&h.overlayImage&&h.backgroundColor&&h.overlayColor&&e&&e()};this.__setBgOverlay("backgroundImage",f.backgroundImage,h,r),this.__setBgOverlay("overlayImage",f.overlayImage,h,r),this.__setBgOverlay("backgroundColor",f.background,h,r),this.__setBgOverlay("overlayColor",f.overlay,h,r)},__setBgOverlay:function(f,e,h,r){var t=this;if(!e){h[f]=!0,r&&r();return}f==="backgroundImage"||f==="overlayImage"?u.util.enlivenObjects([e],function(a){t[f]=a[0],h[f]=!0,r&&r()}):this["set"+u.util.string.capitalize(f,!0)](e,function(){h[f]=!0,r&&r()})},_enlivenObjects:function(f,e,h){if(!f||f.length===0){e&&e([]);return}u.util.enlivenObjects(f,function(r){e&&e(r)},null,h)},_toDataURL:function(f,e){this.clone(function(h){e(h.toDataURL(f))})},_toDataURLWithMultiplier:function(f,e,h){this.clone(function(r){h(r.toDataURLWithMultiplier(f,e))})},clone:function(f,e){var h=JSON.stringify(this.toJSON(e));this.cloneWithoutData(function(r){r.loadFromJSON(h,function(){f&&f(r)})})},cloneWithoutData:function(f){var e=u.util.createCanvasElement();e.width=this.width,e.height=this.height;var h=new u.Canvas(e);h.clipTo=this.clipTo,this.backgroundImage?(h.setBackgroundImage(this.backgroundImage.src,function(){h.renderAll(),f&&f(h)}),h.backgroundImageOpacity=this.backgroundImageOpacity,h.backgroundImageStretch=this.backgroundImageStretch):f&&f(h)}}),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t=e.util.toFixed,a=e.util.string.capitalize,n=e.util.degreesToRadians,c=e.StaticCanvas.supports("setLineDash"),s=!e.isLikelyNode,i=2;e.Object||(e.Object=e.util.createClass(e.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:s,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=e.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var l=e.perfLimitSizeTotal,d=o.width,g=o.height,v=e.maxCacheSideLimit,_=e.minCacheSideLimit;if(d<=v&&g<=v&&d*g<=l)return d<_&&(o.width=_),g<_&&(o.height=_),o;var p=d/g,C=e.util.limitDimsByArea(p,l),S=e.util.capValue,O=S(_,C.x,v),k=S(_,C.y,v);return d>O&&(o.zoomX/=d/O,o.width=O,o.capped=!0),g>k&&(o.zoomY/=g/k,o.height=k,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),l=this._getTransformedDimensions(0,0),d=l.x*o.scaleX/this.scaleX,g=l.y*o.scaleY/this.scaleY;return{width:d+i,height:g+i,zoomX:o.scaleX,zoomY:o.scaleY,x:d,y:g}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var l=o._currentTransform.target,d=o._currentTransform.action;if(this===l&&d.slice&&d.slice(0,5)==="scale")return!1}var g=this._cacheCanvas,v=this._limitCacheSize(this._getCacheCanvasDimensions()),_=e.minCacheSideLimit,p=v.width,C=v.height,S,O,k=v.zoomX,P=v.zoomY,F=p!==this.cacheWidth||C!==this.cacheHeight,E=this.zoomX!==k||this.zoomY!==P,X=F||E,z=0,V=0,J=!1;if(F){var T=this._cacheCanvas.width,j=this._cacheCanvas.height,R=p>T||C>j,I=(p<T*.9||C<j*.9)&&T>_&&j>_;J=R||I,R&&!v.capped&&(p>_||C>_)&&(z=p*.1,V=C*.1)}return X?(J?(g.width=Math.ceil(p+z),g.height=Math.ceil(C+V)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,g.width,g.height)),S=v.x/2,O=v.y/2,this.cacheTranslationX=Math.round(g.width/2-S)+S,this.cacheTranslationY=Math.round(g.height/2-O)+O,this.cacheWidth=p,this.cacheHeight=C,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(k,P),this.zoomX=k,this.zoomY=P,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initClipping(o),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var l;this.group&&!this.group._transformDone?l=this.calcTransformMatrix():l=this.calcOwnMatrix(),o.transform(l[0],l[1],l[2],l[3],l[4],l[5])},toObject:function(o){var l=e.Object.NUM_FRACTION_DIGITS,d={type:this.type,version:e.version,originX:this.originX,originY:this.originY,left:t(this.left,l),top:t(this.top,l),width:t(this.width,l),height:t(this.height,l),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:t(this.strokeWidth,l),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:t(this.strokeMiterLimit,l),scaleX:t(this.scaleX,l),scaleY:t(this.scaleY,l),angle:t(this.angle,l),flipX:this.flipX,flipY:this.flipY,opacity:t(this.opacity,l),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:t(this.skewX,l),skewY:t(this.skewY,l)};return this.clipPath&&(d.clipPath=this.clipPath.toObject(o),d.clipPath.inverted=this.clipPath.inverted,d.clipPath.absolutePositioned=this.clipPath.absolutePositioned),e.util.populateWithProperties(this,d,o),this.includeDefaultValues||(d=this._removeDefaultValues(d)),d},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var l=e.util.getKlass(o.type).prototype,d=l.stateProperties;return d.forEach(function(g){if(!(g==="left"||g==="top")){o[g]===l[g]&&delete o[g];var v=Object.prototype.toString.call(o[g])==="[object Array]"&&Object.prototype.toString.call(l[g])==="[object Array]";v&&o[g].length===0&&l[g].length===0&&delete o[g]}}),o},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){var o=e.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),l=o.scaleX,d=o.scaleY;if(this.canvas){var g=this.canvas.getZoom(),v=this.canvas.getRetinaScaling();l*=g*v,d*=g*v}return{scaleX:l,scaleY:d}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,l){var d=o==="scaleX"||o==="scaleY",g=this[o]!==l,v=!1;return d&&(l=this._constrainScale(l)),o==="scaleX"&&l<0?(this.flipX=!this.flipX,l*=-1):o==="scaleY"&&l<0?(this.flipY=!this.flipY,l*=-1):o==="shadow"&&l&&!(l instanceof e.Shadow)?l=new e.Shadow(l):o==="dirty"&&this.group&&this.group.set("dirty",l),this[o]=l,g&&(v=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,v&&this.group.set("dirty",!0)):v&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:e.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||this.width===0&&this.height===0&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.transformMatrix&&o.transform.apply(o,this.transformMatrix),this.clipTo&&e.util.clipContext(this,o),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&o.restore(),o.restore())},renderCache:function(o){o=o||{},this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o){var l=this.clipPath;if(o.save(),l.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",l.absolutePositioned){var d=e.util.invertTransform(this.calcTransformMatrix());o.transform(d[0],d[1],d[2],d[3],d[4],d[5])}l.transform(o),o.scale(1/l.zoomX,1/l.zoomY),o.drawImage(l._cacheCanvas,-l.cacheTranslationX,-l.cacheTranslationY),o.restore()},drawObject:function(o,l){var d=this.fill,g=this.stroke;l?(this.fill="black",this.stroke="",this._setClippingProperties(o)):(this._renderBackground(o),this._setStrokeStyles(o,this),this._setFillStyles(o,this)),this._render(o),this._drawClipPath(o),this.fill=d,this.stroke=g},_drawClipPath:function(o){var l=this.clipPath;l&&(l.canvas=this.canvas,l.shouldCache(),l._transformDone=!0,l.renderCache({forClipping:!0}),this.drawClipPathOnCache(o))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!o){var l=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-d/2,l,d)}return!0}return!1},_renderBackground:function(o){if(this.backgroundColor){var l=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-l.x/2,-l.y/2,l.x,l.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,l){l.stroke&&(o.lineWidth=l.strokeWidth,o.lineCap=l.strokeLineCap,o.lineDashOffset=l.strokeDashOffset,o.lineJoin=l.strokeLineJoin,o.miterLimit=l.strokeMiterLimit,o.strokeStyle=l.stroke.toLive?l.stroke.toLive(o,this):l.stroke)},_setFillStyles:function(o,l){l.fill&&(o.fillStyle=l.fill.toLive?l.fill.toLive(o,this):l.fill)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,l,d){!l||l.length===0||(1&l.length&&l.push.apply(l,l),c?o.setLineDash(l):d&&d(o))},_renderControls:function(o,l){var d=this.getViewportTransform(),g=this.calcTransformMatrix(),v,_,p;l=l||{},_=typeof l.hasBorders<"u"?l.hasBorders:this.hasBorders,p=typeof l.hasControls<"u"?l.hasControls:this.hasControls,g=e.util.multiplyTransformMatrices(d,g),v=e.util.qrDecompose(g),o.save(),o.translate(v.translateX,v.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),l.forActiveSelection?(o.rotate(n(v.angle)),_&&this.drawBordersInGroup(o,v,l)):(o.rotate(n(this.angle)),_&&this.drawBorders(o,l)),p&&this.drawControls(o,l),o.restore()},_setShadow:function(o){if(this.shadow){var l=this.shadow,d=this.canvas,g,v=d&&d.viewportTransform[0]||1,_=d&&d.viewportTransform[3]||1;l.nonScaling?g={scaleX:1,scaleY:1}:g=this.getObjectScaling(),d&&d._isRetinaScaling()&&(v*=e.devicePixelRatio,_*=e.devicePixelRatio),o.shadowColor=l.color,o.shadowBlur=l.blur*e.browserShadowBlurConstant*(v+_)*(g.scaleX+g.scaleY)/4,o.shadowOffsetX=l.offsetX*v*g.scaleX,o.shadowOffsetY=l.offsetY*_*g.scaleY}},_removeShadow:function(o){this.shadow&&(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,l){if(!l||!l.toLive)return{offsetX:0,offsetY:0};var d=l.gradientTransform||l.patternTransform,g=-this.width/2+l.offsetX||0,v=-this.height/2+l.offsetY||0;return l.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,g,v):o.transform(1,0,0,1,g,v),d&&o.transform(d[0],d[1],d[2],d[3],d[4],d[5]),{offsetX:g,offsetY:v}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){this.fill&&(o.save(),this._applyPatternGradientTransform(o,this.fill),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var l=this.getObjectScaling();o.scale(1/l.scaleX,1/l.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray,this._renderDashedStroke),this.stroke.toLive&&this.stroke.gradientUnits==="percentage"?this._applyPatternForTransformedGradient(o,this.stroke):this._applyPatternGradientTransform(o,this.stroke),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,l){var d=this._limitCacheSize(this._getCacheCanvasDimensions()),g=e.util.createCanvasElement(),v,_=this.canvas.getRetinaScaling(),p=d.x/this.scaleX/_,C=d.y/this.scaleY/_;g.width=p,g.height=C,v=g.getContext("2d"),v.beginPath(),v.moveTo(0,0),v.lineTo(p,0),v.lineTo(p,C),v.lineTo(0,C),v.closePath(),v.translate(p/2,C/2),v.scale(d.zoomX/this.scaleX/_,d.zoomY/this.scaleY/_),this._applyPatternGradientTransform(v,l),v.fillStyle=l.toLive(o),v.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(_*this.scaleX/d.zoomX,_*this.scaleY/d.zoomY),o.strokeStyle=v.createPattern(g,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=e.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var l=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),l=e.util.transformPoint(l,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,l.x+=o.offsetLeft,l.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(l,"center","center")},clone:function(o,l){var d=this.toObject(l);this.constructor.fromObject?this.constructor.fromObject(d,o):e.Object._fromObject("Object",d,o)},cloneAsImage:function(o,l){var d=this.toCanvasElement(l);return o&&o(new e.Image(d)),this},toCanvasElement:function(o){o||(o={});var l=e.util,d=l.saveObjectTransform(this),g=this.group,v=this.shadow,_=Math.abs,p=(o.multiplier||1)*(o.enableRetinaScaling?e.devicePixelRatio:1);delete this.group,o.withoutTransform&&l.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var C=e.util.createCanvasElement(),S=this.getBoundingRect(!0,!0),O=this.shadow,k,P={x:0,y:0},F,E,X;O&&(F=O.blur,O.nonScaling?k={scaleX:1,scaleY:1}:k=this.getObjectScaling(),P.x=2*Math.round(_(O.offsetX)+F)*_(k.scaleX),P.y=2*Math.round(_(O.offsetY)+F)*_(k.scaleY)),E=S.width+P.x,X=S.height+P.y,C.width=Math.ceil(E),C.height=Math.ceil(X);var z=new e.StaticCanvas(C,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(z.backgroundColor="#fff"),this.setPositionByOrigin(new e.Point(z.width/2,z.height/2),"center","center");var V=this.canvas;z.add(this);var J=z.toCanvasElement(p||1,o);return this.shadow=v,this.set("canvas",V),g&&(this.group=g),this.set(d).setCoords(),z._objects=[],z.dispose(),z=null,J},toDataURL:function(o){return o||(o={}),e.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},setGradient:function(o,l){l||(l={});var d={colorStops:[]};return d.type=l.type||(l.r1||l.r2?"radial":"linear"),d.coords={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2},d.gradientUnits=l.gradientUnits||"pixels",(l.r1||l.r2)&&(d.coords.r1=l.r1,d.coords.r2=l.r2),d.gradientTransform=l.gradientTransform,e.Gradient.prototype.addColorStop.call(d,l.colorStops),this.set(o,e.Gradient.forObject(this,d))},setPatternFill:function(o,l){return this.set("fill",new e.Pattern(o,l))},setShadow:function(o){return this.set("shadow",o?new e.Shadow(o):null)},setColor:function(o){return this.set("fill",o),this},rotate:function(o){var l=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return l&&this._setOriginToCenter(),this.set("angle",o),l&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,l){l=l||this.canvas.getPointer(o);var d=new e.Point(l.x,l.y),g=this._getLeftTopCoords();return this.angle&&(d=e.util.rotatePoint(d,g,n(-this.angle))),{x:d.x-g.x,y:d.y-g.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)}}),e.util.createAccessors&&e.util.createAccessors(e.Object),h(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object._fromObject=function(o,l,d,g){var v=e[o];l=r(l,!0),e.util.enlivenPatterns([l.fill,l.stroke],function(_){typeof _[0]<"u"&&(l.fill=_[0]),typeof _[1]<"u"&&(l.stroke=_[1]),e.util.enlivenObjects([l.clipPath],function(p){l.clipPath=p[0];var C=g?new v(l[g],l):new v(l);d&&d(C)})})},e.Object.__uid=0)}(m),function(){var f=u.util.degreesToRadians,e={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};u.util.object.extend(u.Object.prototype,{translateToGivenOrigin:function(r,t,a,n,c){var s=r.x,i=r.y,o,l,d;return typeof t=="string"?t=e[t]:t-=.5,typeof n=="string"?n=e[n]:n-=.5,o=n-t,typeof a=="string"?a=h[a]:a-=.5,typeof c=="string"?c=h[c]:c-=.5,l=c-a,(o||l)&&(d=this._getTransformedDimensions(),s=r.x+o*d.x,i=r.y+l*d.y),new u.Point(s,i)},translateToCenterPoint:function(r,t,a){var n=this.translateToGivenOrigin(r,t,a,"center","center");return this.angle?u.util.rotatePoint(n,r,f(this.angle)):n},translateToOriginPoint:function(r,t,a){var n=this.translateToGivenOrigin(r,"center","center",t,a);return this.angle?u.util.rotatePoint(n,r,f(this.angle)):n},getCenterPoint:function(){var r=new u.Point(this.left,this.top);return this.translateToCenterPoint(r,this.originX,this.originY)},getPointByOrigin:function(r,t){var a=this.getCenterPoint();return this.translateToOriginPoint(a,r,t)},toLocalPoint:function(r,t,a){var n=this.getCenterPoint(),c,s;return typeof t<"u"&&typeof a<"u"?c=this.translateToGivenOrigin(n,"center","center",t,a):c=new u.Point(this.left,this.top),s=new u.Point(r.x,r.y),this.angle&&(s=u.util.rotatePoint(s,n,-f(this.angle))),s.subtractEquals(c)},setPositionByOrigin:function(r,t,a){var n=this.translateToCenterPoint(r,t,a),c=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",c.x),this.set("top",c.y)},adjustPosition:function(r){var t=f(this.angle),a=this.getScaledWidth(),n=u.util.cos(t)*a,c=u.util.sin(t)*a,s,i;typeof this.originX=="string"?s=e[this.originX]:s=this.originX-.5,typeof r=="string"?i=e[r]:i=r-.5,this.left+=n*(i-s),this.top+=c*(i-s),this.setCoords(),this.originX=r},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var r=this.getCenterPoint();this.originX="center",this.originY="center",this.left=r.x,this.top=r.y},_resetOrigin:function(){var r=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=r.x,this.top=r.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function f(t){return[new u.Point(t.tl.x,t.tl.y),new u.Point(t.tr.x,t.tr.y),new u.Point(t.br.x,t.br.y),new u.Point(t.bl.x,t.bl.y)]}var e=u.util.degreesToRadians,h=u.util.multiplyTransformMatrices,r=u.util.transformPoint;u.util.object.extend(u.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,a){this.oCoords||this.setCoords();var n=t?this.aCoords:this.oCoords;return f(a?this.calcCoords(t):n)},intersectsWithRect:function(t,a,n,c){var s=this.getCoords(n,c),i=u.Intersection.intersectPolygonRectangle(s,t,a);return i.status==="Intersection"},intersectsWithObject:function(t,a,n){var c=u.Intersection.intersectPolygonPolygon(this.getCoords(a,n),t.getCoords(a,n));return c.status==="Intersection"||t.isContainedWithinObject(this,a,n)||this.isContainedWithinObject(t,a,n)},isContainedWithinObject:function(t,a,n){for(var c=this.getCoords(a,n),s=0,i=t._getImageLines(n?t.calcCoords(a):a?t.aCoords:t.oCoords);s<4;s++)if(!t.containsPoint(c[s],i))return!1;return!0},isContainedWithinRect:function(t,a,n,c){var s=this.getBoundingRect(n,c);return s.left>=t.x&&s.left+s.width<=a.x&&s.top>=t.y&&s.top+s.height<=a.y},containsPoint:function(t,s,n,c){var s=s||this._getImageLines(c?this.calcCoords(n):n?this.aCoords:this.oCoords),i=this._findCrossPoints(t,s);return i!==0&&i%2===1},isOnScreen:function(t){if(!this.canvas)return!1;for(var a=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,c=this.getCoords(!0,t),s,i=0;i<4;i++)if(s=c[i],s.x<=n.x&&s.x>=a.x&&s.y<=n.y&&s.y>=a.y)return!0;return this.intersectsWithRect(a,n,!0,t)?!0:this._containsCenterOfCanvas(a,n,t)},_containsCenterOfCanvas:function(t,a,n){var c={x:(t.x+a.x)/2,y:(t.y+a.y)/2};return!!this.containsPoint(c,null,!0,n)},isPartiallyOnScreen:function(t){if(!this.canvas)return!1;var a=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br;return this.intersectsWithRect(a,n,!0,t)?!0:this._containsCenterOfCanvas(a,n,t)},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,a){var n,c,s,i,o,l=0,d;for(var g in a)if(d=a[g],!(d.o.y<t.y&&d.d.y<t.y)&&!(d.o.y>=t.y&&d.d.y>=t.y)&&(d.o.x===d.d.x&&d.o.x>=t.x?o=d.o.x:(n=0,c=(d.d.y-d.o.y)/(d.d.x-d.o.x),s=t.y-n*t.x,i=d.o.y-c*d.o.x,o=-(s-i)/(n-c)),o>=t.x&&(l+=1),l===2))break;return l},getBoundingRect:function(t,a){var n=this.getCoords(t,a);return u.util.makeBoundingBoxFromPoints(n)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t},scale:function(t){return this._set("scaleX",t),this._set("scaleY",t),this.setCoords()},scaleToWidth:function(t,a){var n=this.getBoundingRect(a).width/this.getScaledWidth();return this.scale(t/this.width/n)},scaleToHeight:function(t,a){var n=this.getBoundingRect(a).height/this.getScaledHeight();return this.scale(t/this.height/n)},calcCoords:function(t){var a=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),c=h(n,a),s=this.getViewportTransform(),i=t?c:h(s,c),o=this._getTransformedDimensions(),l=o.x/2,d=o.y/2,g=r({x:-l,y:-d},i),v=r({x:l,y:-d},i),_=r({x:-l,y:d},i),p=r({x:l,y:d},i);if(!t){var C=this.padding,S=e(this.angle),O=u.util.cos(S),k=u.util.sin(S),P=O*C,F=k*C,E=P+F,X=P-F;C&&(g.x-=X,g.y-=E,v.x+=E,v.y-=X,_.x-=E,_.y+=X,p.x+=X,p.y+=E);var z=new u.Point((g.x+_.x)/2,(g.y+_.y)/2),V=new u.Point((v.x+g.x)/2,(v.y+g.y)/2),J=new u.Point((p.x+v.x)/2,(p.y+v.y)/2),T=new u.Point((p.x+_.x)/2,(p.y+_.y)/2),j=new u.Point(V.x+k*this.rotatingPointOffset,V.y-O*this.rotatingPointOffset)}var R={tl:g,tr:v,br:p,bl:_};return t||(R.ml=z,R.mt=V,R.mr=J,R.mb=T,R.mtr=j),R},setCoords:function(t,a){return this.oCoords=this.calcCoords(t),a||(this.aCoords=this.calcCoords(!0)),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){return u.util.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var t=this.getCenterPoint();return[1,0,0,1,t.x,t.y]},transformMatrixKey:function(t){var a="_",n="";return!t&&this.group&&(n=this.group.transformMatrixKey(t)+a),n+this.top+a+this.left+a+this.scaleX+a+this.scaleY+a+this.skewX+a+this.skewY+a+this.angle+a+this.originX+a+this.originY+a+this.width+a+this.height+a+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(t){if(t)return this.calcOwnMatrix();var a=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===a)return n.value;var c=this.calcOwnMatrix();return this.group&&(c=h(this.group.calcTransformMatrix(),c)),n.key=a,n.value=c,c},calcOwnMatrix:function(){var t=this.transformMatrixKey(!0),a=this.ownMatrixCache||(this.ownMatrixCache={});if(a.key===t)return a.value;var n=this._calcTranslateMatrix();return this.translateX=n[4],this.translateY=n[5],a.key=t,a.value=u.util.composeMatrix(this),a.value},_calcDimensionsTransformMatrix:function(t,a,n){return u.util.calcDimensionsMatrix({skewX:t,skewY:a,scaleX:this.scaleX*(n&&this.flipX?-1:1),scaleY:this.scaleY*(n&&this.flipY?-1:1)})},_getNonTransformedDimensions:function(){var t=this.strokeWidth,a=this.width+t,n=this.height+t;return{x:a,y:n}},_getTransformedDimensions:function(t,a){typeof t>"u"&&(t=this.skewX),typeof a>"u"&&(a=this.skewY);var n=this._getNonTransformedDimensions(),c,s,i=t===0&&a===0;if(this.strokeUniform?(c=this.width,s=this.height):(c=n.x,s=n.y),i)return this._finalizeDimensions(c*this.scaleX,s*this.scaleY);c/=2,s/=2;var o=[{x:-c,y:-s},{x:c,y:-s},{x:-c,y:s},{x:c,y:s}],l=u.util.calcDimensionsMatrix({scaleX:this.scaleX,scaleY:this.scaleY,skewX:t,skewY:a}),d=u.util.makeBoundingBoxFromPoints(o,l);return this._finalizeDimensions(d.width,d.height)},_finalizeDimensions:function(t,a){return this.strokeUniform?{x:t+this.strokeWidth,y:a+this.strokeWidth}:{x:t,y:a}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),a=this._getTransformedDimensions(),n=u.util.transformPoint(a,t,!0);return n.scalarAdd(2*this.padding)}})}(),u.util.object.extend(u.Object.prototype,{sendToBack:function(){return this.group?u.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?u.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(f){return this.group?u.StaticCanvas.prototype.sendBackwards.call(this.group,this,f):this.canvas&&this.canvas.sendBackwards(this,f),this},bringForward:function(f){return this.group?u.StaticCanvas.prototype.bringForward.call(this.group,this,f):this.canvas&&this.canvas.bringForward(this,f),this},moveTo:function(f){return this.group&&this.group.type!=="activeSelection"?u.StaticCanvas.prototype.moveTo.call(this.group,this,f):this.canvas&&this.canvas.moveTo(this,f),this}}),function(){function f(h,r){if(r){if(r.toLive)return h+": url(#SVGID_"+r.id+"); ";var t=new u.Color(r),a=h+": "+t.toRgb()+"; ",n=t.getAlpha();return n!==1&&(a+=h+"-opacity: "+n.toString()+"; "),a}else return h+": none; "}var e=u.util.toFixed;u.util.object.extend(u.Object.prototype,{getSvgStyles:function(h){var r=this.fillRule?this.fillRule:"nonzero",t=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeDashOffset?this.strokeDashOffset:"0",c=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",i=this.strokeMiterLimit?this.strokeMiterLimit:"4",o=typeof this.opacity<"u"?this.opacity:"1",l=this.visible?"":" visibility: hidden;",d=h?"":this.getSvgFilter(),g=f("fill",this.fill),v=f("stroke",this.stroke);return[v,"stroke-width: ",t,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",c,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",i,"; ",g,"fill-rule: ",r,"; ","opacity: ",o,";",d,l].join("")},getSvgSpanStyles:function(h,r){var t="; ",n=h.fontFamily?"font-family: "+(h.fontFamily.indexOf("'")===-1&&h.fontFamily.indexOf('"')===-1?"'"+h.fontFamily+"'":h.fontFamily)+t:"",a=h.strokeWidth?"stroke-width: "+h.strokeWidth+t:"",n=n,c=h.fontSize?"font-size: "+h.fontSize+"px"+t:"",s=h.fontStyle?"font-style: "+h.fontStyle+t:"",i=h.fontWeight?"font-weight: "+h.fontWeight+t:"",o=h.fill?f("fill",h.fill):"",l=h.stroke?f("stroke",h.stroke):"",d=this.getSvgTextDecoration(h),g=h.deltaY?"baseline-shift: "+-h.deltaY+"; ":"";return d&&(d="text-decoration: "+d+t),[l,a,n,c,s,i,d,o,g,r?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(h){return["overline","underline","line-through"].filter(function(r){return h[r.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(h,r){var t=h?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+u.util.matrixToSVG(t);return a+(r||"")+this.getSvgTransformMatrix()+'" '},getSvgTransformMatrix:function(){return this.transformMatrix?" "+u.util.matrixToSVG(this.transformMatrix):""},_setSVGBg:function(h){if(this.backgroundColor){var r=u.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,r),'" y="',e(-this.height/2,r),'" width="',e(this.width,r),'" height="',e(this.height,r),`"></rect>
`)}},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(h),{reviver:h})},toClipPathSVG:function(h){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(h),{reviver:h})},_createBaseClipPathSVGMarkup:function(h,r){r=r||{};var t=r.reviver,a=r.additionalTransform||"",n=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),c=h.indexOf("COMMON_PARTS");return h[c]=n,t?t(h.join("")):h.join("")},_createBaseSVGMarkup:function(h,r){r=r||{};var t=r.noStyle,a=r.reviver,n=t?"":'style="'+this.getSvgStyles()+'" ',c=r.withShadow?'style="'+this.getSvgFilter()+'" ':"",s=this.clipPath,i=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",o=s&&s.absolutePositioned,l=this.stroke,d=this.fill,g=this.shadow,v,_=[],p,C=h.indexOf("COMMON_PARTS"),S=r.additionalTransform;return s&&(s.clipPathId="CLIPPATH_"+u.Object.__uid++,p='<clipPath id="'+s.clipPathId+`" >
`+s.toClipPathSVG(a)+`</clipPath>
`),o&&_.push("<g ",c,this.getSvgCommons(),` >
`),_.push("<g ",this.getSvgTransform(!1),o?"":c+this.getSvgCommons(),` >
`),v=[n,i,t?"":this.addPaintOrder()," ",S?'transform="'+S+'" ':""].join(""),h[C]=v,d&&d.toLive&&_.push(d.toSVG(this)),l&&l.toLive&&_.push(l.toSVG(this)),g&&_.push(g.toSVG(this)),s&&_.push(p),_.push(h.join("")),_.push(`</g>
`),o&&_.push(`</g>
`),a?a(_.join("")):_.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var f=u.util.object.extend,e="stateProperties";function h(t,a,n){var c={},s=!0;n.forEach(function(i){c[i]=t[i]}),f(t[a],c,s)}function r(t,a,n){if(t===a)return!0;if(Array.isArray(t)){if(!Array.isArray(a)||t.length!==a.length)return!1;for(var c=0,s=t.length;c<s;c++)if(!r(t[c],a[c]))return!1;return!0}else if(t&&typeof t=="object"){var i=Object.keys(t),o;if(!a||typeof a!="object"||!n&&i.length!==Object.keys(a).length)return!1;for(var c=0,s=i.length;c<s;c++)if(o=i[c],o!=="canvas"&&!r(t[o],a[o]))return!1;return!0}}u.util.object.extend(u.Object.prototype,{hasStateChanged:function(t){t=t||e;var a="_"+t;return Object.keys(this[a]).length<this[t].length?!0:!r(this[a],this,!0)},saveState:function(t){var a=t&&t.propertySet||e,n="_"+a;return this[n]?(h(this,n,this[a]),t&&t.stateProperties&&h(this,n,t.stateProperties),this):this.setupState(t)},setupState:function(t){t=t||{};var a=t.propertySet||e;return t.propertySet=a,this["_"+a]={},this.saveState(t),this}})}(),function(){var f=u.util.degreesToRadians;u.util.object.extend(u.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=e.x,r=e.y,t,a;this.__corner=0;for(var n in this.oCoords)if(this.isControlVisible(n)&&!(n==="mtr"&&!this.hasRotatingPoint)&&!(this.get("lockUniScaling")&&(n==="mt"||n==="mr"||n==="mb"||n==="ml"))&&(a=this._getImageLines(this.oCoords[n].corner),t=this._findCrossPoints({x:h,y:r},a),t!==0&&t%2===1))return this.__corner=n,n;return!1},_setCornerCoords:function(){var e=this.oCoords,h=f(45-this.angle),r=this.cornerSize*.707106,t=r*u.util.cos(h),a=r*u.util.sin(h),n,c;for(var s in e)n=e[s].x,c=e[s].y,e[s].corner={tl:{x:n-a,y:c-t},tr:{x:n+t,y:c-a},bl:{x:n-t,y:c+a},br:{x:n+a,y:c+t}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var h=this.getCenterPoint(),r=this._calculateCurrentDimensions(),t=this.canvas.viewportTransform;return e.translate(h.x,h.y),e.scale(1/t[0],1/t[3]),e.rotate(f(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-r.x/2,-r.y/2,r.x,r.y),e.restore(),this},drawBorders:function(e,h){h=h||{};var r=this._calculateCurrentDimensions(),t=this.borderScaleFactor,a=r.x+t,n=r.y+t,c=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,s=typeof h.hasControls<"u"?h.hasControls:this.hasControls,i=typeof h.rotatingPointOffset<"u"?h.rotatingPointOffset:this.rotatingPointOffset;if(e.save(),e.strokeStyle=h.borderColor||this.borderColor,this._setLineDash(e,h.borderDashArray||this.borderDashArray,null),e.strokeRect(-a/2,-n/2,a,n),c&&this.isControlVisible("mtr")&&s){var o=-n/2;e.beginPath(),e.moveTo(0,o),e.lineTo(0,o-i),e.stroke()}return e.restore(),this},drawBordersInGroup:function(e,h,r){r=r||{};var t={x:this.width,y:this.height},a=u.util.composeMatrix({scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX}),n=u.util.transformPoint(t,a),c=this.strokeWidth,s=this.borderScaleFactor,i=n.x+c*(this.strokeUniform?this.canvas.getZoom():h.scaleX)+s,o=n.y+c*(this.strokeUniform?this.canvas.getZoom():h.scaleY)+s;return e.save(),this._setLineDash(e,r.borderDashArray||this.borderDashArray,null),e.strokeStyle=r.borderColor||this.borderColor,e.strokeRect(-i/2,-o/2,i,o),e.restore(),this},drawControls:function(e,h){h=h||{};var r=this._calculateCurrentDimensions(),t=r.x,a=r.y,n=h.cornerSize||this.cornerSize,c=-(t+n)/2,s=-(a+n)/2,i=typeof h.transparentCorners<"u"?h.transparentCorners:this.transparentCorners,o=typeof h.hasRotatingPoint<"u"?h.hasRotatingPoint:this.hasRotatingPoint,l=i?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=h.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=h.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,h.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,l,c,s,h),this._drawControl("tr",e,l,c+t,s,h),this._drawControl("bl",e,l,c,s+a,h),this._drawControl("br",e,l,c+t,s+a,h),this.get("lockUniScaling")||(this._drawControl("mt",e,l,c+t/2,s,h),this._drawControl("mb",e,l,c+t/2,s+a,h),this._drawControl("mr",e,l,c+t,s+a/2,h),this._drawControl("ml",e,l,c,s+a/2,h)),o&&this._drawControl("mtr",e,l,c+t/2,s-this.rotatingPointOffset,h),e.restore(),this},_drawControl:function(e,h,r,t,a,n){if(n=n||{},!!this.isControlVisible(e)){var c=this.cornerSize,s=!this.transparentCorners&&this.cornerStrokeColor;switch(n.cornerStyle||this.cornerStyle){case"circle":h.beginPath(),h.arc(t+c/2,a+c/2,c/2,0,2*Math.PI,!1),h[r](),s&&h.stroke();break;default:this.transparentCorners||h.clearRect(t,a,c,c),h[r+"Rect"](t,a,c,c),s&&h.strokeRect(t,a,c,c)}}},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,h){return this._getControlsVisibility()[e]=h,this},setControlsVisibility:function(e){e||(e={});for(var h in e)this.setControlVisible(h,e[h]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}(),u.util.object.extend(u.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(f,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return u.util.animate({startValue:f.left,endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(n){f.set("left",n),a.requestRenderAll(),t()},onComplete:function(){f.setCoords(),r()}}),this},fxCenterObjectV:function(f,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return u.util.animate({startValue:f.top,endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(n){f.set("top",n),a.requestRenderAll(),t()},onComplete:function(){f.setCoords(),r()}}),this},fxRemove:function(f,e){e=e||{};var h=function(){},r=e.onComplete||h,t=e.onChange||h,a=this;return u.util.animate({startValue:f.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(n){f.set("opacity",n),a.requestRenderAll(),t()},onComplete:function(){a.remove(f),r()}}),this}}),u.util.object.extend(u.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var f=[],e,h;for(e in arguments[0])f.push(e);for(var r=0,t=f.length;r<t;r++)e=f[r],h=r!==t-1,this._animate(e,arguments[0][e],arguments[1],h)}else this._animate.apply(this,arguments);return this},_animate:function(f,e,h,r){var t=this,a;e=e.toString(),h?h=u.util.object.clone(h):h={},~f.indexOf(".")&&(a=f.split("."));var n=a?this.get(a[0])[a[1]]:this.get(f);"from"in h||(h.from=n),~e.indexOf("=")?e=n+parseFloat(e.replace("=","")):e=parseFloat(e),u.util.animate({startValue:h.from,endValue:e,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(){return h.abort.call(t)},onChange:function(c,s,i){a?t[a[0]][a[1]]=c:t.set(f,c),!r&&h.onChange&&h.onChange(c,s,i)},onComplete:function(c,s,i){r||(t.setCoords(),h.onComplete&&h.onComplete(c,s,i))}})}}),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.util.object.clone,t={x1:1,x2:1,y1:1,y2:1},a=e.StaticCanvas.supports("setLineDash");if(e.Line){e.warn("fabric.Line is already defined");return}e.Line=e.util.createClass(e.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:e.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,s){c||(c=[0,0,0,0]),this.callSuper("initialize",s),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(s)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,s){return this.callSuper("_set",c,s),typeof t[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){if(c.beginPath(),!this.strokeDashArray||this.strokeDashArray&&a){var s=this.calcLinePoints();c.moveTo(s.x1,s.y1),c.lineTo(s.x2,s.y2)}c.lineWidth=this.strokeWidth;var i=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=i},_renderDashedStroke:function(c){var s=this.calcLinePoints();c.beginPath(),e.util.drawDashedLine(c,s.x1,s.y1,s.x2,s.y2,this.strokeDashArray),c.closePath()},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return h(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,s=this.y1<=this.y2?-1:1,i=c*this.width*.5,o=s*this.height*.5,l=c*this.width*-.5,d=s*this.height*-.5;return{x1:i,x2:l,y1:o,y2:d}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),e.Line.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),e.Line.fromElement=function(c,s,i){i=i||{};var o=e.parseAttributes(c,e.Line.ATTRIBUTE_NAMES),l=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];s(new e.Line(l,h(o,i)))},e.Line.fromObject=function(c,s){function i(l){delete l.points,s&&s(l)}var o=r(c,!0);o.points=[c.x1,c.y1,c.x2,c.y2],e.Object._fromObject("Line",o,i,"points")};function n(c,s){var i=c.origin,o=c.axis1,l=c.axis2,d=c.dimension,g=s.nearest,v=s.center,_=s.farthest;return function(){switch(this.get(i)){case g:return Math.min(this.get(o),this.get(l));case v:return Math.min(this.get(o),this.get(l))+.5*this.get(d);case _:return Math.max(this.get(o),this.get(l))}}}}(m),function(f){var e=f.fabric||(f.fabric={}),h=Math.PI;if(e.Circle){e.warn("fabric.Circle is already defined.");return}e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:h*2,cacheProperties:e.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(t,a){return this.callSuper("_set",t,a),t==="radius"&&this.setRadius(a),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},_toSVG:function(){var t,a=0,n=0,c=(this.endAngle-this.startAngle)%(2*h);if(c===0)t=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+n+'" ','r="',this.radius,`" />
`];else{var s=e.util.cos(this.startAngle)*this.radius,i=e.util.sin(this.startAngle)*this.radius,o=e.util.cos(this.endAngle)*this.radius,l=e.util.sin(this.endAngle)*this.radius,d=c>h?"1":"0";t=['<path d="M '+s+" "+i," A "+this.radius+" "+this.radius," 0 ",+d+" 1"," "+o+" "+l,'" ',"COMMON_PARTS",` />
`]}return t},_render:function(t){t.beginPath(),t.arc(0,0,this.radius,this.startAngle,this.endAngle,!1),this._renderPaintInOrder(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",t*2).set("height",t*2)}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),e.Circle.fromElement=function(t,a){var n=e.parseAttributes(t,e.Circle.ATTRIBUTE_NAMES);if(!r(n))throw new Error("value of `r` attribute is required and can not be negative");n.left=(n.left||0)-n.radius,n.top=(n.top||0)-n.radius,a(new e.Circle(n))};function r(t){return"radius"in t&&t.radius>=0}e.Circle.fromObject=function(t,a){return e.Object._fromObject("Circle",t,a)}}(m),function(f){var e=f.fabric||(f.fabric={});if(e.Triangle){e.warn("fabric.Triangle is already defined");return}e.Triangle=e.util.createClass(e.Object,{type:"triangle",width:100,height:100,_render:function(h){var r=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-r,t),h.lineTo(0,-t),h.lineTo(r,t),h.closePath(),this._renderPaintInOrder(h)},_renderDashedStroke:function(h){var r=this.width/2,t=this.height/2;h.beginPath(),e.util.drawDashedLine(h,-r,t,0,-t,this.strokeDashArray),e.util.drawDashedLine(h,0,-t,r,t,this.strokeDashArray),e.util.drawDashedLine(h,r,t,-r,t,this.strokeDashArray),h.closePath()},_toSVG:function(){var h=this.width/2,r=this.height/2,t=[-h+" "+r,"0 "+-r,h+" "+r].join(",");return["<polygon ","COMMON_PARTS",'points="',t,'" />']}}),e.Triangle.fromObject=function(h,r){return e.Object._fromObject("Triangle",h,r)}}(m),function(f){var e=f.fabric||(f.fabric={}),h=Math.PI*2;if(e.Ellipse){e.warn("fabric.Ellipse is already defined.");return}e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(r){this.callSuper("initialize",r),this.set("rx",r&&r.rx||0),this.set("ry",r&&r.ry||0)},_set:function(r,t){switch(this.callSuper("_set",r,t),r){case"rx":this.rx=t,this.set("width",t*2);break;case"ry":this.ry=t,this.set("height",t*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(r){return this.callSuper("toObject",["rx","ry"].concat(r))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(r){r.beginPath(),r.save(),r.transform(1,0,0,this.ry/this.rx,0,0),r.arc(0,0,this.rx,0,h,!1),r.restore(),this._renderPaintInOrder(r)}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),e.Ellipse.fromElement=function(r,t){var a=e.parseAttributes(r,e.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,t(new e.Ellipse(a))},e.Ellipse.fromObject=function(r,t){return e.Object._fromObject("Ellipse",r,t)}}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend;if(e.Rect){e.warn("fabric.Rect is already defined");return}e.Rect=e.util.createClass(e.Object,{stateProperties:e.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:e.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(r){this.callSuper("initialize",r),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(r){var t=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,c=this.height,s=-this.width/2,i=-this.height/2,o=t!==0||a!==0,l=1-.5522847498;r.beginPath(),r.moveTo(s+t,i),r.lineTo(s+n-t,i),o&&r.bezierCurveTo(s+n-l*t,i,s+n,i+l*a,s+n,i+a),r.lineTo(s+n,i+c-a),o&&r.bezierCurveTo(s+n,i+c-l*a,s+n-l*t,i+c,s+n-t,i+c),r.lineTo(s+t,i+c),o&&r.bezierCurveTo(s+l*t,i+c,s,i+c-l*a,s,i+c-a),r.lineTo(s,i+a),o&&r.bezierCurveTo(s,i+l*a,s+l*t,i,s+t,i),r.closePath(),this._renderPaintInOrder(r)},_renderDashedStroke:function(r){var t=-this.width/2,a=-this.height/2,n=this.width,c=this.height;r.beginPath(),e.util.drawDashedLine(r,t,a,t+n,a,this.strokeDashArray),e.util.drawDashedLine(r,t+n,a,t+n,a+c,this.strokeDashArray),e.util.drawDashedLine(r,t+n,a+c,t,a+c,this.strokeDashArray),e.util.drawDashedLine(r,t,a+c,t,a,this.strokeDashArray),r.closePath()},toObject:function(r){return this.callSuper("toObject",["rx","ry"].concat(r))},_toSVG:function(){var r=-this.width/2,t=-this.height/2;return["<rect ","COMMON_PARTS",'x="',r,'" y="',t,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(r,t,a){if(!r)return t(null);a=a||{};var n=e.parseAttributes(r,e.Rect.ATTRIBUTE_NAMES);n.left=n.left||0,n.top=n.top||0,n.height=n.height||0,n.width=n.width||0;var c=new e.Rect(h(a?e.util.object.clone(a):{},n));c.visible=c.visible&&c.width>0&&c.height>0,t(c)},e.Rect.fromObject=function(r,t){return e.Object._fromObject("Rect",r,t)}}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.util.array.min,t=e.util.array.max,a=e.util.toFixed;if(e.Polyline){e.warn("fabric.Polyline is already defined");return}e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,cacheProperties:e.Object.prototype.cacheProperties.concat("points"),initialize:function(n,c){c=c||{},this.points=n||[],this.callSuper("initialize",c),this._setPositionDimensions(c)},_setPositionDimensions:function(n){var c=this._calcDimensions(n),s;this.width=c.width,this.height=c.height,n.fromSVG||(s=this.translateToGivenOrigin({x:c.left-this.strokeWidth/2,y:c.top-this.strokeWidth/2},"left","top",this.originX,this.originY)),typeof n.left>"u"&&(this.left=n.fromSVG?c.left:s.x),typeof n.top>"u"&&(this.top=n.fromSVG?c.top:s.y),this.pathOffset={x:c.left+this.width/2,y:c.top+this.height/2}},_calcDimensions:function(){var n=this.points,c=r(n,"x")||0,s=r(n,"y")||0,i=t(n,"x")||0,o=t(n,"y")||0,l=i-c,d=o-s;return{left:c,top:s,width:l,height:d}},toObject:function(n){return h(this.callSuper("toObject",n),{points:this.points.concat()})},_toSVG:function(){for(var n=[],c=this.pathOffset.x,s=this.pathOffset.y,i=e.Object.NUM_FRACTION_DIGITS,o=0,l=this.points.length;o<l;o++)n.push(a(this.points[o].x-c,i),",",a(this.points[o].y-s,i)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',n.join(""),`" />
`]},commonRender:function(n){var c,s=this.points.length,i=this.pathOffset.x,o=this.pathOffset.y;if(!s||isNaN(this.points[s-1].y))return!1;n.beginPath(),n.moveTo(this.points[0].x-i,this.points[0].y-o);for(var l=0;l<s;l++)c=this.points[l],n.lineTo(c.x-i,c.y-o);return!0},_render:function(n){this.commonRender(n)&&this._renderPaintInOrder(n)},_renderDashedStroke:function(n){var c,s;n.beginPath();for(var i=0,o=this.points.length;i<o;i++)c=this.points[i],s=this.points[i+1]||c,e.util.drawDashedLine(n,c.x,c.y,s.x,s.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElementGenerator=function(n){return function(c,s,i){if(!c)return s(null);i||(i={});var o=e.parsePointsAttribute(c.getAttribute("points")),l=e.parseAttributes(c,e[n].ATTRIBUTE_NAMES);l.fromSVG=!0,s(new e[n](o,h(l,i)))}},e.Polyline.fromElement=e.Polyline.fromElementGenerator("Polyline"),e.Polyline.fromObject=function(n,c){return e.Object._fromObject("Polyline",n,c,"points")}}(m),function(f){var e=f.fabric||(f.fabric={});if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Polyline,{type:"polygon",_render:function(h){this.commonRender(h)&&(h.closePath(),this._renderPaintInOrder(h))},_renderDashedStroke:function(h){this.callSuper("_renderDashedStroke",h),h.closePath()}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=e.Polyline.fromElementGenerator("Polygon"),e.Polygon.fromObject=function(h,r){return e.Object._fromObject("Polygon",h,r,"points")}}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.array.min,r=e.util.array.max,t=e.util.object.extend,a=Object.prototype.toString,n=e.util.drawArc,c=e.util.toFixed,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};if(e.Path){e.warn("fabric.Path is already defined");return}e.Path=e.util.createClass(e.Object,{type:"path",path:null,cacheProperties:e.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:e.Object.prototype.stateProperties.concat("path"),initialize:function(o,l){l=l||{},this.callSuper("initialize",l),o||(o=[]);var d=a.call(o)==="[object Array]";this.path=d?o:o.match&&o.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(d||(this.path=this._parsePath()),e.Polyline.prototype._setPositionDimensions.call(this,l))},_renderPathCommands:function(o){var l,d=null,g=0,v=0,_=0,p=0,C=0,S=0,O,k,P=-this.pathOffset.x,F=-this.pathOffset.y;o.beginPath();for(var E=0,X=this.path.length;E<X;++E){switch(l=this.path[E],l[0]){case"l":_+=l[1],p+=l[2],o.lineTo(_+P,p+F);break;case"L":_=l[1],p=l[2],o.lineTo(_+P,p+F);break;case"h":_+=l[1],o.lineTo(_+P,p+F);break;case"H":_=l[1],o.lineTo(_+P,p+F);break;case"v":p+=l[1],o.lineTo(_+P,p+F);break;case"V":p=l[1],o.lineTo(_+P,p+F);break;case"m":_+=l[1],p+=l[2],g=_,v=p,o.moveTo(_+P,p+F);break;case"M":_=l[1],p=l[2],g=_,v=p,o.moveTo(_+P,p+F);break;case"c":O=_+l[5],k=p+l[6],C=_+l[3],S=p+l[4],o.bezierCurveTo(_+l[1]+P,p+l[2]+F,C+P,S+F,O+P,k+F),_=O,p=k;break;case"C":_=l[5],p=l[6],C=l[3],S=l[4],o.bezierCurveTo(l[1]+P,l[2]+F,C+P,S+F,_+P,p+F);break;case"s":O=_+l[3],k=p+l[4],d[0].match(/[CcSs]/)===null?(C=_,S=p):(C=2*_-C,S=2*p-S),o.bezierCurveTo(C+P,S+F,_+l[1]+P,p+l[2]+F,O+P,k+F),C=_+l[1],S=p+l[2],_=O,p=k;break;case"S":O=l[3],k=l[4],d[0].match(/[CcSs]/)===null?(C=_,S=p):(C=2*_-C,S=2*p-S),o.bezierCurveTo(C+P,S+F,l[1]+P,l[2]+F,O+P,k+F),_=O,p=k,C=l[1],S=l[2];break;case"q":O=_+l[3],k=p+l[4],C=_+l[1],S=p+l[2],o.quadraticCurveTo(C+P,S+F,O+P,k+F),_=O,p=k;break;case"Q":O=l[3],k=l[4],o.quadraticCurveTo(l[1]+P,l[2]+F,O+P,k+F),_=O,p=k,C=l[1],S=l[2];break;case"t":O=_+l[1],k=p+l[2],d[0].match(/[QqTt]/)===null?(C=_,S=p):(C=2*_-C,S=2*p-S),o.quadraticCurveTo(C+P,S+F,O+P,k+F),_=O,p=k;break;case"T":O=l[1],k=l[2],d[0].match(/[QqTt]/)===null?(C=_,S=p):(C=2*_-C,S=2*p-S),o.quadraticCurveTo(C+P,S+F,O+P,k+F),_=O,p=k;break;case"a":n(o,_+P,p+F,[l[1],l[2],l[3],l[4],l[5],l[6]+_+P,l[7]+p+F]),_+=l[6],p+=l[7];break;case"A":n(o,_+P,p+F,[l[1],l[2],l[3],l[4],l[5],l[6]+P,l[7]+F]),_=l[6],p=l[7];break;case"z":case"Z":_=g,p=v,o.closePath();break}d=l}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return t(this.callSuper("toObject",o),{path:this.path.map(function(l){return l.slice()})})},toDatalessObject:function(o){var l=this.toObject(["sourcePath"].concat(o));return l.sourcePath&&delete l.path,l},_toSVG:function(){var o=this.path.map(function(l){return l.join(" ")}).join(" ");return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=e.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,o)+", "+c(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var l=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},toSVG:function(o){var l=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:l})},complexity:function(){return this.path.length},_parsePath:function(){for(var o=[],l=[],d,g,v=e.rePathCommand,_,p,C=0,S,O=this.path.length;C<O;C++){for(d=this.path[C],p=d.slice(1).trim(),l.length=0;_=v.exec(p);)l.push(_[0]);S=[d.charAt(0)];for(var k=0,P=l.length;k<P;k++)g=parseFloat(l[k]),isNaN(g)||S.push(g);var F=S[0],E=s[F.toLowerCase()],X=i[F]||F;if(S.length-1>E)for(var z=1,V=S.length;z<V;z+=E)o.push([F].concat(S.slice(z,z+E))),F=X;else o.push(S)}return o},_calcDimensions:function(){for(var o=[],l=[],d,g=null,v=0,_=0,p=0,C=0,S=0,O=0,k,P,F,E=0,X=this.path.length;E<X;++E){switch(d=this.path[E],d[0]){case"l":p+=d[1],C+=d[2],F=[];break;case"L":p=d[1],C=d[2],F=[];break;case"h":p+=d[1],F=[];break;case"H":p=d[1],F=[];break;case"v":C+=d[1],F=[];break;case"V":C=d[1],F=[];break;case"m":p+=d[1],C+=d[2],v=p,_=C,F=[];break;case"M":p=d[1],C=d[2],v=p,_=C,F=[];break;case"c":k=p+d[5],P=C+d[6],S=p+d[3],O=C+d[4],F=e.util.getBoundsOfCurve(p,C,p+d[1],C+d[2],S,O,k,P),p=k,C=P;break;case"C":S=d[3],O=d[4],F=e.util.getBoundsOfCurve(p,C,d[1],d[2],S,O,d[5],d[6]),p=d[5],C=d[6];break;case"s":k=p+d[3],P=C+d[4],g[0].match(/[CcSs]/)===null?(S=p,O=C):(S=2*p-S,O=2*C-O),F=e.util.getBoundsOfCurve(p,C,S,O,p+d[1],C+d[2],k,P),S=p+d[1],O=C+d[2],p=k,C=P;break;case"S":k=d[3],P=d[4],g[0].match(/[CcSs]/)===null?(S=p,O=C):(S=2*p-S,O=2*C-O),F=e.util.getBoundsOfCurve(p,C,S,O,d[1],d[2],k,P),p=k,C=P,S=d[1],O=d[2];break;case"q":k=p+d[3],P=C+d[4],S=p+d[1],O=C+d[2],F=e.util.getBoundsOfCurve(p,C,S,O,S,O,k,P),p=k,C=P;break;case"Q":S=d[1],O=d[2],F=e.util.getBoundsOfCurve(p,C,S,O,S,O,d[3],d[4]),p=d[3],C=d[4];break;case"t":k=p+d[1],P=C+d[2],g[0].match(/[QqTt]/)===null?(S=p,O=C):(S=2*p-S,O=2*C-O),F=e.util.getBoundsOfCurve(p,C,S,O,S,O,k,P),p=k,C=P;break;case"T":k=d[1],P=d[2],g[0].match(/[QqTt]/)===null?(S=p,O=C):(S=2*p-S,O=2*C-O),F=e.util.getBoundsOfCurve(p,C,S,O,S,O,k,P),p=k,C=P;break;case"a":F=e.util.getBoundsOfArc(p,C,d[1],d[2],d[3],d[4],d[5],d[6]+p,d[7]+C),p+=d[6],C+=d[7];break;case"A":F=e.util.getBoundsOfArc(p,C,d[1],d[2],d[3],d[4],d[5],d[6],d[7]),p=d[6],C=d[7];break;case"z":case"Z":p=v,C=_;break}g=d,F.forEach(function(I){o.push(I.x),l.push(I.y)}),o.push(p),l.push(C)}var z=h(o)||0,V=h(l)||0,J=r(o)||0,T=r(l)||0,j=J-z,R=T-V;return{left:z,top:V,width:j,height:R}}}),e.Path.fromObject=function(o,l){if(typeof o.sourcePath=="string"){var d=o.sourcePath;e.loadSVGFromURL(d,function(g){var v=g[0];v.setOptions(o),l&&l(v)})}else e.Object._fromObject("Path",o,l,"path")},e.Path.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(o,l,d){var g=e.parseAttributes(o,e.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,l(new e.Path(g.d,t(g,d)))}}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.array.min,r=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,a,n){a=a||{},this._objects=[],n&&this.callSuper("initialize",a),this._objects=t||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;if(n)this._updateObjectsACoords();else{var s=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),s||this._calcBounds(),this._updateObjectsCoords(s),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var t=!0,a=!0,n=this._objects.length;n--;)this._objects[n].setCoords(t,a)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],a)},_updateObjectCoords:function(t,a){var n=t.left,c=t.top,s=!0,i=!0;t.set({left:n-a.x,top:c-a.y}),t.group=this,t.setCoords(s,i)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,a){var n=this._objects.length;if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,a);if(t==="canvas")for(;n--;)this._objects[n]._set(t,a);e.Object.prototype._set.call(this,t,a)},toObject:function(t){var a=this.includeDefaultValues,n=this._objects.map(function(s){var i=s.includeDefaultValues;s.includeDefaultValues=a;var o=s.toObject(t);return s.includeDefaultValues=i,o}),c=e.Object.prototype.toObject.call(this,t);return c.objects=n,c},toDatalessObject:function(t){var a,n=this.sourcePath;if(n)a=n;else{var c=this.includeDefaultValues;a=this._objects.map(function(i){var o=i.includeDefaultValues;i.includeDefaultValues=c;var l=i.toDatalessObject(t);return i.includeDefaultValues=o,l})}var s=e.Object.prototype.toDatalessObject.call(this,t);return s.objects=a,s},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=e.Object.prototype.shouldCache.call(this);if(t){for(var a=0,n=this._objects.length;a<n;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return t},willDrawShadow:function(){if(e.Object.prototype.willDrawShadow.call(this))return!0;for(var t=0,a=this._objects.length;t<a;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var a=0,n=this._objects.length;a<n;a++)this._objects[a].render(t);this._drawClipPath(t)},isCacheDirty:function(t){if(this.callSuper("isCacheDirty",t))return!0;if(!this.statefullCache)return!1;for(var a=0,n=this._objects.length;a<n;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var c=this.cacheWidth/this.zoomX,s=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-c/2,-s/2,c,s)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var a=t.calcTransformMatrix(),n=e.util.qrDecompose(a),c=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(c,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,a=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var c=new e.ActiveSelection([]);return c.set(n),c.type="activeSelection",a.remove(this),t.forEach(function(s){s.group=c,s.dirty=!0,a.add(s)}),c.canvas=a,c._objects=t,a._activeObject=c,c.setCoords(),c}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var t=!0,a=!0;return this.forEachObject(function(n){n.setCoords(t,a)}),this},_calcBounds:function(t){for(var a=[],n=[],c,s,i=["tr","br","bl","tl"],o=0,l=this._objects.length,d,g=i.length,v=!0;o<l;++o)for(c=this._objects[o],c.setCoords(v),d=0;d<g;d++)s=i[d],a.push(c.oCoords[s].x),n.push(c.oCoords[s].y);this._getBounds(a,n,t)},_getBounds:function(t,a,n){var c=new e.Point(h(t),h(a)),s=new e.Point(r(t),r(a)),i=c.y||0,o=c.x||0,l=s.x-c.x||0,d=s.y-c.y||0;this.width=l,this.height=d,n||this.setPositionByOrigin({x:o,y:i},"left","top")},_toSVG:function(t){for(var a=["<g ","COMMON_PARTS",` >
`],n=0,c=this._objects.length;n<c;n++)a.push("		",this._objects[n].toSVG(t));return a.push(`</g>
`),a},getSvgStyles:function(){var t=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),a].join("")},toClipPathSVG:function(t){for(var a=[],n=0,c=this._objects.length;n<c;n++)a.push("	",this._objects[n].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(a,{reviver:t})}}),e.Group.fromObject=function(t,a){var n=t.objects,c=e.util.object.clone(t,!0);if(delete c.objects,typeof n=="string"){e.loadSVGFromURL(n,function(s){var i=e.util.groupSVGElements(s,t,n);i.set(c),a&&a(i)});return}e.util.enlivenObjects(n,function(s){e.util.enlivenObjects([t.clipPath],function(i){var o=e.util.object.clone(t,!0);o.clipPath=i[0],delete o.objects,a&&a(new e.Group(s,o,!0))})})})}(m),function(f){var e=f.fabric||(f.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(h,r){r=r||{},this._objects=h||[];for(var t=this._objects.length;t--;)this._objects[t].group=this;r.originX&&(this.originX=r.originX),r.originY&&(this.originY=r.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,r),this.setCoords()},toGroup:function(){var h=this._objects.concat();this._objects=[];var r=e.Object.prototype.toObject.call(this),t=new e.Group([]);if(delete r.type,t.set(r),h.forEach(function(n){n.canvas.remove(n),n.group=t}),t._objects=h,!this.canvas)return t;var a=this.canvas;return a.add(t),a._activeObject=t,t.setCoords(),t},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(h,r,t){h.save(),h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",h,r),t=t||{},typeof t.hasControls>"u"&&(t.hasControls=!1),typeof t.hasRotatingPoint>"u"&&(t.hasRotatingPoint=!1),t.forActiveSelection=!0;for(var a=0,n=this._objects.length;a<n;a++)this._objects[a]._renderControls(h,t);h.restore()}}),e.ActiveSelection.fromObject=function(h,r){e.util.enlivenObjects(h.objects,function(t){delete h.objects,r&&r(new e.ActiveSelection(t,h,!0))})})}(m),function(f){var e=u.util.object.extend;if(f.fabric||(f.fabric={}),f.fabric.Image){u.warn("fabric.Image is already defined.");return}u.Image=u.util.createClass(u.Object,{type:"image",crossOrigin:"",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:u.Object.prototype.stateProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,initialize:function(h,r){r||(r={}),this.filters=[],this.cacheKey="texture"+u.Object.__uid++,this.callSuper("initialize",r),this._initElement(h,r)},getElement:function(){return this._element||{}},setElement:function(h,r){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=h,this._originalElement=h,this._initConfig(r),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(h){var r=u.filterBackend;r&&r.evictCachesForKey&&r.evictCachesForKey(h)},dispose:function(){this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(h){u.util.cleanUpJsdomNode(this[h]),this[h]=void 0}.bind(this))},setCrossOrigin:function(h){return this.crossOrigin=h,this._element.crossOrigin=h,this},getOriginalSize:function(){var h=this.getElement();return{width:h.naturalWidth||h.width,height:h.naturalHeight||h.height}},_stroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){var r=this.width/2,t=this.height/2;h.beginPath(),h.moveTo(-r,-t),h.lineTo(r,-t),h.lineTo(r,t),h.lineTo(-r,t),h.lineTo(-r,-t),h.closePath()}},_renderDashedStroke:function(h){var r=-this.width/2,t=-this.height/2,a=this.width,n=this.height;h.save(),this._setStrokeStyles(h,this),h.beginPath(),u.util.drawDashedLine(h,r,t,r+a,t,this.strokeDashArray),u.util.drawDashedLine(h,r+a,t,r+a,t+n,this.strokeDashArray),u.util.drawDashedLine(h,r+a,t+n,r,t+n,this.strokeDashArray),u.util.drawDashedLine(h,r,t+n,r,t,this.strokeDashArray),h.closePath(),h.restore()},toObject:function(h){var r=[];this.filters.forEach(function(a){a&&r.push(a.toObject())});var t=e(this.callSuper("toObject",["crossOrigin","cropX","cropY"].concat(h)),{src:this.getSrc(),filters:r});return this.resizeFilter&&(t.resizeFilter=this.resizeFilter.toObject()),t},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var h=[],r=[],t,a=-this.width/2,n=-this.height/2,c="";if(this.hasCrop()){var s=u.Object.__uid++;h.push('<clipPath id="imageCrop_'+s+`">
`,'	<rect x="'+a+'" y="'+n+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+s+')" '}if(r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',a-this.cropX,'" y="',n-this.cropY,'" width="',this._element.width||this._element.naturalWidth,'" height="',this._element.height||this._element.height,'"',c,`></image>
`),this.stroke||this.strokeDashArray){var i=this.fill;this.fill=null,t=["	<rect ",'x="',a,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=i}return this.paintFirst!=="fill"?h=h.concat(t,r):h=h.concat(r,t),h},getSrc:function(h){var r=h?this._element:this._originalElement;return r?r.toDataURL?r.toDataURL():this.srcFromAttribute?r.getAttribute("src"):r.src:this.src||""},setSrc:function(h,r,t){return u.util.loadImage(h,function(a){this.setElement(a,t),this._setWidthHeight(),r&&r(this)},this,t&&t.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var h=this.resizeFilter,r=this.minimumScaleTrigger,t=this.getTotalObjectScaling(),a=t.scaleX,n=t.scaleY,c=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!h||a>r&&n>r){this._element=c,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=n;return}u.filterBackend||(u.filterBackend=u.initFilterBackend());var s=u.util.createCanvasElement(),i=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,o=c.width,l=c.height;s.width=o,s.height=l,this._element=s,this._lastScaleX=h.scaleX=a,this._lastScaleY=h.scaleY=n,u.filterBackend.applyFilters([h],c,o,l,this._element,i),this._filterScalingX=s.width/this._originalElement.width,this._filterScalingY=s.height/this._originalElement.height},applyFilters:function(h){if(h=h||this.filters||[],h=h.filter(function(c){return c&&!c.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),h.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var r=this._originalElement,t=r.naturalWidth||r.width,a=r.naturalHeight||r.height;if(this._element===this._originalElement){var n=u.util.createCanvasElement();n.width=t,n.height=a,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,t,a),this._lastScaleX=1,this._lastScaleY=1;return u.filterBackend||(u.filterBackend=u.initFilterBackend()),u.filterBackend.applyFilters(h,this._originalElement,t,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(h){this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(h),this._renderPaintInOrder(h)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(h){var r=this._element,t=this.width,a=this.height,n=Math.min(r.naturalWidth||r.width,t*this._filterScalingX),c=Math.min(r.naturalHeight||r.height,a*this._filterScalingY),s=-t/2,i=-a/2,o=Math.max(0,this.cropX*this._filterScalingX),l=Math.max(0,this.cropY*this._filterScalingY);r&&h.drawImage(r,o,l,n,c,s,i,t,a)},_needsResize:function(){var h=this.getTotalObjectScaling();return h.scaleX!==this._lastScaleX||h.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(h,r){this.setElement(u.util.getById(h),r),u.util.addClass(this.getElement(),u.Image.CSS_CANVAS)},_initConfig:function(h){h||(h={}),this.setOptions(h),this._setWidthHeight(h),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(h,r){h&&h.length?u.util.enlivenObjects(h,function(t){r&&r(t)},"fabric.Image.filters"):r&&r()},_setWidthHeight:function(h){h||(h={});var r=this.getElement();this.width=h.width||r.naturalWidth||r.width||0,this.height=h.height||r.naturalHeight||r.height||0},parsePreserveAspectRatioAttribute:function(){var h=u.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,t=this._element.height,a=1,n=1,c=0,s=0,i=0,o=0,l,d=this.width,g=this.height,v={width:d,height:g};return h&&(h.alignX!=="none"||h.alignY!=="none")?(h.meetOrSlice==="meet"&&(a=n=u.util.findScaleToFit(this._element,v),l=(d-r*a)/2,h.alignX==="Min"&&(c=-l),h.alignX==="Max"&&(c=l),l=(g-t*n)/2,h.alignY==="Min"&&(s=-l),h.alignY==="Max"&&(s=l)),h.meetOrSlice==="slice"&&(a=n=u.util.findScaleToCover(this._element,v),l=r-d/a,h.alignX==="Mid"&&(i=l/2),h.alignX==="Max"&&(i=l),l=t-g/n,h.alignY==="Mid"&&(o=l/2),h.alignY==="Max"&&(o=l),r=d/a,t=g/n)):(a=d/r,n=g/t),{width:r,height:t,scaleX:a,scaleY:n,offsetLeft:c,offsetTop:s,cropX:i,cropY:o}}}),u.Image.CSS_CANVAS="canvas-img",u.Image.prototype.getSvgSrc=u.Image.prototype.getSrc,u.Image.fromObject=function(h,r){var t=u.util.object.clone(h);u.util.loadImage(t.src,function(a,n){if(n){r&&r(null,n);return}u.Image.prototype._initFilters.call(t,t.filters,function(c){t.filters=c||[],u.Image.prototype._initFilters.call(t,[t.resizeFilter],function(s){t.resizeFilter=s[0],u.util.enlivenObjects([t.clipPath],function(i){t.clipPath=i[0];var o=new u.Image(a,t);r(o)})})})},null,t.crossOrigin)},u.Image.fromURL=function(h,r,t){u.util.loadImage(h,function(a){r&&r(new u.Image(a,t))},null,t&&t.crossOrigin)},u.Image.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin".split(" ")),u.Image.fromElement=function(h,r,t){var a=u.parseAttributes(h,u.Image.ATTRIBUTE_NAMES);u.Image.fromURL(a["xlink:href"],r,e(t?u.util.object.clone(t):{},a))}}(m),u.util.object.extend(u.Object.prototype,{_getAngleValueForStraighten:function(){var f=this.angle%360;return f>0?Math.round((f-1)/90)*90:Math.round(f/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten()),this},fxStraighten:function(f){f=f||{};var e=function(){},h=f.onComplete||e,r=f.onChange||e,t=this;return u.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){t.rotate(a),r()},onComplete:function(){t.setCoords(),h()}}),this}}),u.util.object.extend(u.StaticCanvas.prototype,{straightenObject:function(f){return f.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(f){return f.fxStraighten({onChange:this.requestRenderAllBound}),this}}),function(){function f(h,r){var t="precision "+r+` float;
void main(){}`,a=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(a,t),h.compileShader(a),!!h.getShaderParameter(a,h.COMPILE_STATUS)}u.isWebglSupported=function(h){if(u.isLikelyNode)return!1;h=h||u.WebglFilterBackend.prototype.tileSize;var r=document.createElement("canvas"),t=r.getContext("webgl")||r.getContext("experimental-webgl"),a=!1;if(t){u.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),a=u.maxTextureSize>=h;for(var n=["highp","mediump","lowp"],c=0;c<3;c++)if(f(t,n[c])){u.webGlPrecision=n[c];break}}return this.isSupported=a,a},u.WebglFilterBackend=e;function e(h){h&&h.tileSize&&(this.tileSize=h.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}e.prototype={tileSize:2048,resources:{},setupGLContext:function(h,r){this.dispose(),this.createWebGLCanvas(h,r),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(h,r)},chooseFastestCopyGLTo2DMethod:function(h,r){var t=typeof window.performance<"u",a;try{new ImageData(1,1),a=!0}catch{a=!1}var n=typeof ArrayBuffer<"u",c=typeof Uint8ClampedArray<"u";if(t&&a&&n&&c){var s=u.util.createCanvasElement(),i=new ArrayBuffer(h*r*4);if(u.forceGLPutImageData){this.imageBuffer=i,this.copyGLTo2D=D;return}var o={imageBuffer:i,destinationWidth:h,destinationHeight:r,targetCanvas:s},l,d,g;s.width=h,s.height=r,l=window.performance.now(),w.call(o,this.gl,o),d=window.performance.now()-l,l=window.performance.now(),D.call(o,this.gl,o),g=window.performance.now()-l,d>g?(this.imageBuffer=i,this.copyGLTo2D=D):this.copyGLTo2D=w}},createWebGLCanvas:function(h,r){var t=u.util.createCanvasElement();t.width=h,t.height=r;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},n=t.getContext("webgl",a);n||(n=t.getContext("experimental-webgl",a)),n&&(n.clearColor(0,0,0,0),this.canvas=t,this.gl=n)},applyFilters:function(h,r,t,a,n,c){var s=this.gl,i;c&&(i=this.getCachedTexture(c,r));var o={originalWidth:r.width||r.originalWidth,originalHeight:r.height||r.originalHeight,sourceWidth:t,sourceHeight:a,destinationWidth:t,destinationHeight:a,context:s,sourceTexture:this.createTexture(s,t,a,!i&&r),targetTexture:this.createTexture(s,t,a),originalTexture:i||this.createTexture(s,t,a,!i&&r),passes:h.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},l=s.createFramebuffer();return s.bindFramebuffer(s.FRAMEBUFFER,l),h.forEach(function(d){d&&d.applyTo(o)}),x(o),this.copyGLTo2D(s,o),s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(o.sourceTexture),s.deleteTexture(o.targetTexture),s.deleteFramebuffer(l),n.getContext("2d").setTransform(1,0,0,1,0,0),o},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(h,r,t,a){var n=h.createTexture();return h.bindTexture(h.TEXTURE_2D,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),a?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,a):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,r,t,0,h.RGBA,h.UNSIGNED_BYTE,null),n},getCachedTexture:function(h,r){if(this.textureCache[h])return this.textureCache[h];var t=this.createTexture(this.gl,r.width,r.height,r);return this.textureCache[h]=t,t},evictCachesForKey:function(h){this.textureCache[h]&&(this.gl.deleteTexture(this.textureCache[h]),delete this.textureCache[h])},copyGLTo2D:w,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var h=this.gl,r={renderer:"",vendor:""};if(!h)return r;var t=h.getExtension("WEBGL_debug_renderer_info");if(t){var a=h.getParameter(t.UNMASKED_RENDERER_WEBGL),n=h.getParameter(t.UNMASKED_VENDOR_WEBGL);a&&(r.renderer=a.toLowerCase()),n&&(r.vendor=n.toLowerCase())}return this.gpuInfo=r,r}}}();function x(f){var e=f.targetCanvas,h=e.width,r=e.height,t=f.destinationWidth,a=f.destinationHeight;(h!==t||r!==a)&&(e.width=t,e.height=a)}function w(f,e){var h=f.canvas,r=e.targetCanvas,t=r.getContext("2d");t.translate(0,r.height),t.scale(1,-1);var a=h.height-r.height;t.drawImage(h,0,a,r.width,r.height,0,0,r.width,r.height)}function D(f,e){var h=e.targetCanvas,r=h.getContext("2d"),t=e.destinationWidth,a=e.destinationHeight,n=t*a*4,c=new Uint8Array(this.imageBuffer,0,n),s=new Uint8ClampedArray(this.imageBuffer,0,n);f.readPixels(0,0,t,a,f.RGBA,f.UNSIGNED_BYTE,c);var i=new ImageData(s,t,a);r.putImageData(i,0,0)}(function(){var f=function(){};u.Canvas2dFilterBackend=e;function e(){}e.prototype={evictCachesForKey:f,dispose:f,clearWebGLCaches:f,resources:{},applyFilters:function(h,r,t,a,n){var c=n.getContext("2d");c.drawImage(r,0,0,t,a);var s=c.getImageData(0,0,t,a),i=c.getImageData(0,0,t,a),o={sourceWidth:t,sourceHeight:a,imageData:s,originalEl:r,originalImageData:i,canvasEl:n,ctx:c,filterBackend:this};return h.forEach(function(l){l.applyTo(o)}),(o.imageData.width!==t||o.imageData.height!==a)&&(n.width=o.imageData.width,n.height=o.imageData.height),c.putImageData(o.imageData,0,0),o}}})(),u.Image=u.Image||{},u.Image.filters=u.Image.filters||{},u.Image.filters.BaseFilter=u.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(f){f&&this.setOptions(f)},setOptions:function(f){for(var e in f)this[e]=f[e]},createProgram:function(f,e,h){e=e||this.fragmentSource,h=h||this.vertexSource,u.webGlPrecision!=="highp"&&(e=e.replace(/precision highp float/g,"precision "+u.webGlPrecision+" float"));var r=f.createShader(f.VERTEX_SHADER);if(f.shaderSource(r,h),f.compileShader(r),!f.getShaderParameter(r,f.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+f.getShaderInfoLog(r));var t=f.createShader(f.FRAGMENT_SHADER);if(f.shaderSource(t,e),f.compileShader(t),!f.getShaderParameter(t,f.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+f.getShaderInfoLog(t));var a=f.createProgram();if(f.attachShader(a,r),f.attachShader(a,t),f.linkProgram(a),!f.getProgramParameter(a,f.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+f.getProgramInfoLog(a));var n=this.getAttributeLocations(f,a),c=this.getUniformLocations(f,a)||{};return c.uStepW=f.getUniformLocation(a,"uStepW"),c.uStepH=f.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:n,uniformLocations:c}},getAttributeLocations:function(f,e){return{aPosition:f.getAttribLocation(e,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(f,e,h){var r=e.aPosition,t=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,t),f.enableVertexAttribArray(r),f.vertexAttribPointer(r,2,f.FLOAT,!1,0,0),f.bufferData(f.ARRAY_BUFFER,h,f.STATIC_DRAW)},_setupFrameBuffer:function(f){var e=f.context,h,r;f.passes>1?(h=f.destinationWidth,r=f.destinationHeight,(f.sourceWidth!==h||f.sourceHeight!==r)&&(e.deleteTexture(f.targetTexture),f.targetTexture=f.filterBackend.createTexture(e,h,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f.targetTexture,0)):(e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish())},_swapTextures:function(f){f.passes--,f.pass++;var e=f.targetTexture;f.targetTexture=f.sourceTexture,f.sourceTexture=e},isNeutralState:function(){var f=this.mainParameter,e=u.Image.filters[this.type].prototype;if(f)if(Array.isArray(e[f])){for(var h=e[f].length;h--;)if(this[f][h]!==e[f][h])return!1;return!0}else return e[f]===this[f];else return!1},applyTo:function(f){f.webgl?(this._setupFrameBuffer(f),this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)},retrieveShader:function(f){return f.programCache.hasOwnProperty(this.type)||(f.programCache[this.type]=this.createProgram(f.context)),f.programCache[this.type]},applyToWebGL:function(f){var e=f.context,h=this.retrieveShader(f);f.pass===0&&f.originalTexture?e.bindTexture(e.TEXTURE_2D,f.originalTexture):e.bindTexture(e.TEXTURE_2D,f.sourceTexture),e.useProgram(h.program),this.sendAttributeData(e,h.attributeLocations,f.aPosition),e.uniform1f(h.uniformLocations.uStepW,1/f.sourceWidth),e.uniform1f(h.uniformLocations.uStepH,1/f.sourceHeight),this.sendUniformData(e,h.uniformLocations),e.viewport(0,0,f.destinationWidth,f.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(f,e,h){f.activeTexture(h),f.bindTexture(f.TEXTURE_2D,e),f.activeTexture(f.TEXTURE0)},unbindAdditionalTexture:function(f,e){f.activeTexture(e),f.bindTexture(f.TEXTURE_2D,null),f.activeTexture(f.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(f){this[this.mainParameter]=f},sendUniformData:function(){},createHelpLayer:function(f){if(!f.helpLayer){var e=document.createElement("canvas");e.width=f.sourceWidth,e.height=f.sourceHeight,f.helpLayer=e}},toObject:function(){var f={type:this.type},e=this.mainParameter;return e&&(f[e]=this[e]),f},toJSON:function(){return this.toObject()}}),u.Image.filters.BaseFilter.fromObject=function(f,e){var h=new u.Image.filters[f.type](f);return e&&e(h),h},function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.ColorMatrix=r(h.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(t){this.callSuper("initialize",t),this.matrix=this.matrix.slice(0)},applyTo2d:function(t){var a=t.imageData,n=a.data,c=n.length,s=this.matrix,i,o,l,d,g,v=this.colorsOnly;for(g=0;g<c;g+=4)i=n[g],o=n[g+1],l=n[g+2],v?(n[g]=i*s[0]+o*s[1]+l*s[2]+s[4]*255,n[g+1]=i*s[5]+o*s[6]+l*s[7]+s[9]*255,n[g+2]=i*s[10]+o*s[11]+l*s[12]+s[14]*255):(d=n[g+3],n[g]=i*s[0]+o*s[1]+l*s[2]+d*s[3]+s[4]*255,n[g+1]=i*s[5]+o*s[6]+l*s[7]+d*s[8]+s[9]*255,n[g+2]=i*s[10]+o*s[11]+l*s[12]+d*s[13]+s[14]*255,n[g+3]=i*s[15]+o*s[16]+l*s[17]+d*s[18]+s[19]*255)},getUniformLocations:function(t,a){return{uColorMatrix:t.getUniformLocation(a,"uColorMatrix"),uConstants:t.getUniformLocation(a,"uConstants")}},sendUniformData:function(t,a){var n=this.matrix,c=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],s=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(a.uColorMatrix,!1,c),t.uniform4fv(a.uConstants,s)}}),e.Image.filters.ColorMatrix.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Brightness=r(h.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(t){if(this.brightness!==0){var a=t.imageData,n=a.data,c,s=n.length,i=Math.round(this.brightness*255);for(c=0;c<s;c+=4)n[c]=n[c]+i,n[c+1]=n[c+1]+i,n[c+2]=n[c+2]+i}},getUniformLocations:function(t,a){return{uBrightness:t.getUniformLocation(a,"uBrightness")}},sendUniformData:function(t,a){t.uniform1f(a.uBrightness,this.brightness)}}),e.Image.filters.Brightness.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.Convolute=t(r.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var n=Math.sqrt(this.matrix.length),c=this.type+"_"+n+"_"+(this.opaque?1:0),s=this.fragmentSource[c];return a.programCache.hasOwnProperty(c)||(a.programCache[c]=this.createProgram(a.context,s)),a.programCache[c]},applyTo2d:function(a){var n=a.imageData,c=n.data,s=this.matrix,i=Math.round(Math.sqrt(s.length)),o=Math.floor(i/2),l=n.width,d=n.height,g=a.ctx.createImageData(l,d),v=g.data,_=this.opaque?1:0,p,C,S,O,k,P,F,E,X,z,V,J,T;for(V=0;V<d;V++)for(z=0;z<l;z++){for(k=(V*l+z)*4,p=0,C=0,S=0,O=0,T=0;T<i;T++)for(J=0;J<i;J++)F=V+T-o,P=z+J-o,!(F<0||F>=d||P<0||P>=l)&&(E=(F*l+P)*4,X=s[T*i+J],p+=c[E]*X,C+=c[E+1]*X,S+=c[E+2]*X,_||(O+=c[E+3]*X));v[k]=p,v[k+1]=C,v[k+2]=S,_?v[k+3]=c[k+3]:v[k+3]=O}a.imageData=g},getUniformLocations:function(a,n){return{uMatrix:a.getUniformLocation(n,"uMatrix"),uOpaque:a.getUniformLocation(n,"uOpaque"),uHalfSize:a.getUniformLocation(n,"uHalfSize"),uSize:a.getUniformLocation(n,"uSize")}},sendUniformData:function(a,n){a.uniform1fv(n.uMatrix,this.matrix)},toObject:function(){return h(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Grayscale=r(h.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(t){var a=t.imageData,n=a.data,c,s=n.length,i,o=this.mode;for(c=0;c<s;c+=4)o==="average"?i=(n[c]+n[c+1]+n[c+2])/3:o==="lightness"?i=(Math.min(n[c],n[c+1],n[c+2])+Math.max(n[c],n[c+1],n[c+2]))/2:o==="luminosity"&&(i=.21*n[c]+.72*n[c+1]+.07*n[c+2]),n[c]=i,n[c+1]=i,n[c+2]=i},retrieveShader:function(t){var a=this.type+"_"+this.mode;if(!t.programCache.hasOwnProperty(a)){var n=this.fragmentSource[this.mode];t.programCache[a]=this.createProgram(t.context,n)}return t.programCache[a]},getUniformLocations:function(t,a){return{uMode:t.getUniformLocation(a,"uMode")}},sendUniformData:function(t,a){var n=1;t.uniform1i(a.uMode,n)},isNeutralState:function(){return!1}}),e.Image.filters.Grayscale.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Invert=r(h.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(t){var a=t.imageData,n=a.data,c,s=n.length;for(c=0;c<s;c+=4)n[c]=255-n[c],n[c+1]=255-n[c+1],n[c+2]=255-n[c+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(t,a){return{uInvert:t.getUniformLocation(a,"uInvert")}},sendUniformData:function(t,a){t.uniform1i(a.uInvert,this.invert)}}),e.Image.filters.Invert.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.Noise=t(r.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise!==0){var n=a.imageData,c=n.data,s,i=c.length,o=this.noise,l;for(s=0,i=c.length;s<i;s+=4)l=(.5-Math.random())*o,c[s]+=l,c[s+1]+=l,c[s+2]+=l}},getUniformLocations:function(a,n){return{uNoise:a.getUniformLocation(n,"uNoise"),uSeed:a.getUniformLocation(n,"uSeed")}},sendUniformData:function(a,n){a.uniform1f(n.uNoise,this.noise/255),a.uniform1f(n.uSeed,Math.random())},toObject:function(){return h(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Pixelate=r(h.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(t){var a=t.imageData,n=a.data,c=a.height,s=a.width,i,o,l,d,g,v,_,p,C,S,O;for(o=0;o<c;o+=this.blocksize)for(l=0;l<s;l+=this.blocksize)for(i=o*4*s+l*4,d=n[i],g=n[i+1],v=n[i+2],_=n[i+3],S=Math.min(o+this.blocksize,c),O=Math.min(l+this.blocksize,s),p=o;p<S;p++)for(C=l;C<O;C++)i=p*4*s+C*4,n[i]=d,n[i+1]=g,n[i+2]=v,n[i+3]=_},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(t,a){return{uBlocksize:t.getUniformLocation(a,"uBlocksize"),uStepW:t.getUniformLocation(a,"uStepW"),uStepH:t.getUniformLocation(a,"uStepH")}},sendUniformData:function(t,a){t.uniform1f(a.uBlocksize,this.blocksize)}}),e.Image.filters.Pixelate.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.extend,r=e.Image.filters,t=e.util.createClass;r.RemoveColor=t(r.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var n=a.imageData,c=n.data,s,i=this.distance*255,o,l,d,g=new e.Color(this.color).getSource(),v=[g[0]-i,g[1]-i,g[2]-i],_=[g[0]+i,g[1]+i,g[2]+i];for(s=0;s<c.length;s+=4)o=c[s],l=c[s+1],d=c[s+2],o>v[0]&&l>v[1]&&d>v[2]&&o<_[0]&&l<_[1]&&d<_[2]&&(c[s+3]=0)},getUniformLocations:function(a,n){return{uLow:a.getUniformLocation(n,"uLow"),uHigh:a.getUniformLocation(n,"uHigh")}},sendUniformData:function(a,n){var c=new e.Color(this.color).getSource(),s=parseFloat(this.distance),i=[0+c[0]/255-s,0+c[1]/255-s,0+c[2]/255-s,1],o=[c[0]/255+s,c[1]/255+s,c[2]/255+s,1];a.uniform4fv(n.uLow,i),a.uniform4fv(n.uHigh,o)},toObject:function(){return h(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),e.Image.filters.RemoveColor.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass,t={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in t)h[a]=r(h.ColorMatrix,{type:a,matrix:t[a],mainParameter:!1,colorsOnly:!0}),e.Image.filters[a].fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric,h=e.Image.filters,r=e.util.createClass;h.BlendColor=r(h.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(t){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[t]+`}
}`},retrieveShader:function(t){var a=this.type+"_"+this.mode,n;return t.programCache.hasOwnProperty(a)||(n=this.buildSource(this.mode),t.programCache[a]=this.createProgram(t.context,n)),t.programCache[a]},applyTo2d:function(t){var a=t.imageData,n=a.data,c=n.length,s,i,o,l,d,g,v,_=1-this.alpha;v=new e.Color(this.color).getSource(),s=v[0]*this.alpha,i=v[1]*this.alpha,o=v[2]*this.alpha;for(var p=0;p<c;p+=4)switch(l=n[p],d=n[p+1],g=n[p+2],this.mode){case"multiply":n[p]=l*s/255,n[p+1]=d*i/255,n[p+2]=g*o/255;break;case"screen":n[p]=255-(255-l)*(255-s)/255,n[p+1]=255-(255-d)*(255-i)/255,n[p+2]=255-(255-g)*(255-o)/255;break;case"add":n[p]=l+s,n[p+1]=d+i,n[p+2]=g+o;break;case"diff":case"difference":n[p]=Math.abs(l-s),n[p+1]=Math.abs(d-i),n[p+2]=Math.abs(g-o);break;case"subtract":n[p]=l-s,n[p+1]=d-i,n[p+2]=g-o;break;case"darken":n[p]=Math.min(l,s),n[p+1]=Math.min(d,i),n[p+2]=Math.min(g,o);break;case"lighten":n[p]=Math.max(l,s),n[p+1]=Math.max(d,i),n[p+2]=Math.max(g,o);break;case"overlay":n[p]=s<128?2*l*s/255:255-2*(255-l)*(255-s)/255,n[p+1]=i<128?2*d*i/255:255-2*(255-d)*(255-i)/255,n[p+2]=o<128?2*g*o/255:255-2*(255-g)*(255-o)/255;break;case"exclusion":n[p]=s+l-2*s*l/255,n[p+1]=i+d-2*i*d/255,n[p+2]=o+g-2*o*g/255;break;case"tint":n[p]=s+l*_,n[p+1]=i+d*_,n[p+2]=o+g*_}},getUniformLocations:function(t,a){return{uColor:t.getUniformLocation(a,"uColor")}},sendUniformData:function(t,a){var n=new e.Color(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(a.uColor,n)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendColor.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric,h=e.Image.filters,r=e.util.createClass;h.BlendImage=r(h.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(t){var a=this.type+"_"+this.mode,n=this.fragmentSource[this.mode];return t.programCache.hasOwnProperty(a)||(t.programCache[a]=this.createProgram(t.context,n)),t.programCache[a]},applyToWebGL:function(t){var a=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(a,n,a.TEXTURE1),this.callSuper("applyToWebGL",t),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(t,a){return t.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var t=this.image,a=t._element.width,n=t._element.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/a,-t.top/n,1]},applyTo2d:function(t){var a=t.imageData,n=t.filterBackend.resources,c=a.data,s=c.length,i=a.width,o=a.height,l,d,g,v,_,p,C,S,O,k,P=this.image,F;n.blendImage||(n.blendImage=e.util.createCanvasElement()),O=n.blendImage,k=O.getContext("2d"),O.width!==i||O.height!==o?(O.width=i,O.height=o):k.clearRect(0,0,i,o),k.setTransform(P.scaleX,0,0,P.scaleY,P.left,P.top),k.drawImage(P._element,0,0,i,o),F=k.getImageData(0,0,i,o).data;for(var E=0;E<s;E+=4)switch(_=c[E],p=c[E+1],C=c[E+2],S=c[E+3],l=F[E],d=F[E+1],g=F[E+2],v=F[E+3],this.mode){case"multiply":c[E]=_*l/255,c[E+1]=p*d/255,c[E+2]=C*g/255,c[E+3]=S*v/255;break;case"mask":c[E+3]=v;break}},getUniformLocations:function(t,a){return{uTransformMatrix:t.getUniformLocation(a,"uTransformMatrix"),uImage:t.getUniformLocation(a,"uImage")}},sendUniformData:function(t,a){var n=this.calculateMatrix();t.uniform1i(a.uImage,1),t.uniformMatrix3fv(a.uTransformMatrix,!1,n)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),e.Image.filters.BlendImage.fromObject=function(t,a){e.Image.fromObject(t.image,function(n){var c=e.util.object.clone(t);c.image=n,a(new e.Image.filters.BlendImage(c))})}}(m),function(f){var e=f.fabric||(f.fabric={}),h=Math.pow,r=Math.floor,t=Math.sqrt,a=Math.abs,n=Math.round,c=Math.sin,s=Math.ceil,i=e.Image.filters,o=e.util.createClass;i.Resize=o(i.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(l,d){return{uDelta:l.getUniformLocation(d,"uDelta"),uTaps:l.getUniformLocation(d,"uTaps")}},sendUniformData:function(l,d){l.uniform2fv(d.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),l.uniform1fv(d.uTaps,this.taps)},retrieveShader:function(l){var d=this.getFilterWindow(),g=this.type+"_"+d;if(!l.programCache.hasOwnProperty(g)){var v=this.generateShader(d);l.programCache[g]=this.createProgram(l.context,v)}return l.programCache[g]},getFilterWindow:function(){var l=this.tempScale;return Math.ceil(this.lanczosLobes/l)},getTaps:function(){for(var l=this.lanczosCreate(this.lanczosLobes),d=this.tempScale,g=this.getFilterWindow(),v=new Array(g),_=1;_<=g;_++)v[_-1]=l(_*d);return v},generateShader:function(v){for(var d=new Array(v),g=this.fragmentSourceTOP,v,_=1;_<=v;_++)d[_-1]=_+".0 * uDelta";return g+="uniform float uTaps["+v+`];
`,g+=`void main() {
`,g+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,g+=`  float sum = 1.0;
`,d.forEach(function(p,C){g+="  color += texture2D(uTexture, vTexCoord + "+p+") * uTaps["+C+`];
`,g+="  color += texture2D(uTexture, vTexCoord - "+p+") * uTaps["+C+`];
`,g+="  sum += 2.0 * uTaps["+C+`];
`}),g+=`  gl_FragColor = color / sum;
`,g+="}",g},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(l){l.webgl?(l.passes++,this.width=l.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=l.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),l.destinationWidth=this.dW,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceWidth=l.destinationWidth,this.height=l.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),l.destinationHeight=this.dH,this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l),l.sourceHeight=l.destinationHeight):this.applyTo2d(l)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(l){return function(d){if(d>=l||d<=-l)return 0;if(d<11920929e-14&&d>-11920929e-14)return 1;d*=Math.PI;var g=d/l;return c(d)/d*c(g)/g}},applyTo2d:function(l){var d=l.imageData,g=this.scaleX,v=this.scaleY;this.rcpScaleX=1/g,this.rcpScaleY=1/v;var _=d.width,p=d.height,C=n(_*g),S=n(p*v),O;this.resizeType==="sliceHack"?O=this.sliceByTwo(l,_,p,C,S):this.resizeType==="hermite"?O=this.hermiteFastResize(l,_,p,C,S):this.resizeType==="bilinear"?O=this.bilinearFiltering(l,_,p,C,S):this.resizeType==="lanczos"&&(O=this.lanczosResize(l,_,p,C,S)),l.imageData=O},sliceByTwo:function(l,d,g,v,_){var p=l.imageData,C=.5,S=!1,O=!1,k=d*C,P=g*C,F=e.filterBackend.resources,E,X,z=0,V=0,J=d,T=0;for(F.sliceByTwo||(F.sliceByTwo=document.createElement("canvas")),E=F.sliceByTwo,(E.width<d*1.5||E.height<g)&&(E.width=d*1.5,E.height=g),X=E.getContext("2d"),X.clearRect(0,0,d*1.5,g),X.putImageData(p,0,0),v=r(v),_=r(_);!S||!O;)d=k,g=P,v<r(k*C)?k=r(k*C):(k=v,S=!0),_<r(P*C)?P=r(P*C):(P=_,O=!0),X.drawImage(E,z,V,d,g,J,T,k,P),z=J,V=T,T+=P;return X.getImageData(z,V,v,_)},lanczosResize:function(l,d,g,v,_){function p(R){var I,K,M,A,L,B,W,Y,U,G,Z;for(T.x=(R+.5)*P,j.x=r(T.x),I=0;I<_;I++){for(T.y=(I+.5)*F,j.y=r(T.y),L=0,B=0,W=0,Y=0,U=0,K=j.x-z;K<=j.x+z;K++)if(!(K<0||K>=d)){G=r(1e3*a(K-T.x)),J[G]||(J[G]={});for(var tt=j.y-V;tt<=j.y+V;tt++)tt<0||tt>=g||(Z=r(1e3*a(tt-T.y)),J[G][Z]||(J[G][Z]=k(t(h(G*E,2)+h(Z*X,2))/1e3)),M=J[G][Z],M>0&&(A=(tt*d+K)*4,L+=M,B+=M*C[A],W+=M*C[A+1],Y+=M*C[A+2],U+=M*C[A+3]))}A=(I*v+R)*4,O[A]=B/L,O[A+1]=W/L,O[A+2]=Y/L,O[A+3]=U/L}return++R<v?p(R):S}var C=l.imageData.data,S=l.ctx.createImageData(v,_),O=S.data,k=this.lanczosCreate(this.lanczosLobes),P=this.rcpScaleX,F=this.rcpScaleY,E=2/this.rcpScaleX,X=2/this.rcpScaleY,z=s(P*this.lanczosLobes/2),V=s(F*this.lanczosLobes/2),J={},T={},j={};return p(0)},bilinearFiltering:function(l,d,g,v,_){var p,C,S,O,k,P,F,E,X,z,V,J,T=0,j,R=this.rcpScaleX,I=this.rcpScaleY,K=4*(d-1),M=l.imageData,A=M.data,L=l.ctx.createImageData(v,_),B=L.data;for(F=0;F<_;F++)for(E=0;E<v;E++)for(k=r(R*E),P=r(I*F),X=R*E-k,z=I*F-P,j=4*(P*d+k),V=0;V<4;V++)p=A[j+V],C=A[j+4+V],S=A[j+K+V],O=A[j+K+4+V],J=p*(1-X)*(1-z)+C*X*(1-z)+S*z*(1-X)+O*X*z,B[T++]=J;return L},hermiteFastResize:function(l,d,g,v,_){for(var p=this.rcpScaleX,C=this.rcpScaleY,S=s(p/2),O=s(C/2),k=l.imageData,P=k.data,F=l.ctx.createImageData(v,_),E=F.data,X=0;X<_;X++)for(var z=0;z<v;z++){for(var V=(z+X*v)*4,J=0,T=0,j=0,R=0,I=0,K=0,M=0,A=(X+.5)*C,L=r(X*C);L<(X+1)*C;L++)for(var B=a(A-(L+.5))/O,W=(z+.5)*p,Y=B*B,U=r(z*p);U<(z+1)*p;U++){var G=a(W-(U+.5))/S,Z=t(Y+G*G);Z>1&&Z<-1||(J=2*Z*Z*Z-3*Z*Z+1,J>0&&(G=4*(U+L*d),M+=J*P[G+3],j+=J,P[G+3]<255&&(J=J*P[G+3]/250),R+=J*P[G],I+=J*P[G+1],K+=J*P[G+2],T+=J))}E[V]=R/T,E[V+1]=I/T,E[V+2]=K/T,E[V+3]=M/j}return F},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),e.Image.filters.Resize.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Contrast=r(h.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(t){if(this.contrast!==0){var a=t.imageData,n,s,c=a.data,s=c.length,i=Math.floor(this.contrast*255),o=259*(i+255)/(255*(259-i));for(n=0;n<s;n+=4)c[n]=o*(c[n]-128)+128,c[n+1]=o*(c[n+1]-128)+128,c[n+2]=o*(c[n+2]-128)+128}},getUniformLocations:function(t,a){return{uContrast:t.getUniformLocation(a,"uContrast")}},sendUniformData:function(t,a){t.uniform1f(a.uContrast,this.contrast)}}),e.Image.filters.Contrast.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Saturation=r(h.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(t){if(this.saturation!==0){var a=t.imageData,n=a.data,c=n.length,s=-this.saturation,i,o;for(i=0;i<c;i+=4)o=Math.max(n[i],n[i+1],n[i+2]),n[i]+=o!==n[i]?(o-n[i])*s:0,n[i+1]+=o!==n[i+1]?(o-n[i+1])*s:0,n[i+2]+=o!==n[i+2]?(o-n[i+2])*s:0}},getUniformLocations:function(t,a){return{uSaturation:t.getUniformLocation(a,"uSaturation")}},sendUniformData:function(t,a){t.uniform1f(a.uSaturation,-this.saturation)}}),e.Image.filters.Saturation.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Blur=r(h.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(t){t.webgl?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)},applyTo2d:function(t){t.imageData=this.simpleBlur(t)},simpleBlur:function(t){var a=t.filterBackend.resources,n,c,s=t.imageData.width,i=t.imageData.height;a.blurLayer1||(a.blurLayer1=e.util.createCanvasElement(),a.blurLayer2=e.util.createCanvasElement()),n=a.blurLayer1,c=a.blurLayer2,(n.width!==s||n.height!==i)&&(c.width=n.width=s,c.height=n.height=i);var o=n.getContext("2d"),l=c.getContext("2d"),d=15,g,v,_,p,C=this.blur*.06*.5;for(o.putImageData(t.imageData,0,0),l.clearRect(0,0,s,i),p=-d;p<=d;p++)g=(Math.random()-.5)/4,v=p/d,_=C*v*s+g,l.globalAlpha=1-Math.abs(v),l.drawImage(n,_,g),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);for(p=-d;p<=d;p++)g=(Math.random()-.5)/4,v=p/d,_=C*v*i+g,l.globalAlpha=1-Math.abs(v),l.drawImage(n,g,_),o.drawImage(c,0,0),l.globalAlpha=1,l.clearRect(0,0,c.width,c.height);t.ctx.drawImage(n,0,0);var S=t.ctx.getImageData(0,0,n.width,n.height);return o.globalAlpha=1,o.clearRect(0,0,n.width,n.height),S},getUniformLocations:function(t,a){return{delta:t.getUniformLocation(a,"uDelta")}},sendUniformData:function(t,a){var n=this.chooseRightDelta();t.uniform2fv(a.delta,n)},chooseRightDelta:function(){var t=1,a=[0,0],n;return this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio),n=t*this.blur*.12,this.horizontal?a[0]=n:a[1]=n,a}}),h.Blur.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Gamma=r(h.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(t){this.gamma=[1,1,1],h.BaseFilter.prototype.initialize.call(this,t)},applyTo2d:function(t){var a=t.imageData,n=a.data,c=this.gamma,s=n.length,i=1/c[0],o=1/c[1],l=1/c[2],d;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),d=0,s=256;d<s;d++)this.rVals[d]=Math.pow(d/255,i)*255,this.gVals[d]=Math.pow(d/255,o)*255,this.bVals[d]=Math.pow(d/255,l)*255;for(d=0,s=n.length;d<s;d+=4)n[d]=this.rVals[n[d]],n[d+1]=this.gVals[n[d+1]],n[d+2]=this.bVals[n[d+2]]},getUniformLocations:function(t,a){return{uGamma:t.getUniformLocation(a,"uGamma")}},sendUniformData:function(t,a){t.uniform3fv(a.uGamma,this.gamma)}}),e.Image.filters.Gamma.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.Composed=r(h.BaseFilter,{type:"Composed",subFilters:[],initialize:function(t){this.callSuper("initialize",t),this.subFilters=this.subFilters.slice(0)},applyTo:function(t){t.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(t)})},toObject:function(){return e.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(t){return t.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(t){return!t.isNeutralState()})}}),e.Image.filters.Composed.fromObject=function(t,a){var n=t.subFilters||[],c=n.map(function(i){return new e.Image.filters[i.type](i)}),s=new e.Image.filters.Composed({subFilters:c});return a&&a(s),s}}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.Image.filters,r=e.util.createClass;h.HueRotation=r(h.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var t=this.rotation*Math.PI,a=e.util.cos(t),n=e.util.sin(t),c=1/3,s=Math.sqrt(c)*n,i=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+i/3,this.matrix[1]=c*i-s,this.matrix[2]=c*i+s,this.matrix[5]=c*i+s,this.matrix[6]=a+c*i,this.matrix[7]=c*i-s,this.matrix[10]=c*i-s,this.matrix[11]=c*i+s,this.matrix[12]=a+c*i},isNeutralState:function(t){return this.calculateMatrix(),h.BaseFilter.prototype.isNeutralState.call(this,t)},applyTo:function(t){this.calculateMatrix(),h.BaseFilter.prototype.applyTo.call(this,t)}}),e.Image.filters.HueRotation.fromObject=e.Image.filters.BaseFilter.fromObject}(m),function(f){var e=f.fabric||(f.fabric={}),h=e.util.object.clone;if(e.Text){e.warn("fabric.Text is already defined");return}e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:e.Object.prototype.stateProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),cacheProperties:e.Object.prototype.cacheProperties.concat("fontFamily","fontWeight","fontSize","text","underline","overline","linethrough","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),stroke:null,shadow:null,_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,t){this.styles=t?t.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",t),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},getMeasuringContext:function(){return e._measuringContext||(e._measuringContext=this.canvas&&this.canvas.contextCache||e.util.createCanvasElement().getContext("2d")),e._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,t,a,n,c,s,i,o=0,l=this._textLines.length;o<l;o++)if(!(this.textAlign!=="justify"&&(o===l-1||this.isEndOfWrapping(o)))&&(n=0,c=this._textLines[o],t=this.getLineWidth(o),t<this.width&&(i=this.textLines[o].match(this._reSpacesAndTabs)))){a=i.length,r=(this.width-t)/a;for(var d=0,g=c.length;d<=g;d++)s=this.__charBounds[o][d],this._reSpaceAndTab.test(c[d])?(s.width+=r,s.kernedWidth+=r,s.left+=n,n+=r):s.left+=n}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),t=this.fontSize;return r.width+=t*r.zoomX,r.height+=t*r.zoomY,r},_render:function(r){this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,t,a){r.textBaseline="alphabetic",r.font=this._getFontDeclaration(t,a)},calcTextWidth:function(){for(var r=this.getLineWidth(0),t=1,a=this._textLines.length;t<a;t++){var n=this.getLineWidth(t);n>r&&(r=n)}return r},_renderTextLine:function(r,t,a,n,c,s){this._renderChars(r,t,a,n,c,s)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var t=0,a,n,c=r.fillStyle,s,i,o=this._getLeftOffset(),l=this._getTopOffset(),d=0,g=0,v,_,p=0,C=this._textLines.length;p<C;p++){if(a=this.getHeightOfLine(p),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",p)){t+=a;continue}s=this._textLines[p],n=this._getLineLeftOffset(p),g=0,d=0,i=this.getValueOfPropertyAt(p,0,"textBackgroundColor");for(var S=0,O=s.length;S<O;S++)v=this.__charBounds[p][S],_=this.getValueOfPropertyAt(p,S,"textBackgroundColor"),_!==i?(r.fillStyle=i,i&&r.fillRect(o+n+d,l+t,g,a/this.lineHeight),d=v.left,g=v.width,i=_):g+=v.kernedWidth;_&&(r.fillStyle=_,r.fillRect(o+n+d,l+t,g,a/this.lineHeight)),t+=a}r.fillStyle=c,this._removeShadow(r)}},getFontCache:function(r){var t=r.fontFamily.toLowerCase();e.charWidthsCache[t]||(e.charWidthsCache[t]={});var a=e.charWidthsCache[t],n=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return a[n]||(a[n]={}),a[n]},_applyCharStyles:function(r,t,a,n,c){this._setFillStyles(t,c),this._setStrokeStyles(t,c),t.font=this._getFontDeclaration(c)},_measureChar:function(r,t,a,n){var c=this.getFontCache(t),s=this._getFontDeclaration(t),i=this._getFontDeclaration(n),o=a+r,l=s===i,d,g,v,_=t.fontSize/this.CACHE_FONT_SIZE,p;if(a&&c[a]!==void 0&&(v=c[a]),c[r]!==void 0&&(p=d=c[r]),l&&c[o]!==void 0&&(g=c[o],p=g-v),d===void 0||v===void 0||g===void 0){var C=this.getMeasuringContext();this._setTextStyles(C,t,!0)}return d===void 0&&(p=d=C.measureText(r).width,c[r]=d),v===void 0&&l&&a&&(v=C.measureText(a).width,c[a]=v),l&&g===void 0&&(g=C.measureText(o).width,c[o]=g,p=g-v),{width:d*_,kernedWidth:p*_}},getHeightOfChar:function(r,t){return this.getValueOfPropertyAt(r,t,"fontSize")},measureLine:function(r){var t=this._measureLine(r);return this.charSpacing!==0&&(t.width-=this._getWidthOfCharSpacing()),t.width<0&&(t.width=0),t},_measureLine:function(r){var t=0,a,n,c=this._textLines[r],s,i,o=0,l=new Array(c.length);for(this.__charBounds[r]=l,a=0;a<c.length;a++)n=c[a],i=this._getGraphemeBox(n,r,a,s),l[a]=i,t+=i.kernedWidth,s=n;return l[a]={left:i?i.left+i.width:0,width:0,kernedWidth:0,height:this.fontSize},{width:t,numOfSpaces:o}},_getGraphemeBox:function(r,t,a,n,c){var s=this.getCompleteStyleDeclaration(t,a),i=n?this.getCompleteStyleDeclaration(t,a-1):{},o=this._measureChar(r,s,n,i),l=o.kernedWidth,d=o.width,g;this.charSpacing!==0&&(g=this._getWidthOfCharSpacing(),d+=g,l+=g);var v={width:d,left:0,height:s.fontSize,kernedWidth:l,deltaY:s.deltaY};if(a>0&&!c){var _=this.__charBounds[t][a-1];v.left=_.left+_.width+o.kernedWidth-o.width}return v},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var t=this._textLines[r],a=this.getHeightOfChar(r,0),n=1,c=t.length;n<c;n++)a=Math.max(this.getHeightOfChar(r,n),a);return this.__lineHeights[r]=a*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,t=0,a=0,n=this._textLines.length;a<n;a++)r=this.getHeightOfLine(a),t+=a===n-1?r/this.lineHeight:r;return t},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_applyPatternGradientTransform:function(r,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var a=-this.width/2+t.offsetX||0,n=-this.height/2+t.offsetY||0;return r.transform(1,0,0,1,a,n),{offsetX:a,offsetY:n}},_renderTextCommon:function(r,t){r.save();for(var a=0,n=this._getLeftOffset(),c=this._getTopOffset(),s=this._applyPatternGradientTransform(r,t==="fillText"?this.fill:this.stroke),i=0,o=this._textLines.length;i<o;i++){var l=this.getHeightOfLine(i),d=l/this.lineHeight,g=this._getLineLeftOffset(i);this._renderTextLine(t,r,this._textLines[i],n+g-s.offsetX,c+a+d-s.offsetY,i),a+=l}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,t,a,n,c,s){var i=this.getHeightOfLine(s),o=this.textAlign.indexOf("justify")!==-1,l,d,g="",v,_=0,p,C=!o&&this.charSpacing===0&&this.isEmptyStyles(s);if(t.save(),c-=i*this._fontSizeFraction/this.lineHeight,C){this._renderChar(r,t,s,0,this.textLines[s],n,c,i),t.restore();return}for(var S=0,O=a.length-1;S<=O;S++)p=S===O||this.charSpacing,g+=a[S],v=this.__charBounds[s][S],_===0?(n+=v.kernedWidth-v.width,_+=v.width):_+=v.kernedWidth,o&&!p&&this._reSpaceAndTab.test(a[S])&&(p=!0),p||(l=l||this.getCompleteStyleDeclaration(s,S),d=this.getCompleteStyleDeclaration(s,S+1),p=this._hasStyleChanged(l,d)),p&&(this._renderChar(r,t,s,S,g,n,c,i),g="",l=d,n+=_,_=0);t.restore()},_renderChar:function(r,t,a,n,c,s,i){var o=this._getStyleDeclaration(a,n),l=this.getCompleteStyleDeclaration(a,n),d=r==="fillText"&&l.fill,g=r==="strokeText"&&l.stroke&&l.strokeWidth;!g&&!d||(o&&t.save(),this._applyCharStyles(r,t,a,n,l),o&&o.textBackgroundColor&&this._removeShadow(t),o&&o.deltaY&&(i+=o.deltaY),d&&t.fillText(c,s,i),g&&t.strokeText(c,s,i),o&&t.restore())},setSuperscript:function(r,t){return this._setScript(r,t,this.superscript)},setSubscript:function(r,t){return this._setScript(r,t,this.subscript)},_setScript:function(r,t,a){var n=this.get2DCursorLocation(r,!0),c=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),s=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),i={fontSize:c*a.size,deltaY:s+c*a.baseline};return this.setSelectionStyles(i,r,t),this},_hasStyleChanged:function(r,t){return r.fill!==t.fill||r.stroke!==t.stroke||r.strokeWidth!==t.strokeWidth||r.fontSize!==t.fontSize||r.fontFamily!==t.fontFamily||r.fontWeight!==t.fontWeight||r.fontStyle!==t.fontStyle||r.deltaY!==t.deltaY},_hasStyleChangedForSvg:function(r,t){return this._hasStyleChanged(r,t)||r.overline!==t.overline||r.underline!==t.underline||r.linethrough!==t.linethrough},_getLineLeftOffset:function(r){var t=this.getLineWidth(r);return this.textAlign==="center"?(this.width-t)/2:this.textAlign==="right"?this.width-t:this.textAlign==="justify-center"&&this.isEndOfWrapping(r)?(this.width-t)/2:this.textAlign==="justify-right"&&this.isEndOfWrapping(r)?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r])return this.__lineWidths[r];var t,a=this._textLines[r],n;return a===""?t=0:(n=this.measureLine(r),t=n.width),this.__lineWidths[r]=t,t},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,t,a){var n=this._getStyleDeclaration(r,t);return n&&typeof n[a]<"u"?n[a]:this[a]},_renderTextDecoration:function(r,t){if(!(!this[t]&&!this.styleHas(t))){for(var a,n,c,s,i,o,l,d,g=this._getLeftOffset(),v=this._getTopOffset(),_,p,C,S,O,k,P,F,E=this._getWidthOfCharSpacing(),X=0,z=this._textLines.length;X<z;X++){if(a=this.getHeightOfLine(X),!this[t]&&!this.styleHas(t,X)){v+=a;continue}l=this._textLines[X],k=a/this.lineHeight,s=this._getLineLeftOffset(X),p=0,C=0,d=this.getValueOfPropertyAt(X,0,t),F=this.getValueOfPropertyAt(X,0,"fill"),_=v+k*(1-this._fontSizeFraction),n=this.getHeightOfChar(X,0),i=this.getValueOfPropertyAt(X,0,"deltaY");for(var V=0,J=l.length;V<J;V++)S=this.__charBounds[X][V],O=this.getValueOfPropertyAt(X,V,t),P=this.getValueOfPropertyAt(X,V,"fill"),c=this.getHeightOfChar(X,V),o=this.getValueOfPropertyAt(X,V,"deltaY"),(O!==d||P!==F||c!==n||o!==i)&&C>0?(r.fillStyle=F,d&&F&&r.fillRect(g+s+p,_+this.offsets[t]*n+i,C,this.fontSize/15),p=S.left,C=S.width,d=O,F=P,n=c,i=o):C+=S.kernedWidth;r.fillStyle=P,O&&P&&r.fillRect(g+s+p,_+this.offsets[t]*n+i,C-E,this.fontSize/15),v+=a}this._removeShadow(r)}},_getFontDeclaration:function(r,t){var a=r||this,n=this.fontFamily,c=e.Text.genericFonts.indexOf(n.toLowerCase())>-1,s=n===void 0||n.indexOf("'")>-1||n.indexOf(",")>-1||n.indexOf('"')>-1||c?a.fontFamily:'"'+a.fontFamily+'"';return[e.isLikelyNode?a.fontWeight:a.fontStyle,e.isLikelyNode?a.fontStyle:a.fontWeight,t?this.CACHE_FONT_SIZE+"px":a.fontSize+"px",s].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var t=r.split(this._reNewline),a=new Array(t.length),n=[`
`],c=[],s=0;s<t.length;s++)a[s]=e.util.string.graphemeSplit(t[s]),c=c.concat(a[s],n);return c.pop(),{_unwrappedLines:a,lines:t,graphemeText:c,graphemeLines:a}},toObject:function(r){var t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","underline","overline","linethrough","textAlign","textBackgroundColor","charSpacing"].concat(r),a=this.callSuper("toObject",t);return a.styles=h(this.styles,!0),a},set:function(r,t){this.callSuper("set",r,t);var a=!1;if(typeof r=="object")for(var n in r)a=a||this._dimensionAffectingProps.indexOf(n)!==-1;else a=this._dimensionAffectingProps.indexOf(r)!==-1;return a&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(r,t,a){if(!r)return t(null);var n=e.parseAttributes(r,e.Text.ATTRIBUTE_NAMES),c=n.textAnchor||"left";if(a=e.util.object.extend(a?h(a):{},n),a.top=a.top||0,a.left=a.left||0,n.textDecoration){var s=n.textDecoration;s.indexOf("underline")!==-1&&(a.underline=!0),s.indexOf("overline")!==-1&&(a.overline=!0),s.indexOf("line-through")!==-1&&(a.linethrough=!0),delete a.textDecoration}"dx"in n&&(a.left+=n.dx),"dy"in n&&(a.top+=n.dy),"fontSize"in a||(a.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);var i="";"textContent"in r?i=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(i=r.firstChild.data),i=i.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var o=a.strokeWidth;a.strokeWidth=0;var l=new e.Text(i,a),d=l.getScaledHeight()/l.height,g=(l.height+l.strokeWidth)*l.lineHeight-l.height,v=g*d,_=l.getScaledHeight()+v,p=0;c==="center"&&(p=l.getScaledWidth()/2),c==="right"&&(p=l.getScaledWidth()),l.set({left:l.left-p,top:l.top-(_-l.fontSize*(.07+l._fontSizeFraction))/l.lineHeight,strokeWidth:typeof o<"u"?o:1}),t(l)},e.Text.fromObject=function(r,t){return e.Object._fromObject("Text",r,t,"text")},e.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],e.util.createAccessors&&e.util.createAccessors(e.Text)}(m),function(){u.util.object.extend(u.Text.prototype,{isEmptyStyles:function(f){if(!this.styles||typeof f<"u"&&!this.styles[f])return!0;var e=typeof f>"u"?this.styles:{line:this.styles[f]};for(var h in e)for(var r in e[h])for(var t in e[h][r])return!1;return!0},styleHas:function(f,e){if(!this.styles||!f||f===""||typeof e<"u"&&!this.styles[e])return!1;var h=typeof e>"u"?this.styles:{0:this.styles[e]};for(var r in h)for(var t in h[r])if(typeof h[r][t][f]<"u")return!0;return!1},cleanStyle:function(f){if(!this.styles||!f||f==="")return!1;var e=this.styles,h=0,r,t,a=!0,n=0,c;for(var s in e){r=0;for(var i in e[s]){var c=e[s][i],o=c.hasOwnProperty(f);h++,o?(t?c[f]!==t&&(a=!1):t=c[f],c[f]===this[f]&&delete c[f]):a=!1,Object.keys(c).length!==0?r++:delete e[s][i]}r===0&&delete e[s]}for(var l=0;l<this._textLines.length;l++)n+=this._textLines[l].length;a&&h===n&&(this[f]=t,this.removeStyle(f))},removeStyle:function(f){if(!(!this.styles||!f||f==="")){var e=this.styles,h,r,t;for(r in e){h=e[r];for(t in h)delete h[t][f],Object.keys(h[t]).length===0&&delete h[t];Object.keys(h).length===0&&delete e[r]}}},_extendStyles:function(f,e){var h=this.get2DCursorLocation(f);this._getLineStyle(h.lineIndex)||this._setLineStyle(h.lineIndex),this._getStyleDeclaration(h.lineIndex,h.charIndex)||this._setStyleDeclaration(h.lineIndex,h.charIndex,{}),u.util.object.extend(this._getStyleDeclaration(h.lineIndex,h.charIndex),e)},get2DCursorLocation:function(f,e){typeof f>"u"&&(f=this.selectionStart);for(var h=e?this._unwrappedTextLines:this._textLines,r=h.length,t=0;t<r;t++){if(f<=h[t].length)return{lineIndex:t,charIndex:f};f-=h[t].length+this.missingNewlineOffset(t)}return{lineIndex:t-1,charIndex:h[t-1].length<f?h[t-1].length:f}},getSelectionStyles:function(f,e,h){typeof f>"u"&&(f=this.selectionStart||0),typeof e>"u"&&(e=this.selectionEnd||f);for(var r=[],t=f;t<e;t++)r.push(this.getStyleAtPosition(t,h));return r},getStyleAtPosition:function(f,e){var h=this.get2DCursorLocation(f),r=e?this.getCompleteStyleDeclaration(h.lineIndex,h.charIndex):this._getStyleDeclaration(h.lineIndex,h.charIndex);return r||{}},setSelectionStyles:function(f,e,h){typeof e>"u"&&(e=this.selectionStart||0),typeof h>"u"&&(h=this.selectionEnd||e);for(var r=e;r<h;r++)this._extendStyles(r,f);return this._forceClearCache=!0,this},_getStyleDeclaration:function(f,e){var h=this.styles&&this.styles[f];return h?h[e]:null},getCompleteStyleDeclaration:function(f,e){for(var h=this._getStyleDeclaration(f,e)||{},r={},t,a=0;a<this._styleProperties.length;a++)t=this._styleProperties[a],r[t]=typeof h[t]>"u"?this[t]:h[t];return r},_setStyleDeclaration:function(f,e,h){this.styles[f][e]=h},_deleteStyleDeclaration:function(f,e){delete this.styles[f][e]},_getLineStyle:function(f){return!!this.styles[f]},_setLineStyle:function(f){this.styles[f]={}},_deleteLineStyle:function(f){delete this.styles[f]}})}(),function(){function f(e){e.textDecoration&&(e.textDecoration.indexOf("underline")>-1&&(e.underline=!0),e.textDecoration.indexOf("line-through")>-1&&(e.linethrough=!0),e.textDecoration.indexOf("overline")>-1&&(e.overline=!0),delete e.textDecoration)}u.IText=u.util.createClass(u.Text,u.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(e,h){this.callSuper("initialize",e,h),this.initBehavior()},setSelectionStart:function(e){e=Math.max(e,0),this._updateAndFire("selectionStart",e)},setSelectionEnd:function(e){e=Math.min(e,this.text.length),this._updateAndFire("selectionEnd",e)},_updateAndFire:function(e,h){this[e]!==h&&(this._fireSelectionChanged(),this[e]=h),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(e){this.clearContextTop(),this.callSuper("render",e),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(e){this.callSuper("_render",e)},clearContextTop:function(e){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var h=this.canvas.contextTop,r=this.canvas.viewportTransform;h.save(),h.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(h),this.transformMatrix&&h.transform.apply(h,this.transformMatrix),this._clearTextArea(h),e||h.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var e=this._getCursorBoundaries(),h=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(e,h):this.renderSelection(e,h),h.restore()}},_clearTextArea:function(e){var h=this.width+4,r=this.height+4;e.clearRect(-h/2,-r/2,h,r)},_getCursorBoundaries:function(e){typeof e>"u"&&(e=this.selectionStart);var h=this._getLeftOffset(),r=this._getTopOffset(),t=this._getCursorBoundariesOffsets(e);return{left:h,top:r,leftOffset:t.left,topOffset:t.top}},_getCursorBoundariesOffsets:function(e){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var h,r,t,a=0,n=0,c,s=this.get2DCursorLocation(e);t=s.charIndex,r=s.lineIndex;for(var i=0;i<r;i++)a+=this.getHeightOfLine(i);h=this._getLineLeftOffset(r);var o=this.__charBounds[r][t];return o&&(n=o.left),this.charSpacing!==0&&t===this._textLines[r].length&&(n-=this._getWidthOfCharSpacing()),c={top:a,left:h+(n>0?n:0)},this.cursorOffsetCache=c,this.cursorOffsetCache},renderCursor:function(e,h){var r=this.get2DCursorLocation(),t=r.lineIndex,a=r.charIndex>0?r.charIndex-1:0,n=this.getValueOfPropertyAt(t,a,"fontSize"),c=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/c,i=e.topOffset,o=this.getValueOfPropertyAt(t,a,"deltaY");i+=(1-this._fontSizeFraction)*this.getHeightOfLine(t)/this.lineHeight-n*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(e,h),h.fillStyle=this.getValueOfPropertyAt(t,a,"fill"),h.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,h.fillRect(e.left+e.leftOffset-s/2,i+e.top+o,s,n)},renderSelection:function(e,h){for(var r=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,t=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,n=this.get2DCursorLocation(r),c=this.get2DCursorLocation(t),s=n.lineIndex,i=c.lineIndex,o=n.charIndex<0?0:n.charIndex,l=c.charIndex<0?0:c.charIndex,d=s;d<=i;d++){var g=this._getLineLeftOffset(d)||0,v=this.getHeightOfLine(d),_=0,p=0,C=0;if(d===s&&(p=this.__charBounds[s][o].left),d>=s&&d<i)C=a&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===i)if(l===0)C=this.__charBounds[i][l].left;else{var S=this._getWidthOfCharSpacing();C=this.__charBounds[i][l-1].left+this.__charBounds[i][l-1].width-S}_=v,(this.lineHeight<1||d===i&&this.lineHeight>1)&&(v/=this.lineHeight),this.inCompositionMode?(h.fillStyle=this.compositionColor||"black",h.fillRect(e.left+g+p,e.top+e.topOffset+v,C-p,1)):(h.fillStyle=this.selectionColor,h.fillRect(e.left+g+p,e.top+e.topOffset,C-p,v)),e.topOffset+=_}},getCurrentCharFontSize:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fontSize")},getCurrentCharColor:function(){var e=this._getCurrentCharIndex();return this.getValueOfPropertyAt(e.l,e.c,"fill")},_getCurrentCharIndex:function(){var e=this.get2DCursorLocation(this.selectionStart,!0),h=e.charIndex>0?e.charIndex-1:0;return{l:e.lineIndex,c:h}}}),u.IText.fromObject=function(e,h){if(f(e),e.styles)for(var r in e.styles)for(var t in e.styles[r])f(e.styles[r][t]);u.Object._fromObject("IText",e,h,"text")}}(),function(){var f=u.util.object.clone;u.util.object.extend(u.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var e=this;this.on("added",function(){var h=e.canvas;h&&(h._hasITextHandlers||(h._hasITextHandlers=!0,e._initCanvasHandlers(h)),h._iTextInstances=h._iTextInstances||[],h._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var h=e.canvas;h&&(h._iTextInstances=h._iTextInstances||[],u.util.removeFromArray(h._iTextInstances,e),h._iTextInstances.length===0&&(h._hasITextHandlers=!1,e._removeCanvasHandlers(h)))})},_initCanvasHandlers:function(e){e._mouseUpITextHandler=function(){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.__isMousedown=!1})},e.on("mouse:up",e._mouseUpITextHandler)},_removeCanvasHandlers:function(e){e.off("mouse:up",e._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(e,h,r,t){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},e.animate("_currentCursorOpacity",h,{duration:r,onComplete:function(){a.isAborted||e[t]()},onChange:function(){e.canvas&&e.selectionStart===e.selectionEnd&&e.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e._currentTickCompleteState=e._animateCursor(e,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(e){var h=this,r=e?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){h._tick()},r)},abortCursorAnimation:function(){var e=this._currentTickState||this._currentTickCompleteState,h=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,e&&h&&h.clearContext(h.contextTop||h.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(e){var h=0,r=e-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)h++,r--;for(;/\S/.test(this._text[r])&&r>-1;)h++,r--;return e-h},findWordBoundaryRight:function(e){var h=0,r=e;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)h++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)h++,r++;return e+h},findLineBoundaryLeft:function(e){for(var h=0,r=e-1;!/\n/.test(this._text[r])&&r>-1;)h++,r--;return e-h},findLineBoundaryRight:function(e){for(var h=0,r=e;!/\n/.test(this._text[r])&&r<this._text.length;)h++,r++;return e+h},searchWordBoundary:function(e,h){for(var r=this._text,t=this._reSpace.test(r[e])?e-1:e,a=r[t],n=u.reNonWord;!n.test(a)&&t>0&&t<r.length;)t+=h,a=r[t];return n.test(a)&&(t+=h===1?0:1),t},selectWord:function(e){e=e||this.selectionStart;var h=this.searchWordBoundary(e,-1),r=this.searchWordBoundary(e,1);this.selectionStart=h,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(e){e=e||this.selectionStart;var h=this.findLineBoundaryLeft(e),r=this.findLineBoundaryRight(e);return this.selectionStart=h,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(e){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(e),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(e){e._iTextInstances&&e._iTextInstances.forEach(function(h){h.selected=!1,h.isEditing&&h.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(e){if(!(!this.__isMousedown||!this.isEditing)){var h=this.getSelectionStartFromPointer(e.e),r=this.selectionStart,t=this.selectionEnd;(h!==this.__selectionStartOnMouseDown||r===t)&&(r===h||t===h)||(h>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=h):(this.selectionStart=h,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==r||this.selectionEnd!==t)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(e,h,r){var t=r.slice(0,e),a=u.util.string.graphemeSplit(t).length;if(e===h)return{selectionStart:a,selectionEnd:a};var n=r.slice(e,h),c=u.util.string.graphemeSplit(n).length;return{selectionStart:a,selectionEnd:a+c}},fromGraphemeToStringSelection:function(e,h,r){var t=r.slice(0,e),a=t.join("").length;if(e===h)return{selectionStart:a,selectionEnd:a};var n=r.slice(e,h),c=n.join("").length;return{selectionStart:a,selectionEnd:a+c}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var e=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=e.selectionStart,this.hiddenTextarea.selectionEnd=e.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var e=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var e=this._calcTextareaPosition();this.hiddenTextarea.style.left=e.left,this.hiddenTextarea.style.top=e.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var e=this.inCompositionMode?this.compositionStart:this.selectionStart,h=this._getCursorBoundaries(e),r=this.get2DCursorLocation(e),t=r.lineIndex,a=r.charIndex,n=this.getValueOfPropertyAt(t,a,"fontSize")*this.lineHeight,c=h.leftOffset,s=this.calcTransformMatrix(),i={x:h.left+c,y:h.top+h.topOffset+n},o=this.canvas.getRetinaScaling(),l=this.canvas.upperCanvasEl,d=l.width/o,g=l.height/o,v=d-n,_=g-n,p=l.clientWidth/d,C=l.clientHeight/g;return i=u.util.transformPoint(i,s),i=u.util.transformPoint(i,this.canvas.viewportTransform),i.x*=p,i.y*=C,i.x<0&&(i.x=0),i.x>v&&(i.x=v),i.y<0&&(i.y=0),i.y>_&&(i.y=_),i.x+=this.canvas._offset.left,i.y+=this.canvas._offset.top,{left:i.x+"px",top:i.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var e=this._textBeforeEdit!==this.text,h=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,h&&(h.blur&&h.blur(),h.parentNode&&h.parentNode.removeChild(h)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),e&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),e&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var e in this.styles)this._textLines[e]||delete this.styles[e]},removeStyleFromTo:function(e,h){var r=this.get2DCursorLocation(e,!0),t=this.get2DCursorLocation(h,!0),a=r.lineIndex,n=r.charIndex,c=t.lineIndex,s=t.charIndex,i,o;if(a!==c){if(this.styles[a])for(i=n;i<this._unwrappedTextLines[a].length;i++)delete this.styles[a][i];if(this.styles[c])for(i=s;i<this._unwrappedTextLines[c].length;i++)o=this.styles[c][i],o&&(this.styles[a]||(this.styles[a]={}),this.styles[a][n+i-s]=o);for(i=a+1;i<=c;i++)delete this.styles[i];this.shiftLineStyles(c,a-c)}else if(this.styles[a]){o=this.styles[a];var l=s-n,d,g;for(i=n;i<s;i++)delete o[i];for(g in this.styles[a])d=parseInt(g,10),d>=s&&(o[d-l]=o[g],delete o[g])}},shiftLineStyles:function(e,h){var r=f(this.styles);for(var t in this.styles){var a=parseInt(t,10);a>e&&(this.styles[a+h]=r[a],r[a-h]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(e,h,r,t){var a,n={},c=!1;r||(r=1),this.shiftLineStyles(e,r),this.styles[e]&&(a=this.styles[e][h===0?h:h-1]);for(var s in this.styles[e]){var i=parseInt(s,10);i>=h&&(c=!0,n[i-h]=this.styles[e][s],delete this.styles[e][s])}for(c?this.styles[e+r]=n:delete this.styles[e+r];r>1;)r--,t&&t[r]?this.styles[e+r]={0:f(t[r])}:a?this.styles[e+r]={0:f(a)}:delete this.styles[e+r];this._forceClearCache=!0},insertCharStyleObject:function(e,h,r,t){this.styles||(this.styles={});var a=this.styles[e],n=a?f(a):{};r||(r=1);for(var c in n){var s=parseInt(c,10);s>=h&&(a[s+r]=n[s],n[s-r]||delete a[s])}if(this._forceClearCache=!0,t){for(;r--;)Object.keys(t[r]).length&&(this.styles[e]||(this.styles[e]={}),this.styles[e][h+r]=f(t[r]));return}if(a)for(var i=a[h?h-1:1];i&&r--;)this.styles[e][h+r]=f(i)},insertNewStyleBlock:function(e,h,r){for(var t=this.get2DCursorLocation(h,!0),a=[0],n=0,c=0;c<e.length;c++)e[c]===`
`?(n++,a[n]=0):a[n]++;a[0]>0&&(this.insertCharStyleObject(t.lineIndex,t.charIndex,a[0],r),r=r&&r.slice(a[0]+1)),n&&this.insertNewlineStyleObject(t.lineIndex,t.charIndex+a[0],n);for(var c=1;c<n;c++)a[c]>0?this.insertCharStyleObject(t.lineIndex+c,0,a[c],r):r&&(this.styles[t.lineIndex+c][0]=r[0]),r=r&&r.slice(a[c]+1);a[c]>0&&this.insertCharStyleObject(t.lineIndex+c,0,a[c],r)},setSelectionStartEndWithShift:function(e,h,r){r<=e?(h===e?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=e),this.selectionStart=r):r>e&&r<h?this._selectionDirection==="right"?this.selectionEnd=r:this.selectionStart=r:(h===e?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=h),this.selectionEnd=r)},setSelectionInBoundaries:function(){var e=this.text.length;this.selectionStart>e?this.selectionStart=e:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>e?this.selectionEnd=e:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),u.util.object.extend(u.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(f){if(this.canvas){this.__newClickTime=+new Date;var e=f.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",f),this._stopEvent(f.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(f){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===f.x&&this.__lastPointer.y===f.y},_stopEvent:function(f){f.preventDefault&&f.preventDefault(),f.stopPropagation&&f.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(f){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(f.e))},tripleClickHandler:function(f){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(f.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.__isMousedown=!0,this.selected&&this.setCursorByClick(f.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(f){if(this.__isMousedown=!1,!(!this.editable||this.group||f.transform&&f.transform.actionPerformed||f.e.button&&f.e.button!==1)){if(this.canvas){var e=this.canvas._activeObject;if(e&&e!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(f.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(f){var e=this.getSelectionStartFromPointer(f),h=this.selectionStart,r=this.selectionEnd;f.shiftKey?this.setSelectionStartEndWithShift(h,r,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(f){for(var e=this.getLocalPointer(f),h=0,r=0,t=0,a=0,n=0,c,s,i=0,o=this._textLines.length;i<o&&t<=e.y;i++)t+=this.getHeightOfLine(i)*this.scaleY,n=i,i>0&&(a+=this._textLines[i-1].length+this.missingNewlineOffset(i-1));c=this._getLineLeftOffset(n),r=c*this.scaleX,s=this._textLines[n];for(var l=0,d=s.length;l<d&&(h=r,r+=this.__charBounds[n][l].kernedWidth*this.scaleX,r<=e.x);l++)a++;return this._getNewSelectionStartFromOffset(e,h,r,a,d)},_getNewSelectionStartFromOffset:function(f,e,h,r,t){var a=f.x-e,n=h-f.x,c=n>a||n<0?0:1,s=r+c;return this.flipX&&(s=t-s),s>this._text.length&&(s=this._text.length),s}}),u.util.object.extend(u.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=u.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var f=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+f.top+"; left: "+f.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+f.fontSize+";",u.document.body.appendChild(this.hiddenTextarea),u.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),u.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),u.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),u.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),u.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),u.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),u.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),u.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),u.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(u.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(f){if(!(!this.isEditing||this.inCompositionMode)){if(f.keyCode in this.keysMap)this[this.keysMap[f.keyCode]](f);else if(f.keyCode in this.ctrlKeysMapDown&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapDown[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),f.keyCode>=33&&f.keyCode<=40?(this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(f){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(f.keyCode in this.ctrlKeysMapUp&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapUp[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(f){var e=this.fromPaste;if(this.fromPaste=!1,f&&f.stopPropagation(),!!this.isEditing){var h=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,r=this._text.length,t=h.length,a,n,c=t-r;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),i=this.selectionStart>s.selectionStart;this.selectionStart!==this.selectionEnd?(a=this._text.slice(this.selectionStart,this.selectionEnd),c+=this.selectionEnd-this.selectionStart):t<r&&(i?a=this._text.slice(this.selectionEnd+c,this.selectionEnd):a=this._text.slice(this.selectionStart,this.selectionStart-c)),n=h.slice(s.selectionEnd-c,s.selectionEnd),a&&a.length&&(this.selectionStart!==this.selectionEnd?this.removeStyleFromTo(this.selectionStart,this.selectionEnd):i?this.removeStyleFromTo(this.selectionEnd-a.length,this.selectionEnd):this.removeStyleFromTo(this.selectionEnd,this.selectionEnd+a.length)),n.length&&(e&&n.join("")===u.copiedText&&!u.disableStyleCopyPaste?this.insertNewStyleBlock(n,this.selectionStart,u.copiedTextStyle):this.insertNewStyleBlock(n,this.selectionStart)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(f){this.compositionStart=f.target.selectionStart,this.compositionEnd=f.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(u.copiedText=this.getSelectedText(),u.disableStyleCopyPaste?u.copiedTextStyle=null:u.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(f){return f&&f.clipboardData||u.window.clipboardData},_getWidthBeforeCursor:function(f,e){var h=this._getLineLeftOffset(f),r;return e>0&&(r=this.__charBounds[f][e-1],h+=r.left+r.width),h},getDownCursorOffset:function(f,e){var h=this._getSelectionForOffset(f,e),r=this.get2DCursorLocation(h),t=r.lineIndex;if(t===this._textLines.length-1||f.metaKey||f.keyCode===34)return this._text.length-h;var a=r.charIndex,n=this._getWidthBeforeCursor(t,a),c=this._getIndexOnLine(t+1,n),s=this._textLines[t].slice(a);return s.length+c+1+this.missingNewlineOffset(t)},_getSelectionForOffset:function(f,e){return f.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(f,e){var h=this._getSelectionForOffset(f,e),r=this.get2DCursorLocation(h),t=r.lineIndex;if(t===0||f.metaKey||f.keyCode===33)return-h;var a=r.charIndex,n=this._getWidthBeforeCursor(t,a),c=this._getIndexOnLine(t-1,n),s=this._textLines[t].slice(0,a),i=this.missingNewlineOffset(t-1);return-this._textLines[t-1].length+c-s.length+(1-i)},_getIndexOnLine:function(f,e){for(var h=this._textLines[f],r=this._getLineLeftOffset(f),t=r,a=0,n,c,s=0,i=h.length;s<i;s++)if(n=this.__charBounds[f][s].width,t+=n,t>e){c=!0;var o=t-n,l=t,d=Math.abs(o-e),g=Math.abs(l-e);a=g<d?s:s-1;break}return c||(a=h.length-1),a},moveCursorDown:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",f)},moveCursorUp:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",f)},_moveCursorUpOrDown:function(f,e){var h="get"+f+"CursorOffset",r=this[h](e,this._selectionDirection==="right");e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),r!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(f){var e=this._selectionDirection==="left"?this.selectionStart+f:this.selectionEnd+f;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),f!==0},moveCursorWithoutShift:function(f){return f<0?(this.selectionStart+=f,this.selectionEnd=this.selectionStart):(this.selectionEnd+=f,this.selectionStart=this.selectionEnd),f!==0},moveCursorLeft:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",f)},_move:function(f,e,h){var r;if(f.altKey)r=this["findWordBoundary"+h](this[e]);else if(f.metaKey||f.keyCode===35||f.keyCode===36)r=this["findLineBoundary"+h](this[e]);else return this[e]+=h==="Left"?-1:1,!0;if(typeof r!==void 0&&this[e]!==r)return this[e]=r,!0},_moveLeft:function(f,e){return this._move(f,e,"Left")},_moveRight:function(f,e){return this._move(f,e,"Right")},moveCursorLeftWithoutShift:function(f){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(f,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(f){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(f,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(f,"selectionStart")},moveCursorRight:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",f)},_moveCursorLeftOrRight:function(f,e){var h="moveCursor"+f+"With";this._currentCursorOpacity=1,e.shiftKey?h+="Shift":h+="outShift",this[h](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(f){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(f,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(f,"selectionEnd")},moveCursorRightWithoutShift:function(f){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(f,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(f,e){typeof e>"u"&&(e=f+1),this.removeStyleFromTo(f,e),this._text.splice(f,e-f),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(f,e,h,r){typeof r>"u"&&(r=h),r>h&&this.removeStyleFromTo(h,r);var t=u.util.string.graphemeSplit(f);this.insertNewStyleBlock(t,h,e),this._text=[].concat(this._text.slice(0,h),t,this._text.slice(r)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var f=u.util.toFixed,e=/  +/g;u.util.object.extend(u.Text.prototype,{_toSVG:function(){var h=this._getSVGLeftTopOffsets(),r=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(r)},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(h){var r=!0,t=this.getSvgTextDecoration(this);return[h.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",t?'text-decoration="'+t+'" ':"",'style="',this.getSvgStyles(r),'"',this.addPaintOrder()," >",h.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(h,r){var t=[],a=[],n=h,c;this._setSVGBg(a);for(var s=0,i=this._textLines.length;s<i;s++)c=this._getLineLeftOffset(s),(this.textBackgroundColor||this.styleHas("textBackgroundColor",s))&&this._setSVGTextLineBg(a,s,r+c,n),this._setSVGTextLineText(t,s,r+c,n),n+=this.getHeightOfLine(s);return{textSpans:t,textBgRects:a}},_createTextCharSpan:function(h,r,t,a){var n=h!==h.trim()||h.match(e),c=this.getSvgSpanStyles(r,n),s=c?'style="'+c+'"':"",i=r.deltaY,o="",l=u.Object.NUM_FRACTION_DIGITS;return i&&(o=' dy="'+f(i,l)+'" '),['<tspan x="',f(t,l),'" y="',f(a,l),'" ',o,s,">",u.util.string.escapeXml(h),"</tspan>"].join("")},_setSVGTextLineText:function(h,r,t,a){var n=this.getHeightOfLine(r),c=this.textAlign.indexOf("justify")!==-1,s,i,o="",l,d,g=0,v=this._textLines[r],_;a+=n*(1-this._fontSizeFraction)/this.lineHeight;for(var p=0,C=v.length-1;p<=C;p++)_=p===C||this.charSpacing,o+=v[p],l=this.__charBounds[r][p],g===0?(t+=l.kernedWidth-l.width,g+=l.width):g+=l.kernedWidth,c&&!_&&this._reSpaceAndTab.test(v[p])&&(_=!0),_||(s=s||this.getCompleteStyleDeclaration(r,p),i=this.getCompleteStyleDeclaration(r,p+1),_=this._hasStyleChangedForSvg(s,i)),_&&(d=this._getStyleDeclaration(r,p)||{},h.push(this._createTextCharSpan(o,d,t,a)),o="",s=i,t+=g,g=0)},_pushTextBgRect:function(h,r,t,a,n,c){var s=u.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(r),' x="',f(t,s),'" y="',f(a,s),'" width="',f(n,s),'" height="',f(c,s),`"></rect>
`)},_setSVGTextLineBg:function(h,r,t,a){for(var n=this._textLines[r],c=this.getHeightOfLine(r)/this.lineHeight,s=0,i=0,o,l,d=this.getValueOfPropertyAt(r,0,"textBackgroundColor"),g=0,v=n.length;g<v;g++)o=this.__charBounds[r][g],l=this.getValueOfPropertyAt(r,g,"textBackgroundColor"),l!==d?(d&&this._pushTextBgRect(h,d,t+i,a,s,c),i=o.left,s=o.width,d=l):s+=o.kernedWidth;l&&this._pushTextBgRect(h,l,t+i,a,s,c)},_getFillAttributes:function(h){var r=h&&typeof h=="string"?new u.Color(h):"";return!r||!r.getSource()||r.getAlpha()===1?'fill="'+h+'"':'opacity="'+r.getAlpha()+'" fill="'+r.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(h){for(var r=0,t=0,a=0;a<h;a++)r+=this.getHeightOfLine(a);return t=this.getHeightOfLine(a),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*t/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(h){var r=u.Object.prototype.getSvgStyles.call(this,h);return r+" white-space: pre;"}})}(),function(f){var e=f.fabric||(f.fabric={});e.Textbox=e.util.createClass(e.IText,e.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:e.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(h){for(var r=0,t=0,a=0,n={},c=0;c<h.graphemeLines.length;c++)h.graphemeText[a]===`
`&&c>0?(t=0,a++,r++):!this.splitByGrapheme&&this._reSpaceAndTab.test(h.graphemeText[a])&&c>0&&(t++,a++),n[c]={line:r,offset:t},a+=h.graphemeLines[c].length,t+=h.graphemeLines[c].length;return n},styleHas:function(h,r){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[r];t&&(r=t.line)}return e.Text.prototype.styleHas.call(this,h,r)},isEmptyStyles:function(h){if(!this.styles)return!0;var r=0,t=h+1,a,n,c=!1,s=this._styleMap[h],i=this._styleMap[h+1];s&&(h=s.line,r=s.offset),i&&(t=i.line,c=t===h,a=i.offset),n=typeof h>"u"?this.styles:{line:this.styles[h]};for(var o in n)for(var l in n[o])if(l>=r&&(!c||l<a))for(var d in n[o][l])return!1;return!0},_getStyleDeclaration:function(h,r){if(this._styleMap&&!this.isWrapping){var t=this._styleMap[h];if(!t)return null;h=t.line,r=t.offset+r}return this.callSuper("_getStyleDeclaration",h,r)},_setStyleDeclaration:function(h,r,t){var a=this._styleMap[h];h=a.line,r=a.offset+r,this.styles[h][r]=t},_deleteStyleDeclaration:function(h,r){var t=this._styleMap[h];h=t.line,r=t.offset+r,delete this.styles[h][r]},_getLineStyle:function(h){var r=this._styleMap[h];return!!this.styles[r.line]},_setLineStyle:function(h){var r=this._styleMap[h];this.styles[r.line]={}},_wrapText:function(h,r){var t=[],a;for(this.isWrapping=!0,a=0;a<h.length;a++)t=t.concat(this._wrapLine(h[a],a,r));return this.isWrapping=!1,t},_measureWord:function(h,r,t){var a=0,n,c=!0;t=t||0;for(var s=0,i=h.length;s<i;s++){var o=this._getGraphemeBox(h[s],r,s+t,n,c);a+=o.kernedWidth,n=h[s]}return a},_wrapLine:function(h,r,t,O){var n=0,c=this.splitByGrapheme,s=[],i=[],o=c?e.util.string.graphemeSplit(h):h.split(this._wordJoiners),l="",d=0,g=c?"":" ",v=0,_=0,p=0,C=!0,S=c?0:this._getWidthOfCharSpacing(),O=O||0;o.length===0&&o.push([]),t-=O;for(var k=0;k<o.length;k++)l=c?o[k]:e.util.string.graphemeSplit(o[k]),v=this._measureWord(l,r,d),d+=l.length,n+=_+v-S,n>=t&&!C?(s.push(i),i=[],n=v,C=!0):n+=S,!C&&!c&&i.push(g),i=i.concat(l),_=this._measureWord([g],r,d),d++,C=!1,v>p&&(p=v);return k&&s.push(i),p+O>this.dynamicMinWidth&&(this.dynamicMinWidth=p-S+O),s},isEndOfWrapping:function(h){return!this._styleMap[h+1]||this._styleMap[h+1].line!==this._styleMap[h].line},missingNewlineOffset:function(h){return this.splitByGrapheme?this.isEndOfWrapping(h)?1:0:1},_splitTextIntoLines:function(h){for(var r=e.Text.prototype._splitTextIntoLines.call(this,h),t=this._wrapText(r.lines,this.width),a=new Array(t.length),n=0;n<t.length;n++)a[n]=t[n].join("");return r.lines=a,r.graphemeLines=t,r},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var h={};for(var r in this._styleMap)this._textLines[r]&&(h[this._styleMap[r].line]=1);for(var r in this.styles)h[r]||delete this.styles[r]},toObject:function(h){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(h))}}),e.Textbox.fromObject=function(h,r){return e.Object._fromObject("Textbox",h,r,"text")}}(m)})(me);var re={exports:{}},ne={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},se={exports:{}},ve=function(u){return!u||typeof u=="string"?!1:u instanceof Array||Array.isArray(u)||u.length>=0&&(u.splice instanceof Function||Object.getOwnPropertyDescriptor(u,u.length-1)&&u.constructor.name!=="String")},pe=ve,_e=Array.prototype.concat,ye=Array.prototype.slice,ae=se.exports=function(u){for(var y=[],b=0,x=u.length;b<x;b++){var w=u[b];pe(w)?y=_e.call(y,ye.call(w)):y.push(w)}return y};ae.wrap=function(m){return function(){return m(ae(arguments))}};var be=se.exports,Wt=ne,zt=be,oe=Object.hasOwnProperty,he=Object.create(null);for(var Qt in Wt)oe.call(Wt,Qt)&&(he[Wt[Qt]]=Qt);var gt=re.exports={to:{},get:{}};gt.get=function(m){var u=m.substring(0,3).toLowerCase(),y,b;switch(u){case"hsl":y=gt.get.hsl(m),b="hsl";break;case"hwb":y=gt.get.hwb(m),b="hwb";break;default:y=gt.get.rgb(m),b="rgb";break}return y?{model:b,value:y}:null},gt.get.rgb=function(m){if(!m)return null;var u=/^#([a-f0-9]{3,4})$/i,y=/^#([a-f0-9]{6})([a-f0-9]{2})?$/i,b=/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,x=/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/,w=/^(\w+)$/,D=[0,0,0,1],f,e,h;if(f=m.match(y)){for(h=f[2],f=f[1],e=0;e<3;e++){var r=e*2;D[e]=parseInt(f.slice(r,r+2),16)}h&&(D[3]=parseInt(h,16)/255)}else if(f=m.match(u)){for(f=f[1],h=f[3],e=0;e<3;e++)D[e]=parseInt(f[e]+f[e],16);h&&(D[3]=parseInt(h+h,16)/255)}else if(f=m.match(b)){for(e=0;e<3;e++)D[e]=parseInt(f[e+1],0);f[4]&&(f[5]?D[3]=parseFloat(f[4])*.01:D[3]=parseFloat(f[4]))}else if(f=m.match(x)){for(e=0;e<3;e++)D[e]=Math.round(parseFloat(f[e+1])*2.55);f[4]&&(f[5]?D[3]=parseFloat(f[4])*.01:D[3]=parseFloat(f[4]))}else return(f=m.match(w))?f[1]==="transparent"?[0,0,0,0]:oe.call(Wt,f[1])?(D=Wt[f[1]],D[3]=1,D):null:null;for(e=0;e<3;e++)D[e]=Ot(D[e],0,255);return D[3]=Ot(D[3],0,1),D},gt.get.hsl=function(m){if(!m)return null;var u=/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,y=m.match(u);if(y){var b=parseFloat(y[4]),x=(parseFloat(y[1])%360+360)%360,w=Ot(parseFloat(y[2]),0,100),D=Ot(parseFloat(y[3]),0,100),f=Ot(isNaN(b)?1:b,0,1);return[x,w,D,f]}return null},gt.get.hwb=function(m){if(!m)return null;var u=/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/,y=m.match(u);if(y){var b=parseFloat(y[4]),x=(parseFloat(y[1])%360+360)%360,w=Ot(parseFloat(y[2]),0,100),D=Ot(parseFloat(y[3]),0,100),f=Ot(isNaN(b)?1:b,0,1);return[x,w,D,f]}return null},gt.to.hex=function(){var m=zt(arguments);return"#"+Nt(m[0])+Nt(m[1])+Nt(m[2])+(m[3]<1?Nt(Math.round(m[3]*255)):"")},gt.to.rgb=function(){var m=zt(arguments);return m.length<4||m[3]===1?"rgb("+Math.round(m[0])+", "+Math.round(m[1])+", "+Math.round(m[2])+")":"rgba("+Math.round(m[0])+", "+Math.round(m[1])+", "+Math.round(m[2])+", "+m[3]+")"},gt.to.rgb.percent=function(){var m=zt(arguments),u=Math.round(m[0]/255*100),y=Math.round(m[1]/255*100),b=Math.round(m[2]/255*100);return m.length<4||m[3]===1?"rgb("+u+"%, "+y+"%, "+b+"%)":"rgba("+u+"%, "+y+"%, "+b+"%, "+m[3]+")"},gt.to.hsl=function(){var m=zt(arguments);return m.length<4||m[3]===1?"hsl("+m[0]+", "+m[1]+"%, "+m[2]+"%)":"hsla("+m[0]+", "+m[1]+"%, "+m[2]+"%, "+m[3]+")"},gt.to.hwb=function(){var m=zt(arguments),u="";return m.length>=4&&m[3]!==1&&(u=", "+m[3]),"hwb("+m[0]+", "+m[1]+"%, "+m[2]+"%"+u+")"},gt.to.keyword=function(m){return he[m.slice(0,3)]};function Ot(m,u,y){return Math.min(Math.max(u,m),y)}function Nt(m){var u=Math.round(m).toString(16).toUpperCase();return u.length<2?"0"+u:u}var Ce=re.exports;const Ut=ne,le={};for(const m of Object.keys(Ut))le[Ut[m]]=m;const q={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};var ce=q;for(const m of Object.keys(q)){if(!("channels"in q[m]))throw new Error("missing channels property: "+m);if(!("labels"in q[m]))throw new Error("missing channel labels property: "+m);if(q[m].labels.length!==q[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:u,labels:y}=q[m];delete q[m].channels,delete q[m].labels,Object.defineProperty(q[m],"channels",{value:u}),Object.defineProperty(q[m],"labels",{value:y})}q.rgb.hsl=function(m){const u=m[0]/255,y=m[1]/255,b=m[2]/255,x=Math.min(u,y,b),w=Math.max(u,y,b),D=w-x;let f,e;w===x?f=0:u===w?f=(y-b)/D:y===w?f=2+(b-u)/D:b===w&&(f=4+(u-y)/D),f=Math.min(f*60,360),f<0&&(f+=360);const h=(x+w)/2;return w===x?e=0:h<=.5?e=D/(w+x):e=D/(2-w-x),[f,e*100,h*100]},q.rgb.hsv=function(m){let u,y,b,x,w;const D=m[0]/255,f=m[1]/255,e=m[2]/255,h=Math.max(D,f,e),r=h-Math.min(D,f,e),t=function(a){return(h-a)/6/r+1/2};return r===0?(x=0,w=0):(w=r/h,u=t(D),y=t(f),b=t(e),D===h?x=b-y:f===h?x=1/3+u-b:e===h&&(x=2/3+y-u),x<0?x+=1:x>1&&(x-=1)),[x*360,w*100,h*100]},q.rgb.hwb=function(m){const u=m[0],y=m[1];let b=m[2];const x=q.rgb.hsl(m)[0],w=1/255*Math.min(u,Math.min(y,b));return b=1-1/255*Math.max(u,Math.max(y,b)),[x,w*100,b*100]},q.rgb.cmyk=function(m){const u=m[0]/255,y=m[1]/255,b=m[2]/255,x=Math.min(1-u,1-y,1-b),w=(1-u-x)/(1-x)||0,D=(1-y-x)/(1-x)||0,f=(1-b-x)/(1-x)||0;return[w*100,D*100,f*100,x*100]};function xe(m,u){return(m[0]-u[0])**2+(m[1]-u[1])**2+(m[2]-u[2])**2}q.rgb.keyword=function(m){const u=le[m];if(u)return u;let y=1/0,b;for(const x of Object.keys(Ut)){const w=Ut[x],D=xe(m,w);D<y&&(y=D,b=x)}return b},q.keyword.rgb=function(m){return Ut[m]},q.rgb.xyz=function(m){let u=m[0]/255,y=m[1]/255,b=m[2]/255;u=u>.04045?((u+.055)/1.055)**2.4:u/12.92,y=y>.04045?((y+.055)/1.055)**2.4:y/12.92,b=b>.04045?((b+.055)/1.055)**2.4:b/12.92;const x=u*.4124+y*.3576+b*.1805,w=u*.2126+y*.7152+b*.0722,D=u*.0193+y*.1192+b*.9505;return[x*100,w*100,D*100]},q.rgb.lab=function(m){const u=q.rgb.xyz(m);let y=u[0],b=u[1],x=u[2];y/=95.047,b/=100,x/=108.883,y=y>.008856?y**(1/3):7.787*y+16/116,b=b>.008856?b**(1/3):7.787*b+16/116,x=x>.008856?x**(1/3):7.787*x+16/116;const w=116*b-16,D=500*(y-b),f=200*(b-x);return[w,D,f]},q.hsl.rgb=function(m){const u=m[0]/360,y=m[1]/100,b=m[2]/100;let x,w,D;if(y===0)return D=b*255,[D,D,D];b<.5?x=b*(1+y):x=b+y-b*y;const f=2*b-x,e=[0,0,0];for(let h=0;h<3;h++)w=u+1/3*-(h-1),w<0&&w++,w>1&&w--,6*w<1?D=f+(x-f)*6*w:2*w<1?D=x:3*w<2?D=f+(x-f)*(2/3-w)*6:D=f,e[h]=D*255;return e},q.hsl.hsv=function(m){const u=m[0];let y=m[1]/100,b=m[2]/100,x=y;const w=Math.max(b,.01);b*=2,y*=b<=1?b:2-b,x*=w<=1?w:2-w;const D=(b+y)/2,f=b===0?2*x/(w+x):2*y/(b+y);return[u,f*100,D*100]},q.hsv.rgb=function(m){const u=m[0]/60,y=m[1]/100;let b=m[2]/100;const x=Math.floor(u)%6,w=u-Math.floor(u),D=255*b*(1-y),f=255*b*(1-y*w),e=255*b*(1-y*(1-w));switch(b*=255,x){case 0:return[b,e,D];case 1:return[f,b,D];case 2:return[D,b,e];case 3:return[D,f,b];case 4:return[e,D,b];case 5:return[b,D,f]}},q.hsv.hsl=function(m){const u=m[0],y=m[1]/100,b=m[2]/100,x=Math.max(b,.01);let w,D;D=(2-y)*b;const f=(2-y)*x;return w=y*x,w/=f<=1?f:2-f,w=w||0,D/=2,[u,w*100,D*100]},q.hwb.rgb=function(m){const u=m[0]/360;let y=m[1]/100,b=m[2]/100;const x=y+b;let w;x>1&&(y/=x,b/=x);const D=Math.floor(6*u),f=1-b;w=6*u-D,D&1&&(w=1-w);const e=y+w*(f-y);let h,r,t;switch(D){default:case 6:case 0:h=f,r=e,t=y;break;case 1:h=e,r=f,t=y;break;case 2:h=y,r=f,t=e;break;case 3:h=y,r=e,t=f;break;case 4:h=e,r=y,t=f;break;case 5:h=f,r=y,t=e;break}return[h*255,r*255,t*255]},q.cmyk.rgb=function(m){const u=m[0]/100,y=m[1]/100,b=m[2]/100,x=m[3]/100,w=1-Math.min(1,u*(1-x)+x),D=1-Math.min(1,y*(1-x)+x),f=1-Math.min(1,b*(1-x)+x);return[w*255,D*255,f*255]},q.xyz.rgb=function(m){const u=m[0]/100,y=m[1]/100,b=m[2]/100;let x,w,D;return x=u*3.2406+y*-1.5372+b*-.4986,w=u*-.9689+y*1.8758+b*.0415,D=u*.0557+y*-.204+b*1.057,x=x>.0031308?1.055*x**(1/2.4)-.055:x*12.92,w=w>.0031308?1.055*w**(1/2.4)-.055:w*12.92,D=D>.0031308?1.055*D**(1/2.4)-.055:D*12.92,x=Math.min(Math.max(0,x),1),w=Math.min(Math.max(0,w),1),D=Math.min(Math.max(0,D),1),[x*255,w*255,D*255]},q.xyz.lab=function(m){let u=m[0],y=m[1],b=m[2];u/=95.047,y/=100,b/=108.883,u=u>.008856?u**(1/3):7.787*u+16/116,y=y>.008856?y**(1/3):7.787*y+16/116,b=b>.008856?b**(1/3):7.787*b+16/116;const x=116*y-16,w=500*(u-y),D=200*(y-b);return[x,w,D]},q.lab.xyz=function(m){const u=m[0],y=m[1],b=m[2];let x,w,D;w=(u+16)/116,x=y/500+w,D=w-b/200;const f=w**3,e=x**3,h=D**3;return w=f>.008856?f:(w-16/116)/7.787,x=e>.008856?e:(x-16/116)/7.787,D=h>.008856?h:(D-16/116)/7.787,x*=95.047,w*=100,D*=108.883,[x,w,D]},q.lab.lch=function(m){const u=m[0],y=m[1],b=m[2];let x;x=Math.atan2(b,y)*360/2/Math.PI,x<0&&(x+=360);const D=Math.sqrt(y*y+b*b);return[u,D,x]},q.lch.lab=function(m){const u=m[0],y=m[1],x=m[2]/360*2*Math.PI,w=y*Math.cos(x),D=y*Math.sin(x);return[u,w,D]},q.rgb.ansi16=function(m,u=null){const[y,b,x]=m;let w=u===null?q.rgb.hsv(m)[2]:u;if(w=Math.round(w/50),w===0)return 30;let D=30+(Math.round(x/255)<<2|Math.round(b/255)<<1|Math.round(y/255));return w===2&&(D+=60),D},q.hsv.ansi16=function(m){return q.rgb.ansi16(q.hsv.rgb(m),m[2])},q.rgb.ansi256=function(m){const u=m[0],y=m[1],b=m[2];return u===y&&y===b?u<8?16:u>248?231:Math.round((u-8)/247*24)+232:16+36*Math.round(u/255*5)+6*Math.round(y/255*5)+Math.round(b/255*5)},q.ansi16.rgb=function(m){let u=m%10;if(u===0||u===7)return m>50&&(u+=3.5),u=u/10.5*255,[u,u,u];const y=(~~(m>50)+1)*.5,b=(u&1)*y*255,x=(u>>1&1)*y*255,w=(u>>2&1)*y*255;return[b,x,w]},q.ansi256.rgb=function(m){if(m>=232){const w=(m-232)*10+8;return[w,w,w]}m-=16;let u;const y=Math.floor(m/36)/5*255,b=Math.floor((u=m%36)/6)/5*255,x=u%6/5*255;return[y,b,x]},q.rgb.hex=function(m){const y=(((Math.round(m[0])&255)<<16)+((Math.round(m[1])&255)<<8)+(Math.round(m[2])&255)).toString(16).toUpperCase();return"000000".substring(y.length)+y},q.hex.rgb=function(m){const u=m.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!u)return[0,0,0];let y=u[0];u[0].length===3&&(y=y.split("").map(f=>f+f).join(""));const b=parseInt(y,16),x=b>>16&255,w=b>>8&255,D=b&255;return[x,w,D]},q.rgb.hcg=function(m){const u=m[0]/255,y=m[1]/255,b=m[2]/255,x=Math.max(Math.max(u,y),b),w=Math.min(Math.min(u,y),b),D=x-w;let f,e;return D<1?f=w/(1-D):f=0,D<=0?e=0:x===u?e=(y-b)/D%6:x===y?e=2+(b-u)/D:e=4+(u-y)/D,e/=6,e%=1,[e*360,D*100,f*100]},q.hsl.hcg=function(m){const u=m[1]/100,y=m[2]/100,b=y<.5?2*u*y:2*u*(1-y);let x=0;return b<1&&(x=(y-.5*b)/(1-b)),[m[0],b*100,x*100]},q.hsv.hcg=function(m){const u=m[1]/100,y=m[2]/100,b=u*y;let x=0;return b<1&&(x=(y-b)/(1-b)),[m[0],b*100,x*100]},q.hcg.rgb=function(m){const u=m[0]/360,y=m[1]/100,b=m[2]/100;if(y===0)return[b*255,b*255,b*255];const x=[0,0,0],w=u%1*6,D=w%1,f=1-D;let e=0;switch(Math.floor(w)){case 0:x[0]=1,x[1]=D,x[2]=0;break;case 1:x[0]=f,x[1]=1,x[2]=0;break;case 2:x[0]=0,x[1]=1,x[2]=D;break;case 3:x[0]=0,x[1]=f,x[2]=1;break;case 4:x[0]=D,x[1]=0,x[2]=1;break;default:x[0]=1,x[1]=0,x[2]=f}return e=(1-y)*b,[(y*x[0]+e)*255,(y*x[1]+e)*255,(y*x[2]+e)*255]},q.hcg.hsv=function(m){const u=m[1]/100,y=m[2]/100,b=u+y*(1-u);let x=0;return b>0&&(x=u/b),[m[0],x*100,b*100]},q.hcg.hsl=function(m){const u=m[1]/100,b=m[2]/100*(1-u)+.5*u;let x=0;return b>0&&b<.5?x=u/(2*b):b>=.5&&b<1&&(x=u/(2*(1-b))),[m[0],x*100,b*100]},q.hcg.hwb=function(m){const u=m[1]/100,y=m[2]/100,b=u+y*(1-u);return[m[0],(b-u)*100,(1-b)*100]},q.hwb.hcg=function(m){const u=m[1]/100,b=1-m[2]/100,x=b-u;let w=0;return x<1&&(w=(b-x)/(1-x)),[m[0],x*100,w*100]},q.apple.rgb=function(m){return[m[0]/65535*255,m[1]/65535*255,m[2]/65535*255]},q.rgb.apple=function(m){return[m[0]/255*65535,m[1]/255*65535,m[2]/255*65535]},q.gray.rgb=function(m){return[m[0]/100*255,m[0]/100*255,m[0]/100*255]},q.gray.hsl=function(m){return[0,0,m[0]]},q.gray.hsv=q.gray.hsl,q.gray.hwb=function(m){return[0,100,m[0]]},q.gray.cmyk=function(m){return[0,0,0,m[0]]},q.gray.lab=function(m){return[m[0],0,0]},q.gray.hex=function(m){const u=Math.round(m[0]/100*255)&255,b=((u<<16)+(u<<8)+u).toString(16).toUpperCase();return"000000".substring(b.length)+b},q.rgb.gray=function(m){return[(m[0]+m[1]+m[2])/3/255*100]};const Vt=ce;function Se(){const m={},u=Object.keys(Vt);for(let y=u.length,b=0;b<y;b++)m[u[b]]={distance:-1,parent:null};return m}function we(m){const u=Se(),y=[m];for(u[m].distance=0;y.length;){const b=y.pop(),x=Object.keys(Vt[b]);for(let w=x.length,D=0;D<w;D++){const f=x[D],e=u[f];e.distance===-1&&(e.distance=u[b].distance+1,e.parent=b,y.unshift(f))}}return u}function Te(m,u){return function(y){return u(m(y))}}function Oe(m,u){const y=[u[m].parent,m];let b=Vt[u[m].parent][m],x=u[m].parent;for(;u[x].parent;)y.unshift(u[x].parent),b=Te(Vt[u[x].parent][x],b),x=u[x].parent;return b.conversion=y,b}var ke=function(m){const u=we(m),y={},b=Object.keys(u);for(let x=b.length,w=0;w<x;w++){const D=b[w];u[D].parent!==null&&(y[D]=Oe(D,u))}return y};const te=ce,De=ke,Rt={},Me=Object.keys(te);function Pe(m){const u=function(...y){const b=y[0];return b==null?b:(b.length>1&&(y=b),m(y))};return"conversion"in m&&(u.conversion=m.conversion),u}function Ae(m){const u=function(...y){const b=y[0];if(b==null)return b;b.length>1&&(y=b);const x=m(y);if(typeof x=="object")for(let w=x.length,D=0;D<w;D++)x[D]=Math.round(x[D]);return x};return"conversion"in m&&(u.conversion=m.conversion),u}Me.forEach(m=>{Rt[m]={},Object.defineProperty(Rt[m],"channels",{value:te[m].channels}),Object.defineProperty(Rt[m],"labels",{value:te[m].labels});const u=De(m);Object.keys(u).forEach(b=>{const x=u[b];Rt[m][b]=Ae(x),Rt[m][b].raw=Pe(x)})});var Ee=Rt;const It=Ce,mt=Ee,ue=["keyword","gray","hex"],ee={};for(const m of Object.keys(mt))ee[[...mt[m].labels].sort().join("")]=m;const qt={};function ct(m,u){if(!(this instanceof ct))return new ct(m,u);if(u&&u in ue&&(u=null),u&&!(u in mt))throw new Error("Unknown model: "+u);let y,b;if(m==null)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(m instanceof ct)this.model=m.model,this.color=[...m.color],this.valpha=m.valpha;else if(typeof m=="string"){const x=It.get(m);if(x===null)throw new Error("Unable to parse color from string: "+m);this.model=x.model,b=mt[this.model].channels,this.color=x.value.slice(0,b),this.valpha=typeof x.value[b]=="number"?x.value[b]:1}else if(m.length>0){this.model=u||"rgb",b=mt[this.model].channels;const x=Array.prototype.slice.call(m,0,b);this.color=ie(x,b),this.valpha=typeof m[b]=="number"?m[b]:1}else if(typeof m=="number")this.model="rgb",this.color=[m>>16&255,m>>8&255,m&255],this.valpha=1;else{this.valpha=1;const x=Object.keys(m);"alpha"in m&&(x.splice(x.indexOf("alpha"),1),this.valpha=typeof m.alpha=="number"?m.alpha:0);const w=x.sort().join("");if(!(w in ee))throw new Error("Unable to parse color from object: "+JSON.stringify(m));this.model=ee[w];const{labels:D}=mt[this.model],f=[];for(y=0;y<D.length;y++)f.push(m[D[y]]);this.color=ie(f)}if(qt[this.model])for(b=mt[this.model].channels,y=0;y<b;y++){const x=qt[this.model][y];x&&(this.color[y]=x(this.color[y]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}ct.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(m){let u=this.model in It.to?this:this.rgb();u=u.round(typeof m=="number"?m:1);const y=u.valpha===1?u.color:[...u.color,this.valpha];return It.to[u.model](y)},percentString(m){const u=this.rgb().round(typeof m=="number"?m:1),y=u.valpha===1?u.color:[...u.color,this.valpha];return It.to.rgb.percent(y)},array(){return this.valpha===1?[...this.color]:[...this.color,this.valpha]},object(){const m={},{channels:u}=mt[this.model],{labels:y}=mt[this.model];for(let b=0;b<u;b++)m[y[b]]=this.color[b];return this.valpha!==1&&(m.alpha=this.valpha),m},unitArray(){const m=this.rgb().color;return m[0]/=255,m[1]/=255,m[2]/=255,this.valpha!==1&&m.push(this.valpha),m},unitObject(){const m=this.rgb().object();return m.r/=255,m.g/=255,m.b/=255,this.valpha!==1&&(m.alpha=this.valpha),m},round(m){return m=Math.max(m||0,0),new ct([...this.color.map(Le(m)),this.valpha],this.model)},alpha(m){return m!==void 0?new ct([...this.color,Math.max(0,Math.min(1,m))],this.model):this.valpha},red:at("rgb",0,ht(255)),green:at("rgb",1,ht(255)),blue:at("rgb",2,ht(255)),hue:at(["hsl","hsv","hsl","hwb","hcg"],0,m=>(m%360+360)%360),saturationl:at("hsl",1,ht(100)),lightness:at("hsl",2,ht(100)),saturationv:at("hsv",1,ht(100)),value:at("hsv",2,ht(100)),chroma:at("hcg",1,ht(100)),gray:at("hcg",2,ht(100)),white:at("hwb",1,ht(100)),wblack:at("hwb",2,ht(100)),cyan:at("cmyk",0,ht(100)),magenta:at("cmyk",1,ht(100)),yellow:at("cmyk",2,ht(100)),black:at("cmyk",3,ht(100)),x:at("xyz",0,ht(95.047)),y:at("xyz",1,ht(100)),z:at("xyz",2,ht(108.833)),l:at("lab",0,ht(100)),a:at("lab",1),b:at("lab",2),keyword(m){return m!==void 0?new ct(m):mt[this.model].keyword(this.color)},hex(m){return m!==void 0?new ct(m):It.to.hex(this.rgb().round().color)},hexa(m){if(m!==void 0)return new ct(m);const u=this.rgb().round().color;let y=Math.round(this.valpha*255).toString(16).toUpperCase();return y.length===1&&(y="0"+y),It.to.hex(u)+y},rgbNumber(){const m=this.rgb().color;return(m[0]&255)<<16|(m[1]&255)<<8|m[2]&255},luminosity(){const m=this.rgb().color,u=[];for(const[y,b]of m.entries()){const x=b/255;u[y]=x<=.04045?x/12.92:((x+.055)/1.055)**2.4}return .2126*u[0]+.7152*u[1]+.0722*u[2]},contrast(m){const u=this.luminosity(),y=m.luminosity();return u>y?(u+.05)/(y+.05):(y+.05)/(u+.05)},level(m){const u=this.contrast(m);return u>=7?"AAA":u>=4.5?"AA":""},isDark(){const m=this.rgb().color;return(m[0]*2126+m[1]*7152+m[2]*722)/1e4<128},isLight(){return!this.isDark()},negate(){const m=this.rgb();for(let u=0;u<3;u++)m.color[u]=255-m.color[u];return m},lighten(m){const u=this.hsl();return u.color[2]+=u.color[2]*m,u},darken(m){const u=this.hsl();return u.color[2]-=u.color[2]*m,u},saturate(m){const u=this.hsl();return u.color[1]+=u.color[1]*m,u},desaturate(m){const u=this.hsl();return u.color[1]-=u.color[1]*m,u},whiten(m){const u=this.hwb();return u.color[1]+=u.color[1]*m,u},blacken(m){const u=this.hwb();return u.color[2]+=u.color[2]*m,u},grayscale(){const m=this.rgb().color,u=m[0]*.3+m[1]*.59+m[2]*.11;return ct.rgb(u,u,u)},fade(m){return this.alpha(this.valpha-this.valpha*m)},opaquer(m){return this.alpha(this.valpha+this.valpha*m)},rotate(m){const u=this.hsl();let y=u.color[0];return y=(y+m)%360,y=y<0?360+y:y,u.color[0]=y,u},mix(m,u){if(!m||!m.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof m);const y=m.rgb(),b=this.rgb(),x=u===void 0?.5:u,w=2*x-1,D=y.alpha()-b.alpha(),f=((w*D===-1?w:(w+D)/(1+w*D))+1)/2,e=1-f;return ct.rgb(f*y.red()+e*b.red(),f*y.green()+e*b.green(),f*y.blue()+e*b.blue(),y.alpha()*x+b.alpha()*(1-x))}};for(const m of Object.keys(mt)){if(ue.includes(m))continue;const{channels:u}=mt[m];ct.prototype[m]=function(...y){return this.model===m?new ct(this):y.length>0?new ct(y,m):new ct([...je(mt[this.model][m].raw(this.color)),this.valpha],m)},ct[m]=function(...y){let b=y[0];return typeof b=="number"&&(b=ie(y,u)),new ct(b,m)}}function Fe(m,u){return Number(m.toFixed(u))}function Le(m){return function(u){return Fe(u,m)}}function at(m,u,y){m=Array.isArray(m)?m:[m];for(const b of m)(qt[b]||(qt[b]=[]))[u]=y;return m=m[0],function(b){let x;return b!==void 0?(y&&(b=y(b)),x=this[m](),x.color[u]=b,x):(x=this[m]().color[u],y&&(x=y(x)),x)}}function ht(m){return function(u){return Math.max(0,Math.min(m,u))}}function je(m){return Array.isArray(m)?m:[m]}function ie(m,u){for(let y=0;y<u;y++)typeof m[y]!="number"&&(m[y]=0);return m}var Re=ct;const Et=Ht(Re);var $=globalThis&&globalThis.__classPrivateFieldSet||function(m,u,y){if(!u.has(m))throw new TypeError("attempted to set private field on non-instance");return u.set(m,y),y},H=globalThis&&globalThis.__classPrivateFieldGet||function(m,u){if(!u.has(m))throw new TypeError("attempted to get private field on non-instance");return u.get(m)},kt,Ft,vt,Bt,Gt,_t,yt,bt,Ct,xt,St,wt,Tt,Lt,Xt,Dt,Kt,Mt;const Ie=function(m){var u=131,y=137,b=0;m+="x";var x=Math.floor(9007199254740991/y);for(let w=0;w<m.length;w++)b>x&&(b=Math.floor(b/y)),b=b*u+m.charCodeAt(w);return b},N="0123456789abcdef".split(""),Be=[-2147483648,8388608,32768,128],pt=[24,16,8,0],Jt=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ut=[];class Xe{constructor(u=!1,y=!1){kt.set(this,void 0),Ft.set(this,void 0),vt.set(this,void 0),Bt.set(this,void 0),Gt.set(this,void 0),_t.set(this,void 0),yt.set(this,void 0),bt.set(this,void 0),Ct.set(this,void 0),xt.set(this,void 0),St.set(this,void 0),wt.set(this,void 0),Tt.set(this,void 0),Lt.set(this,void 0),Xt.set(this,void 0),Dt.set(this,void 0),Kt.set(this,0),Mt.set(this,void 0),this.init(u,y)}init(u,y){y?(ut[0]=ut[16]=ut[1]=ut[2]=ut[3]=ut[4]=ut[5]=ut[6]=ut[7]=ut[8]=ut[9]=ut[10]=ut[11]=ut[12]=ut[13]=ut[14]=ut[15]=0,$(this,Ft,ut)):$(this,Ft,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),u?($(this,_t,3238371032),$(this,yt,914150663),$(this,bt,812702999),$(this,Ct,4144912697),$(this,xt,4290775857),$(this,St,1750603025),$(this,wt,1694076839),$(this,Tt,3204075428)):($(this,_t,1779033703),$(this,yt,3144134277),$(this,bt,1013904242),$(this,Ct,2773480762),$(this,xt,1359893119),$(this,St,2600822924),$(this,wt,528734635),$(this,Tt,1541459225)),$(this,kt,$(this,Mt,$(this,vt,$(this,Xt,0)))),$(this,Bt,$(this,Lt,!1)),$(this,Gt,!0),$(this,Dt,u)}update(u){if(H(this,Bt))return this;let y;u instanceof ArrayBuffer?y=new Uint8Array(u):y=u;let b=0;const x=y.length,w=H(this,Ft);for(;b<x;){let D;if(H(this,Lt)&&($(this,Lt,!1),w[0]=H(this,kt),w[16]=w[1]=w[2]=w[3]=w[4]=w[5]=w[6]=w[7]=w[8]=w[9]=w[10]=w[11]=w[12]=w[13]=w[14]=w[15]=0),typeof y!="string")for(D=H(this,Mt);b<x&&D<64;++b)w[D>>2]|=y[b]<<pt[D++&3];else for(D=H(this,Mt);b<x&&D<64;++b){let f=y.charCodeAt(b);f<128?w[D>>2]|=f<<pt[D++&3]:f<2048?(w[D>>2]|=(192|f>>6)<<pt[D++&3],w[D>>2]|=(128|f&63)<<pt[D++&3]):f<55296||f>=57344?(w[D>>2]|=(224|f>>12)<<pt[D++&3],w[D>>2]|=(128|f>>6&63)<<pt[D++&3],w[D>>2]|=(128|f&63)<<pt[D++&3]):(f=65536+((f&1023)<<10|y.charCodeAt(++b)&1023),w[D>>2]|=(240|f>>18)<<pt[D++&3],w[D>>2]|=(128|f>>12&63)<<pt[D++&3],w[D>>2]|=(128|f>>6&63)<<pt[D++&3],w[D>>2]|=(128|f&63)<<pt[D++&3])}$(this,Kt,D),$(this,vt,H(this,vt)+(D-H(this,Mt))),D>=64?($(this,kt,w[16]),$(this,Mt,D-64),this.hash(),$(this,Lt,!0)):$(this,Mt,D)}return H(this,vt)>4294967295&&($(this,Xt,H(this,Xt)+(H(this,vt)/4294967296<<0)),$(this,vt,H(this,vt)%4294967296)),this}finalize(){if(H(this,Bt))return;$(this,Bt,!0);const u=H(this,Ft),y=H(this,Kt);u[16]=H(this,kt),u[y>>2]|=Be[y&3],$(this,kt,u[16]),y>=56&&(H(this,Lt)||this.hash(),u[0]=H(this,kt),u[16]=u[1]=u[2]=u[3]=u[4]=u[5]=u[6]=u[7]=u[8]=u[9]=u[10]=u[11]=u[12]=u[13]=u[14]=u[15]=0),u[14]=H(this,Xt)<<3|H(this,vt)>>>29,u[15]=H(this,vt)<<3,this.hash()}hash(){let u=H(this,_t),y=H(this,yt),b=H(this,bt),x=H(this,Ct),w=H(this,xt),D=H(this,St),f=H(this,wt),e=H(this,Tt);const h=H(this,Ft);let r,t,a,n,c,s,i,o,l,d;for(let g=16;g<64;++g)n=h[g-15],r=(n>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,n=h[g-2],t=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,h[g]=h[g-16]+r+h[g-7]+t<<0;d=y&b;for(let g=0;g<64;g+=4)H(this,Gt)?(H(this,Dt)?(i=300032,n=h[0]-1413257819,e=n-150054599<<0,x=n+24177077<<0):(i=704751109,n=h[0]-210244248,e=n-1521486534<<0,x=n+143694565<<0),$(this,Gt,!1)):(r=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),t=(w>>>6|w<<26)^(w>>>11|w<<21)^(w>>>25|w<<7),i=u&y,a=i^u&b^d,s=w&D^~w&f,n=e+t+s+Jt[g]+h[g],c=r+a,e=x+n<<0,x=n+c<<0),r=(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10),t=(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7),o=x&u,a=o^x&y^i,s=e&w^~e&D,n=f+t+s+Jt[g+1]+h[g+1],c=r+a,f=b+n<<0,b=n+c<<0,r=(b>>>2|b<<30)^(b>>>13|b<<19)^(b>>>22|b<<10),t=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7),l=b&x,a=l^b&u^o,s=f&e^~f&w,n=D+t+s+Jt[g+2]+h[g+2],c=r+a,D=y+n<<0,y=n+c<<0,r=(y>>>2|y<<30)^(y>>>13|y<<19)^(y>>>22|y<<10),t=(D>>>6|D<<26)^(D>>>11|D<<21)^(D>>>25|D<<7),d=y&b,a=d^y&x^l,s=D&f^~D&e,n=w+t+s+Jt[g+3]+h[g+3],c=r+a,w=u+n<<0,u=n+c<<0;$(this,_t,H(this,_t)+u<<0),$(this,yt,H(this,yt)+y<<0),$(this,bt,H(this,bt)+b<<0),$(this,Ct,H(this,Ct)+x<<0),$(this,xt,H(this,xt)+w<<0),$(this,St,H(this,St)+D<<0),$(this,wt,H(this,wt)+f<<0),$(this,Tt,H(this,Tt)+e<<0)}hex(){this.finalize();const u=H(this,_t),y=H(this,yt),b=H(this,bt),x=H(this,Ct),w=H(this,xt),D=H(this,St),f=H(this,wt),e=H(this,Tt);let h=N[u>>28&15]+N[u>>24&15]+N[u>>20&15]+N[u>>16&15]+N[u>>12&15]+N[u>>8&15]+N[u>>4&15]+N[u&15]+N[y>>28&15]+N[y>>24&15]+N[y>>20&15]+N[y>>16&15]+N[y>>12&15]+N[y>>8&15]+N[y>>4&15]+N[y&15]+N[b>>28&15]+N[b>>24&15]+N[b>>20&15]+N[b>>16&15]+N[b>>12&15]+N[b>>8&15]+N[b>>4&15]+N[b&15]+N[x>>28&15]+N[x>>24&15]+N[x>>20&15]+N[x>>16&15]+N[x>>12&15]+N[x>>8&15]+N[x>>4&15]+N[x&15]+N[w>>28&15]+N[w>>24&15]+N[w>>20&15]+N[w>>16&15]+N[w>>12&15]+N[w>>8&15]+N[w>>4&15]+N[w&15]+N[D>>28&15]+N[D>>24&15]+N[D>>20&15]+N[D>>16&15]+N[D>>12&15]+N[D>>8&15]+N[D>>4&15]+N[D&15]+N[f>>28&15]+N[f>>24&15]+N[f>>20&15]+N[f>>16&15]+N[f>>12&15]+N[f>>8&15]+N[f>>4&15]+N[f&15];return H(this,Dt)||(h+=N[e>>28&15]+N[e>>24&15]+N[e>>20&15]+N[e>>16&15]+N[e>>12&15]+N[e>>8&15]+N[e>>4&15]+N[e&15]),h}toString(){return this.hex()}digest(){this.finalize();const u=H(this,_t),y=H(this,yt),b=H(this,bt),x=H(this,Ct),w=H(this,xt),D=H(this,St),f=H(this,wt),e=H(this,Tt),h=[u>>24&255,u>>16&255,u>>8&255,u&255,y>>24&255,y>>16&255,y>>8&255,y&255,b>>24&255,b>>16&255,b>>8&255,b&255,x>>24&255,x>>16&255,x>>8&255,x&255,w>>24&255,w>>16&255,w>>8&255,w&255,D>>24&255,D>>16&255,D>>8&255,D&255,f>>24&255,f>>16&255,f>>8&255,f&255];return H(this,Dt)||h.push(e>>24&255,e>>16&255,e>>8&255,e&255),h}array(){return this.digest()}arrayBuffer(){this.finalize();const u=new ArrayBuffer(H(this,Dt)?28:32),y=new DataView(u);return y.setUint32(0,H(this,_t)),y.setUint32(4,H(this,yt)),y.setUint32(8,H(this,bt)),y.setUint32(12,H(this,Ct)),y.setUint32(16,H(this,xt)),y.setUint32(20,H(this,St)),y.setUint32(24,H(this,wt)),H(this,Dt)||y.setUint32(28,H(this,Tt)),u}}kt=new WeakMap,Ft=new WeakMap,vt=new WeakMap,Bt=new WeakMap,Gt=new WeakMap,_t=new WeakMap,yt=new WeakMap,bt=new WeakMap,Ct=new WeakMap,xt=new WeakMap,St=new WeakMap,wt=new WeakMap,Tt=new WeakMap,Lt=new WeakMap,Xt=new WeakMap,Dt=new WeakMap,Kt=new WeakMap,Mt=new WeakMap;function Ye(m){const u=new Xe;return u.update(m),parseInt(u.hex().substring(0,8),16)}const We=function(m){var u="#";return m.forEach(function(y){y<16&&(u+=0),u+=y.toString(16)}),u},ze=function(m,u,y){m/=360;var b=y<.5?y*(1+u):y+u-y*u,x=2*y-b;return[m+1/3,m,m-1/3].map(function(w){return w<0&&w++,w>1&&w--,w<1/6?w=x+(b-x)*6*w:w<.5?w=b:w<2/3?w=x+(b-x)*6*(2/3-w):w=x,Math.round(w*255)})};class Ue{constructor(u={}){const[y,b]=[u.lightness,u.saturation].map(function(x){return x=x!==void 0?x:[.35,.5,.65],Array.isArray(x)?x.concat():[x]});this.L=y,this.S=b,typeof u.hue=="number"&&(u.hue={min:u.hue,max:u.hue}),typeof u.hue=="object"&&!Array.isArray(u.hue)&&(u.hue=[u.hue]),typeof u.hue>"u"&&(u.hue=[]),this.hueRanges=u.hue.map(function(x){return{min:typeof x.min>"u"?0:x.min,max:typeof x.max>"u"?360:x.max}}),this.hash=Ye,typeof u.hash=="function"&&(this.hash=u.hash),u.hash==="bkdr"&&(this.hash=Ie)}hsl(u){var y,b,x,w=this.hash(u),D=727;if(this.hueRanges.length){const f=this.hueRanges[w%this.hueRanges.length];y=w/this.hueRanges.length%D*(f.max-f.min)/D+f.min}else y=w%359;return w=Math.ceil(w/360),b=this.S[w%this.S.length],w=Math.ceil(w/this.S.length),x=this.L[w%this.L.length],[y,b,x]}rgb(u){var y=this.hsl(u);return ze.apply(this,y)}hex(u){var y=this.rgb(u);return We(y)}}new Ue;var fe;(function(m){m.MouseOut="mouseout",m.MouseOver="mouseover",m.MouseDown="mousedown",m.MouseUp="mouseup",m.MouseDoubleClick="mousedblclick",m.Moving="moving"})(fe||(fe={})),new Et("#180019"),new Et("#C5CBD3"),new Et("orange"),new Et("#400042"),new Et("white"),new Et("rgba(131,85,131,0.84)"),new Et});
